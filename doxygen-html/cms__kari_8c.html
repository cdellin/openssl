<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/cms/cms_kari.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_7882632c4dffce91474d1f2c5c940725.html">cms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cms_kari.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &lt;openssl/asn1t.h&gt;</code><br/>
<code>#include &lt;openssl/pem.h&gt;</code><br/>
<code>#include &lt;openssl/x509v3.h&gt;</code><br/>
<code>#include &lt;openssl/err.h&gt;</code><br/>
<code>#include &lt;openssl/cms.h&gt;</code><br/>
<code>#include &lt;openssl/rand.h&gt;</code><br/>
<code>#include &lt;openssl/aes.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cms__lcl_8h_source.html">cms_lcl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="asn1__locl_8h_source.html">asn1_locl.h</a>&quot;</code><br/>
</div>
<p><a href="cms__kari_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aef2777d4c051b819513ca63e18de9a79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#aef2777d4c051b819513ca63e18de9a79">CMS_RecipientInfo_kari_get0_alg</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **palg, <a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **pukm)</td></tr>
<tr class="memitem:a42924096dea181c582add0674bb20418"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a42924096dea181c582add0674bb20418">STACK_OF</a> (<a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a>)</td></tr>
<tr class="memitem:a209691a56cb96974cf86e9cebb345f91"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a209691a56cb96974cf86e9cebb345f91">CMS_RecipientInfo_kari_get0_orig_id</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **pubalg, <a class="el" href="ossl__typ_8h.html#af837aaa00e151b1e8773aea5a8fe1cc4">ASN1_BIT_STRING</a> **pubkey, <a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **keyid, <a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **issuer, <a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **sno)</td></tr>
<tr class="memitem:a4ca315f531e49cf12f7e108431318f3b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a4ca315f531e49cf12f7e108431318f3b">CMS_RecipientInfo_kari_orig_id_cmp</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *cert)</td></tr>
<tr class="memitem:a7b749be942f8aeea3a3d515526090bc8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a7b749be942f8aeea3a3d515526090bc8">CMS_RecipientEncryptedKey_get0_id</a> (<a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *rek, <a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **keyid, <a class="el" href="ossl__typ_8h.html#abd19ea5b527807ce3a516e6a41440f84">ASN1_GENERALIZEDTIME</a> **tm, <a class="el" href="cms_8h.html#af54d24ab3b9acdc97b67988d660ede75">CMS_OtherKeyAttribute</a> **other, <a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **issuer, <a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **sno)</td></tr>
<tr class="memitem:a7b75fd402338e1489e4730faf461ca61"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a7b75fd402338e1489e4730faf461ca61">CMS_RecipientEncryptedKey_cert_cmp</a> (<a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *rek, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *cert)</td></tr>
<tr class="memitem:a585f407ee2d6046d19e919ad35cfd1e1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a585f407ee2d6046d19e919ad35cfd1e1">CMS_RecipientInfo_kari_set0_pkey</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *pk)</td></tr>
<tr class="memitem:aa8de84f2733f37b3dcbda807c489186a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#aab2bd6a044e1d31ebc2fe82b3b0b3d9a">EVP_CIPHER_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#aa8de84f2733f37b3dcbda807c489186a">CMS_RecipientInfo_kari_get0_ctx</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri)</td></tr>
<tr class="memitem:a08fc89556c5524e7b5083845a77d0c6b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a08fc89556c5524e7b5083845a77d0c6b">CMS_RecipientInfo_kari_decrypt</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms, <a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *rek)</td></tr>
<tr class="memitem:acf47dd02ab24b071a4539c0eae072a73"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#acf47dd02ab24b071a4539c0eae072a73">cms_RecipientInfo_kari_init</a> (<a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *recip, <a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *pk, unsigned int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)</td></tr>
<tr class="memitem:a178c4432e47cc12081fd3e4e28910092"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__kari_8c.html#a178c4432e47cc12081fd3e4e28910092">cms_RecipientInfo_kari_encrypt</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms, <a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *ri)</td></tr>
</table>
<h2>Function Documentation</h2>
<a class="anchor" id="a7b75fd402338e1489e4730faf461ca61"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientEncryptedKey_cert_cmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *&#160;</td>
          <td class="paramname"><em>rek</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00204">204</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html">CMS_KeyAgreeRecipientIdentifier</a> *rid = rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> == <a class="code" href="cms__lcl_8h.html#adcf4c7b7ee4fafcba3324805c9896392">CMS_REK_ISSUER_SERIAL</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#a013cca1c46db1e5c849677157326d3eb">cms_ias_cert_cmp</a>(rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#afb51fb2a4dafcde2a4d39ef2e29ec866">issuerAndSerialNumber</a>, cert);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> == <a class="code" href="cms__lcl_8h.html#ae29b7278fde140f345e7425e33192372">CMS_REK_KEYIDENTIFIER</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#ac7878a1f6e7641e2d71cc14cb69b209e">cms_keyid_cert_cmp</a>(rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a5dc8e9dd2f255a0e008f6355ec5e419f">rKeyId</a>-&gt;<a class="code" href="structCMS__RecipientKeyIdentifier__st.html#a81e57ea93d5273862f46b808b54af56b">subjectKeyIdentifier</a>, cert);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7b749be942f8aeea3a3d515526090bc8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientEncryptedKey_get0_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *&#160;</td>
          <td class="paramname"><em>rek</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **&#160;</td>
          <td class="paramname"><em>keyid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#abd19ea5b527807ce3a516e6a41440f84">ASN1_GENERALIZEDTIME</a> **&#160;</td>
          <td class="paramname"><em>tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cms_8h.html#af54d24ab3b9acdc97b67988d660ede75">CMS_OtherKeyAttribute</a> **&#160;</td>
          <td class="paramname"><em>other</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **&#160;</td>
          <td class="paramname"><em>issuer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **&#160;</td>
          <td class="paramname"><em>sno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00166">166</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html">CMS_KeyAgreeRecipientIdentifier</a> *rid = rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> == <a class="code" href="cms__lcl_8h.html#adcf4c7b7ee4fafcba3324805c9896392">CMS_REK_ISSUER_SERIAL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (issuer)</div>
<div class="line">                        *issuer = rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#afb51fb2a4dafcde2a4d39ef2e29ec866">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#ae8924a6986383f83257f1c08c1ac301a">issuer</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (sno)</div>
<div class="line">                        *sno = rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#afb51fb2a4dafcde2a4d39ef2e29ec866">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#aa44d6bf4b715606d29551da6bdad464f">serialNumber</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (keyid)</div>
<div class="line">                        *keyid = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (tm)</div>
<div class="line">                        *tm = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (other)</div>
<div class="line">                        *other = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> == <a class="code" href="cms__lcl_8h.html#ae29b7278fde140f345e7425e33192372">CMS_REK_KEYIDENTIFIER</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (keyid)</div>
<div class="line">                        *keyid = rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a5dc8e9dd2f255a0e008f6355ec5e419f">rKeyId</a>-&gt;<a class="code" href="structCMS__RecipientKeyIdentifier__st.html#a81e57ea93d5273862f46b808b54af56b">subjectKeyIdentifier</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (tm)</div>
<div class="line">                        *tm = rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a5dc8e9dd2f255a0e008f6355ec5e419f">rKeyId</a>-&gt;<a class="code" href="structCMS__RecipientKeyIdentifier__st.html#a38cd55bcfd0d7ec86fc18988f6d06528">date</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (other)</div>
<div class="line">                        *other = rid-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a5dc8e9dd2f255a0e008f6355ec5e419f">rKeyId</a>-&gt;<a class="code" href="structCMS__RecipientKeyIdentifier__st.html#a77bed5abdf9787a112c093e8c96088c8">other</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (issuer)</div>
<div class="line">                        *issuer = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (sno)</div>
<div class="line">                        *sno = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a08fc89556c5524e7b5083845a77d0c6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientInfo_kari_decrypt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a> *&#160;</td>
          <td class="paramname"><em>rek</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00290">290</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> rv = 0;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *enckey = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, *cek = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">size_t</span> enckeylen;</div>
<div class="line">        <span class="keywordtype">size_t</span> ceklen;</div>
<div class="line">        <a class="code" href="structCMS__EncryptedContentInfo__st.html">CMS_EncryptedContentInfo</a> *ec;</div>
<div class="line">        enckeylen = rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#af861a7676bfae5f3f4ce5c5b7ba044af">encryptedKey</a>-&gt;<a class="code" href="structasn1__string__st.html#a425b332bd4925320832bb18c59f6a9df">length</a>;</div>
<div class="line">        enckey = rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#af861a7676bfae5f3f4ce5c5b7ba044af">encryptedKey</a>-&gt;<a class="code" href="structasn1__string__st.html#a275a9784693f470debfb2b97411a4fea">data</a>;</div>
<div class="line">        <span class="comment">/* Setup all parameters to derive KEK */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="cms__env_8c.html#ac35f315f7ccd6ac91196b3ec171dc0cc">cms_env_asn1_ctrl</a>(ri, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="comment">/* Attempt to decrypt CEK */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!cms_kek_cipher(&amp;cek, &amp;ceklen, enckey, enckeylen, ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>, 0))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        ec = cms-&gt;<a class="code" href="structCMS__ContentInfo__st.html#a5d7048ed3f6cbbae2020c1d4e9e85197">d</a>.<a class="code" href="structCMS__ContentInfo__st.html#a9b7f4b2c1c079c4f2803c9d238bac3b8">envelopedData</a>-&gt;<a class="code" href="structCMS__EnvelopedData__st.html#a61ff72488726aa8cf3191e2e1cacc97d">encryptedContentInfo</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a07604ea895cfab1afb5fcccf72fc0706">key</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#a2aa47e40c63b05d00e9a780592f2a2b8">OPENSSL_cleanse</a>(ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a07604ea895cfab1afb5fcccf72fc0706">key</a>, ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a7609a5affd1037e9313029db3d095676">keylen</a>);</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a07604ea895cfab1afb5fcccf72fc0706">key</a>);</div>
<div class="line">                }</div>
<div class="line">        ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a07604ea895cfab1afb5fcccf72fc0706">key</a> = cek;</div>
<div class="line">        ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a7609a5affd1037e9313029db3d095676">keylen</a> = ceklen;</div>
<div class="line">        cek = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        rv = 1;</div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (cek)</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(cek);</div>
<div class="line">        <span class="keywordflow">return</span> rv;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a178c4432e47cc12081fd3e4e28910092"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_RecipientInfo_kari_encrypt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00429">429</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html">CMS_KeyAgreeRecipientInfo</a> *kari;</div>
<div class="line">        <a class="code" href="structCMS__EncryptedContentInfo__st.html">CMS_EncryptedContentInfo</a> *ec;</div>
<div class="line">        <a class="code" href="structCMS__RecipientEncryptedKey__st.html">CMS_RecipientEncryptedKey</a> *rek;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structCMS__RecipientEncryptedKey__st.html">CMS_RecipientEncryptedKey</a>) *reks;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> != <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a58ff144816f61684193afd1144a81ba7">CMS_F_CMS_RECIPIENTINFO_KARI_ENCRYPT</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a3dafd7ae00cc336b974db955156f890f">CMS_R_NOT_KEY_AGREEMENT</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        kari = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>;</div>
<div class="line">        reks = kari-&gt;recipientEncryptedKeys;</div>
<div class="line">        ec = cms-&gt;<a class="code" href="structCMS__ContentInfo__st.html#a5d7048ed3f6cbbae2020c1d4e9e85197">d</a>.<a class="code" href="structCMS__ContentInfo__st.html#a9b7f4b2c1c079c4f2803c9d238bac3b8">envelopedData</a>-&gt;<a class="code" href="structCMS__EnvelopedData__st.html#a61ff72488726aa8cf3191e2e1cacc97d">encryptedContentInfo</a>;</div>
<div class="line">        <span class="comment">/* Initialise wrap algorithm parameters */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!cms_wrap_init(kari, ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a42d15187520e31613b3d2c47c79fa8dd">cipher</a>))</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="comment">/* If no orignator key set up initialise for ephemeral key</span></div>
<div class="line"><span class="comment">         * the public key ASN1 structure will set the actual public</span></div>
<div class="line"><span class="comment">         * key value.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a5230303cf63716c151f7f7cc2b86d816">originator</a>-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == -1)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html">CMS_OriginatorIdentifierOrKey</a> *oik = kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a5230303cf63716c151f7f7cc2b86d816">originator</a>;</div>
<div class="line">                oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> = <a class="code" href="cms__lcl_8h.html#a7ca4de9879cff722eab3b9ebf9cc73ea">CMS_OIK_PUBKEY</a>;</div>
<div class="line">                oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#ac5559321f5be1422ebbc138590e48c96">originatorKey</a> = <a class="code" href="asn1_8h.html#ae2f9bfe2b1e8a6b13251fb01ca2dc25c">M_ASN1_new_of</a>(<a class="code" href="structCMS__OriginatorPublicKey__st.html">CMS_OriginatorPublicKey</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (!oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#ac5559321f5be1422ebbc138590e48c96">originatorKey</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        <span class="comment">/* Initialise KDF algorithm */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="cms__env_8c.html#ac35f315f7ccd6ac91196b3ec171dc0cc">cms_env_asn1_ctrl</a>(ri, 0))</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="comment">/* For each rek, derive KEK, encrypt CEK */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#aba16160d72d9c247493142e2eef84755">sk_CMS_RecipientEncryptedKey_num</a>(reks); i++)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *enckey;</div>
<div class="line">                <span class="keywordtype">size_t</span> enckeylen;</div>
<div class="line">                rek = <a class="code" href="safestack_8h.html#a59a9c2dd94c0a85865041952a7d152fa">sk_CMS_RecipientEncryptedKey_value</a>(reks, i);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a8b9b4ce1541519c3e1d9de5c7ba3db15">EVP_PKEY_derive_set_peer</a>(kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a72c16b9727ba03e41e28085f501a290b">pctx</a>, rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a28a9a4782cb4ec8380fd2f7b4984e49d">pkey</a>) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                <span class="keywordflow">if</span> (!cms_kek_cipher(&amp;enckey, &amp;enckeylen, ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a07604ea895cfab1afb5fcccf72fc0706">key</a>, ec-&gt;<a class="code" href="structCMS__EncryptedContentInfo__st.html#a7609a5affd1037e9313029db3d095676">keylen</a>,</div>
<div class="line">                                                                kari, 1))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                <a class="code" href="asn1_8h.html#add085933f3a303f7c59acf0e9b072d63">ASN1_STRING_set0</a>(rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#af861a7676bfae5f3f4ce5c5b7ba044af">encryptedKey</a>, enckey, enckeylen);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aef2777d4c051b819513ca63e18de9a79"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientInfo_kari_get0_alg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **&#160;</td>
          <td class="paramname"><em>palg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **&#160;</td>
          <td class="paramname"><em>pukm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00071">71</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> != <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a013600bf0dcafcd84a215679ac3da0bc">CMS_F_CMS_RECIPIENTINFO_KARI_GET0_ALG</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a3dafd7ae00cc336b974db955156f890f">CMS_R_NOT_KEY_AGREEMENT</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (palg)</div>
<div class="line">                *palg = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#ae2eb7ab77257537a7ded67b008cb4121">keyEncryptionAlgorithm</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (pukm)</div>
<div class="line">                *pukm = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a8e70cb76571b0665b96cf4d89e4bbd03">ukm</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8de84f2733f37b3dcbda807c489186a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#aab2bd6a044e1d31ebc2fe82b3b0b3d9a">EVP_CIPHER_CTX</a>* CMS_RecipientInfo_kari_get0_ctx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00238">238</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> == <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                <span class="keywordflow">return</span> &amp;ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#ab0c12e18345ceaf9e13cfed347fa040e">ctx</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a209691a56cb96974cf86e9cebb345f91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientInfo_kari_get0_orig_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **&#160;</td>
          <td class="paramname"><em>pubalg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#af837aaa00e151b1e8773aea5a8fe1cc4">ASN1_BIT_STRING</a> **&#160;</td>
          <td class="paramname"><em>pubkey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **&#160;</td>
          <td class="paramname"><em>keyid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **&#160;</td>
          <td class="paramname"><em>issuer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **&#160;</td>
          <td class="paramname"><em>sno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00101">101</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html">CMS_OriginatorIdentifierOrKey</a> *oik;</div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> != <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#acd27a4f555ea6daf92dd1f33c3d68ce2">CMS_F_CMS_RECIPIENTINFO_KARI_GET0_ORIG_ID</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a3dafd7ae00cc336b974db955156f890f">CMS_R_NOT_KEY_AGREEMENT</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        oik = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a5230303cf63716c151f7f7cc2b86d816">originator</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (issuer)</div>
<div class="line">                *issuer = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (sno)</div>
<div class="line">                *sno = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (keyid)</div>
<div class="line">                *keyid = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (pubalg)</div>
<div class="line">                *pubalg = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (pubkey)</div>
<div class="line">                *pubkey = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == <a class="code" href="cms__lcl_8h.html#ab3e6514a619e47cba48f870966361f89">CMS_OIK_ISSUER_SERIAL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (issuer)</div>
<div class="line">                        *issuer = oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a7749a66890198b91e870e419046230e0">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#ae8924a6986383f83257f1c08c1ac301a">issuer</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (sno)</div>
<div class="line">                        *sno = oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a7749a66890198b91e870e419046230e0">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#aa44d6bf4b715606d29551da6bdad464f">serialNumber</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == <a class="code" href="cms__lcl_8h.html#ab07ddd1f14d39875f458d6f2affd1105">CMS_OIK_KEYIDENTIFIER</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (keyid)</div>
<div class="line">                        *keyid = oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#aa14ec757305f7250c3fe470b01577ecc">subjectKeyIdentifier</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == <a class="code" href="cms__lcl_8h.html#a7ca4de9879cff722eab3b9ebf9cc73ea">CMS_OIK_PUBKEY</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (pubalg)</div>
<div class="line">                        *pubalg = oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#ac5559321f5be1422ebbc138590e48c96">originatorKey</a>-&gt;<a class="code" href="structCMS__OriginatorPublicKey__st.html#a0e680efe1c4723d4a9dd29173afab388">algorithm</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (pubkey)</div>
<div class="line">                        *pubkey = oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#ac5559321f5be1422ebbc138590e48c96">originatorKey</a>-&gt;<a class="code" href="structCMS__OriginatorPublicKey__st.html#a3076802e285887b3529616743a7f7f75">publicKey</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf47dd02ab24b071a4539c0eae072a73"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_RecipientInfo_kari_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>recip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *&#160;</td>
          <td class="paramname"><em>pk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00354">354</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html">CMS_KeyAgreeRecipientInfo</a> *kari;</div>
<div class="line">        <a class="code" href="structCMS__RecipientEncryptedKey__st.html">CMS_RecipientEncryptedKey</a> *rek = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a> = <a class="code" href="asn1_8h.html#ae2f9bfe2b1e8a6b13251fb01ca2dc25c">M_ASN1_new_of</a>(<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html">CMS_KeyAgreeRecipientInfo</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (!ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> = <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>;</div>
<div class="line"></div>
<div class="line">        kari = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>;</div>
<div class="line">        kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#ada88fbb3bd7e460c0310d3aa1b1e9214">version</a> = 3;</div>
<div class="line"></div>
<div class="line">        rek = <a class="code" href="asn1_8h.html#ae2f9bfe2b1e8a6b13251fb01ca2dc25c">M_ASN1_new_of</a>(<a class="code" href="structCMS__RecipientEncryptedKey__st.html">CMS_RecipientEncryptedKey</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="safestack_8h.html#a198e9cf5c5935dd6d981cb38000c4863">sk_CMS_RecipientEncryptedKey_push</a>(kari-&gt;recipientEncryptedKeys, rek))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="asn1_8h.html#a64344e58b69188c21fd5ec2abe3a4a38">M_ASN1_free_of</a>(rek, <a class="code" href="structCMS__RecipientEncryptedKey__st.html">CMS_RecipientEncryptedKey</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#ae4670dfe3e27c5494ea55bc9f7a70296">CMS_USE_KEYID</a>)</div>
<div class="line">                {</div>
<div class="line">                rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> = <a class="code" href="cms__lcl_8h.html#ae29b7278fde140f345e7425e33192372">CMS_REK_KEYIDENTIFIER</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#aedcc935c2d546a5704b460ccf277e053">cms_set1_keyid</a>(&amp;rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a5dc8e9dd2f255a0e008f6355ec5e419f">rKeyId</a>-&gt;<a class="code" href="structCMS__RecipientKeyIdentifier__st.html#a81e57ea93d5273862f46b808b54af56b">subjectKeyIdentifier</a>, recip))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#a9e09b503569a350cbe02daaa6e4334ad">type</a> = <a class="code" href="cms__lcl_8h.html#adcf4c7b7ee4fafcba3324805c9896392">CMS_REK_ISSUER_SERIAL</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#af1abd64a7d3f7b9e06fcd1111652ea00">cms_set1_ias</a>(&amp;rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a46ec8673f0d9bbdd9a66ab7b28ebc433">rid</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#af94b30a9481c62573166ae4982d42fbb">d</a>.<a class="code" href="structCMS__KeyAgreeRecipientIdentifier__st.html#afb51fb2a4dafcde2a4d39ef2e29ec866">issuerAndSerialNumber</a>, recip))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Create ephemeral key */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!cms_kari_create_ephemeral_key(kari, pk))</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="crypto_8h.html#ab8556c4f12443f1876ce487dd0c8db27">CRYPTO_add</a>(&amp;pk-&gt;<a class="code" href="structevp__pkey__st.html#a89b11b788ffad7d747d1c7eed4cf279f">references</a>, 1, <a class="code" href="crypto_8h.html#aee0129d89ab09d6bccecd1ce55307584">CRYPTO_LOCK_EVP_PKEY</a>);</div>
<div class="line">        rek-&gt;<a class="code" href="structCMS__RecipientEncryptedKey__st.html#a28a9a4782cb4ec8380fd2f7b4984e49d">pkey</a> = pk;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ca315f531e49cf12f7e108431318f3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientInfo_kari_orig_id_cmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00149">149</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html">CMS_OriginatorIdentifierOrKey</a> *oik;</div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a9f2d873cfd8472c69844df802bd71f13">type</a> != <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a4c54f31257bf8a91ed5a502ab1a111de">CMS_F_CMS_RECIPIENTINFO_KARI_ORIG_ID_CMP</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a3dafd7ae00cc336b974db955156f890f">CMS_R_NOT_KEY_AGREEMENT</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -2;</div>
<div class="line">                }</div>
<div class="line">        oik = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a5230303cf63716c151f7f7cc2b86d816">originator</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == <a class="code" href="cms__lcl_8h.html#ab3e6514a619e47cba48f870966361f89">CMS_OIK_ISSUER_SERIAL</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#a013cca1c46db1e5c849677157326d3eb">cms_ias_cert_cmp</a>(oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a7749a66890198b91e870e419046230e0">issuerAndSerialNumber</a>, cert);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a005783130889ef0e2100e219fc19ae02">type</a> == <a class="code" href="cms__lcl_8h.html#ab07ddd1f14d39875f458d6f2affd1105">CMS_OIK_KEYIDENTIFIER</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#ac7878a1f6e7641e2d71cc14cb69b209e">cms_keyid_cert_cmp</a>(oik-&gt;<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#a28bc4aea3dfb2aa4c8f27cb7d0d4f673">d</a>.<a class="code" href="structCMS__OriginatorIdentifierOrKey__st.html#aa14ec757305f7250c3fe470b01577ecc">subjectKeyIdentifier</a>, cert);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a585f407ee2d6046d19e919ad35cfd1e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_RecipientInfo_kari_set0_pkey </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#ac5c9066f9d23a39dc973dd8821304756">CMS_RecipientInfo</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *&#160;</td>
          <td class="paramname"><em>pk</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00216">216</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structevp__pkey__ctx__st.html">EVP_PKEY_CTX</a> *pctx;</div>
<div class="line">        <a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html">CMS_KeyAgreeRecipientInfo</a> *kari = ri-&gt;<a class="code" href="structCMS__RecipientInfo__st.html#a3cf345049f14144cbdee1ee1d29d39cf">d</a>.<a class="code" href="structCMS__RecipientInfo__st.html#a1df83734b1f23faba9b9bb5a580e6211">kari</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a72c16b9727ba03e41e28085f501a290b">pctx</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="evp_8h.html#a9a2d5ac99985dda36f15bd92d83c1621">EVP_PKEY_CTX_free</a>(kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a72c16b9727ba03e41e28085f501a290b">pctx</a>);</div>
<div class="line">                kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a72c16b9727ba03e41e28085f501a290b">pctx</a> = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (!pk)</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        pctx = <a class="code" href="evp_8h.html#a23d1c787f99b2aaa6d8283c2db325eea">EVP_PKEY_CTX_new</a>(pk, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (!pctx || !<a class="code" href="evp_8h.html#ae524c385eebb1b65ad9b719636245e18">EVP_PKEY_derive_init</a>(pctx))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        kari-&gt;<a class="code" href="structCMS__KeyAgreeRecipientInfo__st.html#a72c16b9727ba03e41e28085f501a290b">pctx</a> = pctx;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (pctx)</div>
<div class="line">                <a class="code" href="evp_8h.html#a9a2d5ac99985dda36f15bd92d83c1621">EVP_PKEY_CTX_free</a>(pctx);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a42924096dea181c582add0674bb20418"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STACK_OF </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#aea929bebf778a99c3f2c6b5151850fc8">CMS_RecipientEncryptedKey</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__kari_8c_source.html#l00090">90</a> of file <a class="el" href="cms__kari_8c_source.html">cms_kari.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (ri-&gt;type != <a class="code" href="cms_8h.html#acef9d700f8704eef4c8cef466d2ccce2">CMS_RECIPINFO_AGREE</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a649b88a59acb6c0ada5c46c8e02e3d1b">CMS_F_CMS_RECIPIENTINFO_KARI_GET0_REKS</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a3dafd7ae00cc336b974db955156f890f">CMS_R_NOT_KEY_AGREEMENT</a>);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span> ri-&gt;d.kari-&gt;recipientEncryptedKeys;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
