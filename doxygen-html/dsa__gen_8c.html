<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/dsa/dsa_gen.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_de3c7fcc4857e49b03c7ec35b4e4bf92.html">dsa</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dsa_gen.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;openssl/opensslconf.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &lt;openssl/evp.h&gt;</code><br/>
<code>#include &lt;openssl/bn.h&gt;</code><br/>
<code>#include &lt;openssl/rand.h&gt;</code><br/>
<code>#include &lt;openssl/sha.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="dsa__locl_8h_source.html">dsa_locl.h</a>&quot;</code><br/>
</div>
<p><a href="dsa__gen_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7172fe24d1ffc31d15b20a77ea9f34dd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a7172fe24d1ffc31d15b20a77ea9f34dd">HASH</a>&#160;&#160;&#160;<a class="el" href="m__sha1_8c.html#aa090d659a494a10525e38d272efb01ae">EVP_sha1</a>()</td></tr>
<tr class="memitem:a099e2c772dcc3de688ce53772001b364"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a099e2c772dcc3de688ce53772001b364">OPENSSL_FIPSAPI</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a394a9bb0530f1adf9500e312224e20a2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a394a9bb0530f1adf9500e312224e20a2">DSA_generate_parameters_ex</a> (<a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *ret, int <a class="el" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>, const unsigned char *seed_in, int seed_len, int *counter_ret, unsigned long *h_ret, <a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *<a class="el" href="dsagen_8c.html#aaf444bf60bdcdbb61c2afe741f506693">cb</a>)</td></tr>
<tr class="memitem:a8c8b2381bb9b9444293152b685ed8fed"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a8c8b2381bb9b9444293152b685ed8fed">dsa_builtin_paramgen</a> (<a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *ret, size_t <a class="el" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>, size_t qbits, const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *evpmd, const unsigned char *seed_in, size_t seed_len, unsigned char *seed_out, int *counter_ret, unsigned long *h_ret, <a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *<a class="el" href="dsagen_8c.html#aaf444bf60bdcdbb61c2afe741f506693">cb</a>)</td></tr>
<tr class="memitem:a211e9a5038c5be4c1236df2e2c93b1ae"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a211e9a5038c5be4c1236df2e2c93b1ae">dsa_builtin_paramgen2</a> (<a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *ret, size_t L, size_t <a class="el" href="wp__block_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *evpmd, const unsigned char *seed_in, size_t seed_len, int idx, unsigned char *seed_out, int *counter_ret, unsigned long *h_ret, <a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *<a class="el" href="dsagen_8c.html#aaf444bf60bdcdbb61c2afe741f506693">cb</a>)</td></tr>
<tr class="memitem:a19ea65a4f63b7382a4166d9128dec09e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsa__gen_8c.html#a19ea65a4f63b7382a4166d9128dec09e">dsa_paramgen_check_g</a> (<a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *dsa)</td></tr>
</table>
<h2>Macro Definition Documentation</h2>
<a class="anchor" id="a7172fe24d1ffc31d15b20a77ea9f34dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH&#160;&#160;&#160;<a class="el" href="m__sha1_8c.html#aa090d659a494a10525e38d272efb01ae">EVP_sha1</a>()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00069">69</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>

</div>
</div>
<a class="anchor" id="a099e2c772dcc3de688ce53772001b364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPENSSL_FIPSAPI</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00076">76</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a8c8b2381bb9b9444293152b685ed8fed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsa_builtin_paramgen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *&#160;</td>
          <td class="paramname"><em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>qbits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *&#160;</td>
          <td class="paramname"><em>evpmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>seed_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>seed_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>seed_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>counter_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>h_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00119">119</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ok=0;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="dsagen_8c.html#ab71354640198c564865564ae01236438">seed</a>[<a class="code" href="sha_8h.html#aa9cf0abf87b30c4c63e9c7e89c590579">SHA256_DIGEST_LENGTH</a>];</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[<a class="code" href="sha_8h.html#aa9cf0abf87b30c4c63e9c7e89c590579">SHA256_DIGEST_LENGTH</a>];</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[<a class="code" href="sha_8h.html#aa9cf0abf87b30c4c63e9c7e89c590579">SHA256_DIGEST_LENGTH</a>],buf2[<a class="code" href="sha_8h.html#aa9cf0abf87b30c4c63e9c7e89c590579">SHA256_DIGEST_LENGTH</a>];</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *r0,*W,*<a class="code" href="ecp__nistputil_8c.html#a5ae25df4ee72f83efb4a3683c970678f">X</a>,*<a class="code" href="ideatest_8c.html#aa8bc5d06b176e45541cdfaf9c2c9dfea">c</a>,*<a class="code" href="eng__openssl_8c.html#a0472ffc658fb6766b6cfca3532f9c0ce">test</a>;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *g=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,*<a class="code" href="wp__block_8c.html#a60bf45d7a4743f796fb40bf55c69a88c">q</a>=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,*p=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> i, <a class="code" href="ideatest_8c.html#affd277b0419eb3509477eb517aa904ce">k</a>, n=0, m=0, qsize = qbits &gt;&gt; 3;</div>
<div class="line">        <span class="keywordtype">int</span> counter=0;</div>
<div class="line">        <span class="keywordtype">int</span> r=0;</div>
<div class="line">        <a class="code" href="structbignum__ctx.html">BN_CTX</a> *ctx=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>=2;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OPENSSL_FIPS</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>(FIPS_selftest_failed())</div>
<div class="line">            {</div>
<div class="line">            <a class="code" href="err_8h.html#a6f758a749ea0b53a3ee1baf7da54a8f2">FIPSerr</a>(FIPS_F_DSA_BUILTIN_PARAMGEN, FIPS_R_FIPS_SELFTEST_FAILED);</div>
<div class="line">            <span class="keywordflow">goto</span> err;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (FIPS_module_mode() &amp;&amp; !(ret-&gt;<a class="code" href="structdsa__st.html#a3c27d330e3e07368715455b5a019690d">flags</a> &amp; <a class="code" href="dsa_8h.html#aae12dfab550971af38dfa55bf7021e94">DSA_FLAG_NON_FIPS_ALLOW</a>) </div>
<div class="line">                        &amp;&amp; (<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> &lt; <a class="code" href="dsa_8h.html#ad2cfd90cd54ccc669ec9fc8c7c3000c6">OPENSSL_DSA_FIPS_MIN_MODULUS_BITS</a>))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a97e6e6a59b842d7f28085b22dc191c99">DSAerr</a>(<a class="code" href="dsa_8h.html#adc224812f92450e06eeafb1eaa8c4b34">DSA_F_DSA_BUILTIN_PARAMGEN</a>, <a class="code" href="dsa_8h.html#a9270fb3c571affdfc8322bbb551b6a7f">DSA_R_KEY_SIZE_TOO_SMALL</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> (qsize != <a class="code" href="sha_8h.html#a1a715db7b4403fe6c165e49a32f5fe3d">SHA_DIGEST_LENGTH</a> &amp;&amp; qsize != <a class="code" href="sha_8h.html#aac41b7686fc19eaf23d716838478de35">SHA224_DIGEST_LENGTH</a> &amp;&amp;</div>
<div class="line">            qsize != <a class="code" href="sha_8h.html#aa9cf0abf87b30c4c63e9c7e89c590579">SHA256_DIGEST_LENGTH</a>)</div>
<div class="line">                <span class="comment">/* invalid q size */</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (evpmd == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="comment">/* use SHA1 as default */</span></div>
<div class="line">                evpmd = <a class="code" href="evp_8h.html#aa090d659a494a10525e38d272efb01ae">EVP_sha1</a>();</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> &lt; 512)</div>
<div class="line">                <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> = 512;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> = (<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>+63)/64*64;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* NB: seed_len == 0 is special case: copy generated seed to</span></div>
<div class="line"><span class="comment">         * seed_in if it is not NULL.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (seed_len &amp;&amp; (seed_len &lt; (<span class="keywordtype">size_t</span>)qsize))</div>
<div class="line">                seed_in = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;         <span class="comment">/* seed buffer too small -- ignore */</span></div>
<div class="line">        <span class="keywordflow">if</span> (seed_len &gt; (<span class="keywordtype">size_t</span>)qsize) </div>
<div class="line">                seed_len = qsize;       <span class="comment">/* App. 2.2 of FIPS PUB 186 allows larger SEED,</span></div>
<div class="line"><span class="comment">                                         * but our internal buffers are restricted to 160 bits*/</span></div>
<div class="line">        <span class="keywordflow">if</span> (seed_in != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                memcpy(seed, seed_in, seed_len);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((ctx=<a class="code" href="bn_8h.html#a04a38b774caf5e9bb7dea8b22c6eddc2">BN_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((mont=<a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        r0 = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        g = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        W = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        q = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        X = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        c = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        p = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        test = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(test,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>(),<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>-1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (;;) <span class="comment">/* find q */</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordtype">int</span> seed_is_random;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 1 */</span></div>
<div class="line">                        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 0, m++))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">if</span> (!seed_len)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (<a class="code" href="rand_8h.html#a8a4e911a9be281eb797faa8590637ac3">RAND_pseudo_bytes</a>(seed, qsize) &lt; 0)</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                seed_is_random = 1;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                {</div>
<div class="line">                                seed_is_random = 0;</div>
<div class="line">                                seed_len=0; <span class="comment">/* use random seed if &#39;seed_in&#39; turns out to be bad*/</span></div>
<div class="line">                                }</div>
<div class="line">                        memcpy(buf , seed, qsize);</div>
<div class="line">                        memcpy(buf2, seed, qsize);</div>
<div class="line">                        <span class="comment">/* precompute &quot;SEED + 1&quot; for step 7: */</span></div>
<div class="line">                        <span class="keywordflow">for</span> (i = qsize-1; i &gt;= 0; i--)</div>
<div class="line">                                {</div>
<div class="line">                                buf[i]++;</div>
<div class="line">                                <span class="keywordflow">if</span> (buf[i] != 0)</div>
<div class="line">                                        <span class="keywordflow">break</span>;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 2 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#aaf1dcfa403148677376101633deb9025">EVP_Digest</a>(seed, qsize, md,   <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, evpmd, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#aaf1dcfa403148677376101633deb9025">EVP_Digest</a>(buf,  qsize, buf2, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, evpmd, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">for</span> (i = 0; i &lt; qsize; i++)</div>
<div class="line">                                md[i]^=buf2[i];</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 3 */</span></div>
<div class="line">                        md[0] |= 0x80;</div>
<div class="line">                        md[qsize-1] |= 0x01;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9ca9a524bd4c4de12ae0947872c5182b">BN_bin2bn</a>(md, qsize, q))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 4 */</span></div>
<div class="line">                        r = <a class="code" href="bn_8h.html#a9a6f34fa218fe1250fe77ace1a38e37b">BN_is_prime_fasttest_ex</a>(q, <a class="code" href="dsa_8h.html#a21c5a2e2f8ba866514471ecfaa49cc3f">DSS_prime_checks</a>, ctx,</div>
<div class="line">                                        seed_is_random, cb);</div>
<div class="line">                        <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (r != 0)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* do a callback call */</span></div>
<div class="line">                        <span class="comment">/* step 5 */</span></div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 2, 0)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 3, 0)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* step 6 */</span></div>
<div class="line">                counter=0;</div>
<div class="line">                <span class="comment">/* &quot;offset = 2&quot; */</span></div>
<div class="line"></div>
<div class="line">                n=(<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>-1)/160;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (;;)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> ((counter != 0) &amp;&amp; !<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 0, counter))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 7 */</span></div>
<div class="line">                        <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(W);</div>
<div class="line">                        <span class="comment">/* now &#39;buf&#39; contains &quot;SEED + offset - 1&quot; */</span></div>
<div class="line">                        <span class="keywordflow">for</span> (k=0; k&lt;=n; k++)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="comment">/* obtain &quot;SEED + offset + k&quot; by incrementing: */</span></div>
<div class="line">                                <span class="keywordflow">for</span> (i = qsize-1; i &gt;= 0; i--)</div>
<div class="line">                                        {</div>
<div class="line">                                        buf[i]++;</div>
<div class="line">                                        <span class="keywordflow">if</span> (buf[i] != 0)</div>
<div class="line">                                                <span class="keywordflow">break</span>;</div>
<div class="line">                                        }</div>
<div class="line"></div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#aaf1dcfa403148677376101633deb9025">EVP_Digest</a>(buf, qsize, md ,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, evpmd,</div>
<div class="line">                                                                        <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                                <span class="comment">/* step 8 */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9ca9a524bd4c4de12ae0947872c5182b">BN_bin2bn</a>(md, qsize, r0))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(r0,r0,(qsize &lt;&lt; 3)*k)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(W,W,r0)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* more of step 8 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#afef0313695959acb28432e718486d02e">BN_mask_bits</a>(W,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>-1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(X,W)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(X,X,test)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 9 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad186a71ba4368527796f30db0b205e47">BN_lshift1</a>(r0,q)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a4f1447a894029080d727d6c9a051de58">BN_mod</a>(c,X,r0,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(r0,c,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(p,X,r0)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 10 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ac18ade9dbb4531d8cc3a38d3c970c0e0">BN_cmp</a>(p,test) &gt;= 0)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="comment">/* step 11 */</span></div>
<div class="line">                                r = <a class="code" href="bn_8h.html#a9a6f34fa218fe1250fe77ace1a38e37b">BN_is_prime_fasttest_ex</a>(p, <a class="code" href="dsa_8h.html#a21c5a2e2f8ba866514471ecfaa49cc3f">DSS_prime_checks</a>,</div>
<div class="line">                                                ctx, 1, cb);</div>
<div class="line">                                <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line">                                                <span class="keywordflow">goto</span> end; <span class="comment">/* found it */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (r != 0)</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 13 */</span></div>
<div class="line">                        counter++;</div>
<div class="line">                        <span class="comment">/* &quot;offset = offset + n + 1&quot; */</span></div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 14 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (counter &gt;= 4096) <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">end:</div>
<div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 2, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* We now need to generate g */</span></div>
<div class="line">        <span class="comment">/* Set r0=(p-1)/q */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(test,p,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2d806f97ad6b75e85e001d781090eb0">BN_div</a>(r0,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,test,q,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae9b1fc316ffc1825cb8547ba169631b6">BN_set_word</a>(test,h)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont,p,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* g=test^r0%p */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a47220794c064f6df0ef0aae54e2ed68f">BN_mod_exp_mont</a>(g,test,r0,p,ctx,mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab1f2aa49c798c0f21b01899e8d562ee7">BN_is_one</a>(g)) <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(test,test,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">                h++;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 3, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        ok=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> (ok)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>);</div>
<div class="line">                <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>);</div>
<div class="line">                <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>);</div>
<div class="line">                ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(p);</div>
<div class="line">                ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(q);</div>
<div class="line">                ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(g);</div>
<div class="line">                <span class="keywordflow">if</span> (ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        ok=0;</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (counter_ret != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) *counter_ret=counter;</div>
<div class="line">                <span class="keywordflow">if</span> (h_ret != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) *h_ret=<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (seed_out)</div>
<div class="line">                        memcpy(seed_out, seed, qsize);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span>(ctx)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">                <a class="code" href="bn_8h.html#a92238db5c582bc055f4aa86a5cddb247">BN_CTX_free</a>(ctx);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <span class="keywordflow">return</span> ok;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a211e9a5038c5be4c1236df2e2c93b1ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsa_builtin_paramgen2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *&#160;</td>
          <td class="paramname"><em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *&#160;</td>
          <td class="paramname"><em>evpmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>seed_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>seed_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>seed_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>counter_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>h_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00453">453</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ok=-1;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="dsagen_8c.html#ab71354640198c564865564ae01236438">seed</a> = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, *seed_tmp = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> md[<a class="code" href="evp_8h.html#a71bfc78a168f00f0c4ffd2535082b129">EVP_MAX_MD_SIZE</a>];</div>
<div class="line">        <span class="keywordtype">int</span> mdsize;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *r0,*W,*<a class="code" href="ecp__nistputil_8c.html#a5ae25df4ee72f83efb4a3683c970678f">X</a>,*<a class="code" href="ideatest_8c.html#aa8bc5d06b176e45541cdfaf9c2c9dfea">c</a>,*<a class="code" href="eng__openssl_8c.html#a0472ffc658fb6766b6cfca3532f9c0ce">test</a>;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *g=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,*<a class="code" href="wp__block_8c.html#a60bf45d7a4743f796fb40bf55c69a88c">q</a>=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,*p=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> i, <a class="code" href="ideatest_8c.html#affd277b0419eb3509477eb517aa904ce">k</a>, n=0, m=0, qsize = <a class="code" href="wp__block_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> &gt;&gt; 3;</div>
<div class="line">        <span class="keywordtype">int</span> counter=0;</div>
<div class="line">        <span class="keywordtype">int</span> r=0;</div>
<div class="line">        <a class="code" href="structbignum__ctx.html">BN_CTX</a> *ctx=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structenv__md__ctx__st.html">EVP_MD_CTX</a> mctx;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>=2;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="digest_8c.html#afe58145aa88a8ee187d858c762c00399">EVP_MD_CTX_init</a>(&amp;mctx);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OPENSSL_FIPS</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>(FIPS_selftest_failed())</div>
<div class="line">            {</div>
<div class="line">            <a class="code" href="err_8h.html#a6f758a749ea0b53a3ee1baf7da54a8f2">FIPSerr</a>(FIPS_F_DSA_BUILTIN_PARAMGEN2,</div>
<div class="line">                    FIPS_R_FIPS_SELFTEST_FAILED);</div>
<div class="line">            <span class="keywordflow">goto</span> err;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!fips_check_dsa_prng(ret, L, <a class="code" href="wp__block_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> (evpmd == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="wp__block_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> == 160)</div>
<div class="line">                        evpmd = <a class="code" href="evp_8h.html#aa090d659a494a10525e38d272efb01ae">EVP_sha1</a>();</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="wp__block_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> == 224)</div>
<div class="line">                        evpmd = <a class="code" href="evp_8h.html#a65f23037490a459c3ca7ba4cdd25865a">EVP_sha224</a>();</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        evpmd = <a class="code" href="evp_8h.html#afe55e56742a9b9ecffdaef7e95a6707a">EVP_sha256</a>();</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        mdsize = <a class="code" href="evp_8h.html#a92b0c8495dda84f0c60ae8271657c497">M_EVP_MD_size</a>(evpmd);</div>
<div class="line">        <span class="comment">/* If unverificable g generation only don&#39;t need seed */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a> || !ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a> || idx &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (seed_len == 0)</div>
<div class="line">                        seed_len = mdsize;</div>
<div class="line"></div>
<div class="line">                seed = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(seed_len);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (seed_out)</div>
<div class="line">                        seed_tmp = seed_out;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        seed_tmp = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(seed_len);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (!seed || !seed_tmp)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (seed_in)</div>
<div class="line">                        memcpy(seed, seed_in, seed_len);</div>
<div class="line"></div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((ctx=<a class="code" href="bn_8h.html#a04a38b774caf5e9bb7dea8b22c6eddc2">BN_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((mont=<a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        r0 = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        g = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        W = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        X = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        c = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        test = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* if p, q already supplied generate g only */</span></div>
<div class="line">        <span class="keywordflow">if</span> (ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a> &amp;&amp; ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>)</div>
<div class="line">                {</div>
<div class="line">                p = ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>;</div>
<div class="line">                q = ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (idx &gt;= 0)</div>
<div class="line">                        memcpy(seed_tmp, seed, seed_len);</div>
<div class="line">                <span class="keywordflow">goto</span> g_only;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                p = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">                q = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(test,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>(),L-1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (;;) <span class="comment">/* find q */</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pmd;</div>
<div class="line">                        <span class="comment">/* step 1 */</span></div>
<div class="line">                        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 0, m++))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">if</span> (!seed_in)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (<a class="code" href="rand_8h.html#a8a4e911a9be281eb797faa8590637ac3">RAND_pseudo_bytes</a>(seed, seed_len) &lt; 0)</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="comment">/* step 2 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#aaf1dcfa403148677376101633deb9025">EVP_Digest</a>(seed, seed_len, md, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, evpmd, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="comment">/* Take least significant bits of md */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (mdsize &gt; qsize)</div>
<div class="line">                                pmd = md + mdsize - qsize;</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                pmd = md;</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">if</span> (mdsize &lt; qsize)</div>
<div class="line">                                memset(md + mdsize, 0, qsize - mdsize);</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 3 */</span></div>
<div class="line">                        pmd[0] |= 0x80;</div>
<div class="line">                        pmd[qsize-1] |= 0x01;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9ca9a524bd4c4de12ae0947872c5182b">BN_bin2bn</a>(pmd, qsize, q))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 4 */</span></div>
<div class="line">                        r = <a class="code" href="bn_8h.html#a9a6f34fa218fe1250fe77ace1a38e37b">BN_is_prime_fasttest_ex</a>(q, <a class="code" href="dsa_8h.html#a21c5a2e2f8ba866514471ecfaa49cc3f">DSS_prime_checks</a>, ctx,</div>
<div class="line">                                        seed_in ? 1 : 0, cb);</div>
<div class="line">                        <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (r != 0)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="comment">/* Provided seed didn&#39;t produce a prime: error */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (seed_in)</div>
<div class="line">                                {</div>
<div class="line">                                ok = 0;</div>
<div class="line">                                <a class="code" href="err_8h.html#a97e6e6a59b842d7f28085b22dc191c99">DSAerr</a>(<a class="code" href="dsa_8h.html#a1ebfc7c986881a781bab2ccb0908eaae">DSA_F_DSA_BUILTIN_PARAMGEN2</a>, <a class="code" href="dsa_8h.html#a8dc91056acd8b035416e7cc506fc1357">DSA_R_Q_NOT_PRIME</a>);</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* do a callback call */</span></div>
<div class="line">                        <span class="comment">/* step 5 */</span></div>
<div class="line">                        }</div>
<div class="line">                <span class="comment">/* Copy seed to seed_out before we mess with it */</span></div>
<div class="line">                <span class="keywordflow">if</span> (seed_out)</div>
<div class="line">                        memcpy(seed_out, seed, seed_len);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 2, 0)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 3, 0)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* step 6 */</span></div>
<div class="line">                counter=0;</div>
<div class="line">                <span class="comment">/* &quot;offset = 1&quot; */</span></div>
<div class="line"></div>
<div class="line">                n=(L-1)/(mdsize &lt;&lt; 3);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (;;)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> ((counter != 0) &amp;&amp; !<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 0, counter))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 7 */</span></div>
<div class="line">                        <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(W);</div>
<div class="line">                        <span class="comment">/* now &#39;buf&#39; contains &quot;SEED + offset - 1&quot; */</span></div>
<div class="line">                        <span class="keywordflow">for</span> (k=0; k&lt;=n; k++)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="comment">/* obtain &quot;SEED + offset + k&quot; by incrementing: */</span></div>
<div class="line">                                <span class="keywordflow">for</span> (i = seed_len-1; i &gt;= 0; i--)</div>
<div class="line">                                        {</div>
<div class="line">                                        seed[i]++;</div>
<div class="line">                                        <span class="keywordflow">if</span> (seed[i] != 0)</div>
<div class="line">                                                <span class="keywordflow">break</span>;</div>
<div class="line">                                        }</div>
<div class="line"></div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#aaf1dcfa403148677376101633deb9025">EVP_Digest</a>(seed, seed_len, md ,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, evpmd,</div>
<div class="line">                                                                        <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                                <span class="comment">/* step 8 */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9ca9a524bd4c4de12ae0947872c5182b">BN_bin2bn</a>(md, mdsize, r0))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(r0,r0,(mdsize &lt;&lt; 3)*k)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(W,W,r0)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* more of step 8 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#afef0313695959acb28432e718486d02e">BN_mask_bits</a>(W,L-1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(X,W)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(X,X,test)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 9 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad186a71ba4368527796f30db0b205e47">BN_lshift1</a>(r0,q)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a4f1447a894029080d727d6c9a051de58">BN_mod</a>(c,X,r0,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(r0,c,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(p,X,r0)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 10 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ac18ade9dbb4531d8cc3a38d3c970c0e0">BN_cmp</a>(p,test) &gt;= 0)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="comment">/* step 11 */</span></div>
<div class="line">                                r = <a class="code" href="bn_8h.html#a9a6f34fa218fe1250fe77ace1a38e37b">BN_is_prime_fasttest_ex</a>(p, <a class="code" href="dsa_8h.html#a21c5a2e2f8ba866514471ecfaa49cc3f">DSS_prime_checks</a>,</div>
<div class="line">                                                ctx, 1, cb);</div>
<div class="line">                                <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line">                                                <span class="keywordflow">goto</span> end; <span class="comment">/* found it */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (r != 0)</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 13 */</span></div>
<div class="line">                        counter++;</div>
<div class="line">                        <span class="comment">/* &quot;offset = offset + n + 1&quot; */</span></div>
<div class="line"></div>
<div class="line">                        <span class="comment">/* step 14 */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (counter &gt;= (<span class="keywordtype">int</span>)(4 * L)) <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (seed_in)</div>
<div class="line">                        {</div>
<div class="line">                        ok = 0;</div>
<div class="line">                        <a class="code" href="err_8h.html#a97e6e6a59b842d7f28085b22dc191c99">DSAerr</a>(<a class="code" href="dsa_8h.html#a1ebfc7c986881a781bab2ccb0908eaae">DSA_F_DSA_BUILTIN_PARAMGEN2</a>, <a class="code" href="dsa_8h.html#ae03398a971bb322fe57f7c77f6c9656c">DSA_R_INVALID_PARAMETERS</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">end:</div>
<div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 2, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        g_only:</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* We now need to generate g */</span></div>
<div class="line">        <span class="comment">/* Set r0=(p-1)/q */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab92d8598888aa744c770a7656507a299">BN_sub</a>(test,p,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2d806f97ad6b75e85e001d781090eb0">BN_div</a>(r0,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,test,q,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (idx &lt; 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae9b1fc316ffc1825cb8547ba169631b6">BN_set_word</a>(test,h))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                h = 1;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont,p,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#a58e3256d1dfbe507f6cd261a1145ab19">__fips_constseg</a></div>
<div class="line">                <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ggen[4] = {0x67,0x67,0x65,0x6e};</div>
<div class="line">                <span class="keywordflow">if</span> (idx &gt;= 0)</div>
<div class="line">                        {</div>
<div class="line">                        md[0] = idx &amp; 0xff;</div>
<div class="line">                        md[1] = (h &gt;&gt; 8) &amp; 0xff;</div>
<div class="line">                        md[2] = h &amp; 0xff;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#a039cce8e234ebef1284710b019075ddc">EVP_DigestInit_ex</a>(&amp;mctx, evpmd, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#a1886b261d05d3ee8866f5ccf92184552">EVP_DigestUpdate</a>(&amp;mctx, seed_tmp, seed_len))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#a1886b261d05d3ee8866f5ccf92184552">EVP_DigestUpdate</a>(&amp;mctx, ggen, <span class="keyword">sizeof</span>(ggen)))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#a1886b261d05d3ee8866f5ccf92184552">EVP_DigestUpdate</a>(&amp;mctx, md, 3))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="digest_8c.html#a3c3bec018dd4bdf73a3f14d27ea9b718">EVP_DigestFinal_ex</a>(&amp;mctx, md, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9ca9a524bd4c4de12ae0947872c5182b">BN_bin2bn</a>(md, mdsize, test))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="comment">/* g=test^r0%p */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a47220794c064f6df0ef0aae54e2ed68f">BN_mod_exp_mont</a>(g,test,r0,p,ctx,mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ab1f2aa49c798c0f21b01899e8d562ee7">BN_is_one</a>(g)) <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">if</span> (idx &lt; 0 &amp;&amp; !<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(test,test,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>())) <span class="keywordflow">goto</span> err;</div>
<div class="line">                h++;</div>
<div class="line">                <span class="keywordflow">if</span> ( idx &gt;= 0 &amp;&amp; h &gt; 0xffff)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="bn_8h.html#a38d693e1b6ac69e6a1a2862641b19825">BN_GENCB_call</a>(cb, 3, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        ok=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> (ok == 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (p != ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>);</div>
<div class="line">                        ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(p);</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (q != ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>);</div>
<div class="line">                        ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(q);</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>) <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>);</div>
<div class="line">                ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>=<a class="code" href="bn_8h.html#a2301c52856e55cb85af5d72ba4d8813a">BN_dup</a>(g);</div>
<div class="line">                <span class="keywordflow">if</span> (ret-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || ret-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || ret-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a> == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        ok=-1;</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (counter_ret != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) *counter_ret=counter;</div>
<div class="line">                <span class="keywordflow">if</span> (h_ret != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) *h_ret=<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (seed)</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(seed);</div>
<div class="line">        <span class="keywordflow">if</span> (seed_out != seed_tmp)</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(seed_tmp);</div>
<div class="line">        <span class="keywordflow">if</span>(ctx)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">                <a class="code" href="bn_8h.html#a92238db5c582bc055f4aa86a5cddb247">BN_CTX_free</a>(ctx);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <a class="code" href="digest_8c.html#ac6c8c38d6c8e3e274c9a974792b8342d">EVP_MD_CTX_cleanup</a>(&amp;mctx);</div>
<div class="line">        <span class="keywordflow">return</span> ok;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a394a9bb0530f1adf9500e312224e20a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DSA_generate_parameters_ex </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *&#160;</td>
          <td class="paramname"><em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>seed_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>seed_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>counter_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>h_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#ae122a8be18f4fe821e5389381ececa09">BN_GENCB</a> *&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00091">91</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structdsa__st.html#af5e872d3d77bbba895b6b917f1a71d3a">meth</a>-&gt;<a class="code" href="structdsa__method.html#a2d1756a2b8ea243ada7f5c2cd5144152">dsa_paramgen</a>)</div>
<div class="line">                <span class="keywordflow">return</span> ret-&gt;<a class="code" href="structdsa__st.html#af5e872d3d77bbba895b6b917f1a71d3a">meth</a>-&gt;<a class="code" href="structdsa__method.html#a2d1756a2b8ea243ada7f5c2cd5144152">dsa_paramgen</a>(ret, <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>, seed_in, seed_len,</div>
<div class="line">                                counter_ret, h_ret, cb);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="structenv__md__st.html">EVP_MD</a> *evpmd;</div>
<div class="line">                <span class="keywordtype">size_t</span> qbits = <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> &gt;= 2048 ? 256 : 160;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a> &gt;= 2048)</div>
<div class="line">                        {</div>
<div class="line">                        qbits = 256;</div>
<div class="line">                        evpmd = <a class="code" href="evp_8h.html#afe55e56742a9b9ecffdaef7e95a6707a">EVP_sha256</a>();</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        {</div>
<div class="line">                        qbits = 160;</div>
<div class="line">                        evpmd = <a class="code" href="evp_8h.html#aa090d659a494a10525e38d272efb01ae">EVP_sha1</a>();</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="dh__pmeth_8c.html#a8c8b2381bb9b9444293152b685ed8fed">dsa_builtin_paramgen</a>(ret, <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>, qbits, evpmd,</div>
<div class="line">                        seed_in, seed_len, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, counter_ret, h_ret, cb);</div>
<div class="line">                }</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a19ea65a4f63b7382a4166d9128dec09e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsa_paramgen_check_g </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa26536f205a5c5f39111260bf246ed9d">DSA</a> *&#160;</td>
          <td class="paramname"><em>dsa</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dsa__gen_8c_source.html#l00770">770</a> of file <a class="el" href="dsa__gen_8c_source.html">dsa_gen.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structbignum__ctx.html">BN_CTX</a> *ctx;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *tmp;</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> rv = -1;</div>
<div class="line">        ctx = <a class="code" href="bn_8h.html#a04a38b774caf5e9bb7dea8b22c6eddc2">BN_CTX_new</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!ctx)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ac18ade9dbb4531d8cc3a38d3c970c0e0">BN_cmp</a>(dsa-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>, <a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>()) &lt;= 0)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ac18ade9dbb4531d8cc3a38d3c970c0e0">BN_cmp</a>(dsa-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>, dsa-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>) &gt;= 0)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        tmp = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (!tmp)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> ((mont=<a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont,dsa-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>,ctx))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="comment">/* Work out g^q mod p */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a47220794c064f6df0ef0aae54e2ed68f">BN_mod_exp_mont</a>(tmp,dsa-&gt;<a class="code" href="structdsa__st.html#af5ec97a996fd695c0186eb5a9a2b0b38">g</a>,dsa-&gt;<a class="code" href="structdsa__st.html#ab0cae8e320e604e2f4d18066bb02a097">q</a>, dsa-&gt;<a class="code" href="structdsa__st.html#a63246fbe0fc27945bd32765e5538a1a6">p</a>, ctx, mont))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ac18ade9dbb4531d8cc3a38d3c970c0e0">BN_cmp</a>(tmp, <a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>()))</div>
<div class="line">                rv = 1;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                rv = 0;</div>
<div class="line">        err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (mont)</div>
<div class="line">                <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <a class="code" href="bn_8h.html#a92238db5c582bc055f4aa86a5cddb247">BN_CTX_free</a>(ctx);</div>
<div class="line">        <span class="keywordflow">return</span> rv;</div>
<div class="line"></div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 15 2014 18:16:51 for openssl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
