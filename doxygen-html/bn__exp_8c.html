<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/bn/bn_exp.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_bf4984ea57f5888de95a64cb80bbf1fb.html">bn</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">bn_exp.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bn__lcl_8h_source.html">bn_lcl.h</a>&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
</div>
<p><a href="bn__exp_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a099e2c772dcc3de688ce53772001b364"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a099e2c772dcc3de688ce53772001b364">OPENSSL_FIPSAPI</a></td></tr>
<tr class="memitem:a032503e76d6f69bc67e99e909c8125da"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a032503e76d6f69bc67e99e909c8125da">TABLE_SIZE</a>&#160;&#160;&#160;32</td></tr>
<tr class="memitem:ab9d4110662c0f3a2c71bfb0ec828e43e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#ab9d4110662c0f3a2c71bfb0ec828e43e">MONT_MUL_MOD</a></td></tr>
<tr class="memitem:a59dc42586a132677c3eadf4bff966d9d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a59dc42586a132677c3eadf4bff966d9d">MONT_EXP_WORD</a></td></tr>
<tr class="memitem:af3bc0ac77dd585ae06ff7f8caa239c46"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#af3bc0ac77dd585ae06ff7f8caa239c46">RECP_MUL_MOD</a></td></tr>
<tr class="memitem:ad2c4224b65d094651e81dfab87005e47"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#ad2c4224b65d094651e81dfab87005e47">MOD_EXP_CTIME_ALIGN</a>(x_)&#160;&#160;&#160;((unsigned char*)(x_) + (<a class="el" href="bn__lcl_8h.html#a29607830d47d3a901f79b940bee73fbc">MOD_EXP_CTIME_MIN_CACHE_LINE_WIDTH</a> - (((size_t)(x_)) &amp; (<a class="el" href="bn__lcl_8h.html#a726a5a0accf869e3d891e375ea383d2b">MOD_EXP_CTIME_MIN_CACHE_LINE_MASK</a>))))</td></tr>
<tr class="memitem:acc368638df06b0865c95edeac1f4e62a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#acc368638df06b0865c95edeac1f4e62a">BN_MOD_MUL_WORD</a>(r, w, m)</td></tr>
<tr class="memitem:aba83c6a8e78852124e766e9dc5812933"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#aba83c6a8e78852124e766e9dc5812933">BN_TO_MONTGOMERY_WORD</a>(r, w, mont)&#160;&#160;&#160;(<a class="el" href="bn__lib_8c.html#ae9b1fc316ffc1825cb8547ba169631b6">BN_set_word</a>(r, (w)) &amp;&amp; <a class="el" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(r, r, (mont), ctx))</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1a5f515f2a05e4bcf2ae07b86b8c2ce8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a1a5f515f2a05e4bcf2ae07b86b8c2ce8">BN_exp</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *r, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:a4624503e0c5a02a37708ecd62734727c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a4624503e0c5a02a37708ecd62734727c">BN_mod_exp</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *r, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:a5c15da80c8847b4a2d85e6e2f343f8c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a5c15da80c8847b4a2d85e6e2f343f8c2">BN_mod_exp_recp</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *r, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:aa9b204dbce6358c0ce3fe47d83764bfe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#aa9b204dbce6358c0ce3fe47d83764bfe">BN_mod_exp_mont</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *rr, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *in_mont)</td></tr>
<tr class="memitem:ac4b4219879ef78064dce04a0d3f878b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#ac4b4219879ef78064dce04a0d3f878b5">BN_mod_exp_mont_consttime</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *rr, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *in_mont)</td></tr>
<tr class="memitem:a497e0d82713e2e9e3919a68f744bd49e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a497e0d82713e2e9e3919a68f744bd49e">BN_mod_exp_mont_word</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *rr, BN_ULONG <a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *in_mont)</td></tr>
<tr class="memitem:a424f046eb1b37786478ace51c6e97ae2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__exp_8c.html#a424f046eb1b37786478ace51c6e97ae2">BN_mod_exp_simple</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *r, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *p, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *m, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
</table>
<h2>Macro Definition Documentation</h2>
<a class="anchor" id="acc368638df06b0865c95edeac1f4e62a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BN_MOD_MUL_WORD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">r, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">w, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">m&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(<a class="code" href="bn_8h.html#a31b6dc4a21e60b83f57b0af84905de69">BN_mul_word</a>(r, (w)) &amp;&amp; \</div>
<div class="line">                (<span class="comment">/* BN_ucmp(r, (m)) &lt; 0 ? 1 :*/</span>  \</div>
<div class="line">                        (<a class="code" href="bn_8h.html#a4f1447a894029080d727d6c9a051de58">BN_mod</a>(<a class="code" href="asn1_8h.html#a3d54702d866c88bc4b3a88e68fb986d9">t</a>, r, m, ctx) &amp;&amp; (swap_tmp = r, r = <a class="code" href="asn1_8h.html#a3d54702d866c88bc4b3a88e68fb986d9">t</a>, <a class="code" href="asn1_8h.html#a3d54702d866c88bc4b3a88e68fb986d9">t</a> = swap_tmp, 1))))</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aba83c6a8e78852124e766e9dc5812933"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BN_TO_MONTGOMERY_WORD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">r, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">w, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mont&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(<a class="el" href="bn__lib_8c.html#ae9b1fc316ffc1825cb8547ba169631b6">BN_set_word</a>(r, (w)) &amp;&amp; <a class="el" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(r, r, (mont), ctx))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ad2c4224b65d094651e81dfab87005e47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MOD_EXP_CTIME_ALIGN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x_</td><td>)</td>
          <td>&#160;&#160;&#160;((unsigned char*)(x_) + (<a class="el" href="bn__lcl_8h.html#a29607830d47d3a901f79b940bee73fbc">MOD_EXP_CTIME_MIN_CACHE_LINE_WIDTH</a> - (((size_t)(x_)) &amp; (<a class="el" href="bn__lcl_8h.html#a726a5a0accf869e3d891e375ea383d2b">MOD_EXP_CTIME_MIN_CACHE_LINE_MASK</a>))))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00632">632</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a59dc42586a132677c3eadf4bff966d9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MONT_EXP_WORD</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab9d4110662c0f3a2c71bfb0ec828e43e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MONT_MUL_MOD</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a099e2c772dcc3de688ce53772001b364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPENSSL_FIPSAPI</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00112">112</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3bc0ac77dd585ae06ff7f8caa239c46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RECP_MUL_MOD</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a032503e76d6f69bc67e99e909c8125da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TABLE_SIZE&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00147">147</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a1a5f515f2a05e4bcf2ae07b86b8c2ce8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_exp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00150">150</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>,ret=0;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *v,*rr;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) != 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* BN_FLG_CONSTTIME only supported by BN_mod_exp_mont() */</span></div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#a9964be0e45994d58299171d209de6b9a">BN_F_BN_EXP</a>,<a class="code" href="err_8h.html#a684342cd58ce91d08c16257fbd165437">ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> ((r == a) || (r == p))</div>
<div class="line">                rr = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                rr = r;</div>
<div class="line">        v = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (rr == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || v == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(v,a) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">        bits=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ae53ace8862904c6eb7bcd58db7f1ecad">BN_is_odd</a>(p))</div>
<div class="line">                { <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(rr,a) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err; }</div>
<div class="line">        <span class="keywordflow">else</span>    { <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(rr)) <span class="keywordflow">goto</span> err; }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i=1; i&lt;<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>; i++)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ac1995ae74557a3177b6375dde9914cbc">BN_sqr</a>(v,v,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,i))</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a59c2fddbc3b4a0bdc548f08ee48f3af1">BN_mul</a>(rr,rr,v,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> (r != rr) <a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(r,rr);</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(r);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4624503e0c5a02a37708ecd62734727c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00194">194</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(a);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(p);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(m);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* For even modulus  m = 2^k*m_odd,  it might make sense to compute</span></div>
<div class="line"><span class="comment">         * a^p mod m_odd  and  a^p mod 2^k  separately (with Montgomery</span></div>
<div class="line"><span class="comment">         * exponentiation for the odd part), using appropriate exponent</span></div>
<div class="line"><span class="comment">         * reductions, and combine the results using the CRT.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * For now, we use Montgomery only if the modulus is odd; otherwise,</span></div>
<div class="line"><span class="comment">         * exponentiation using the reciprocal-based quick remaindering</span></div>
<div class="line"><span class="comment">         * algorithm is used.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * (Timing obtained with expspeed.c [computations  a^p mod m</span></div>
<div class="line"><span class="comment">         * where  a, p, m  are of the same length: 256, 512, 1024, 2048,</span></div>
<div class="line"><span class="comment">         * 4096, 8192 bits], compared to the running time of the</span></div>
<div class="line"><span class="comment">         * standard algorithm:</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         *   BN_mod_exp_mont   33 .. 40 %  [AMD K6-2, Linux, debug configuration]</span></div>
<div class="line"><span class="comment">         *                     55 .. 77 %  [UltraSparc processor, but</span></div>
<div class="line"><span class="comment">         *                                  debug-solaris-sparcv8-gcc conf.]</span></div>
<div class="line"><span class="comment">         * </span></div>
<div class="line"><span class="comment">         *   BN_mod_exp_recp   50 .. 70 %  [AMD K6-2, Linux, debug configuration]</span></div>
<div class="line"><span class="comment">         *                     62 .. 118 % [UltraSparc, debug-solaris-sparcv8-gcc]</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * On the Sparc, BN_mod_exp_recp was faster than BN_mod_exp_mont</span></div>
<div class="line"><span class="comment">         * at 2048 and more bits, but at 512 and 1024 bits, it was</span></div>
<div class="line"><span class="comment">         * slower even than the standard algorithm!</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * &quot;Real&quot; timings [linux-elf, solaris-sparcv9-gcc configurations]</span></div>
<div class="line"><span class="comment">         * should be obtained when the new Montgomery reduction code</span></div>
<div class="line"><span class="comment">         * has been integrated into OpenSSL.)</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MONT_MUL_MOD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MONT_EXP_WORD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RECP_MUL_MOD</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#ifdef MONT_MUL_MOD</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* I have finally been able to take out this pre-condition of</span></div>
<div class="line"><span class="comment">         * the top bit being set.  It was caused by an error in BN_div</span></div>
<div class="line"><span class="comment">         * with negatives.  There was also another problem when for a^b%m</span></div>
<div class="line"><span class="comment">         * a &gt;= m.  eay 07-May-97 */</span></div>
<div class="line"><span class="comment">/*      if ((m-&gt;d[m-&gt;top-1]&amp;BN_TBIT) &amp;&amp; BN_is_odd(m)) */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ae53ace8862904c6eb7bcd58db7f1ecad">BN_is_odd</a>(m))</div>
<div class="line">                {</div>
<div class="line"><span class="preprocessor">#  ifdef MONT_EXP_WORD</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> == 1 &amp;&amp; !a-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> &amp;&amp; (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) == 0))</div>
<div class="line">                        {</div>
<div class="line">                        BN_ULONG A = a-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0];</div>
<div class="line">                        ret=<a class="code" href="bn_8h.html#ad48028ae6474f62172778dbcd69d0662">BN_mod_exp_mont_word</a>(r,A,p,m,ctx,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#  endif</span></div>
<div class="line"><span class="preprocessor"></span>                        ret=<a class="code" href="bn_8h.html#a47220794c064f6df0ef0aae54e2ed68f">BN_mod_exp_mont</a>(r,a,p,m,ctx,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifdef RECP_MUL_MOD</span></div>
<div class="line"><span class="preprocessor"></span>                { ret=<a class="code" href="bn_8h.html#a5c15da80c8847b4a2d85e6e2f343f8c2">BN_mod_exp_recp</a>(r,a,p,m,ctx); }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                { ret=<a class="code" href="bn_8h.html#a424f046eb1b37786478ace51c6e97ae2">BN_mod_exp_simple</a>(r,a,p,m,ctx); }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(r);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa9b204dbce6358c0ce3fe47d83764bfe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp_mont </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>rr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>in_mont</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00402">402</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i,j,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>,ret=0,wstart,wend,window,wvalue;</div>
<div class="line">        <span class="keywordtype">int</span> start=1;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *d,*r;</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structbignum__st.html">BIGNUM</a> *aa;</div>
<div class="line">        <span class="comment">/* Table of variables obtained from &#39;ctx&#39; */</span></div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *val[<a class="code" href="bn__exp_8c.html#a032503e76d6f69bc67e99e909c8125da">TABLE_SIZE</a>];</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) != 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="bn_8h.html#ac4b4219879ef78064dce04a0d3f878b5">BN_mod_exp_mont_consttime</a>(rr, a, p, m, ctx, in_mont);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(a);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(p);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(m);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae53ace8862904c6eb7bcd58db7f1ecad">BN_is_odd</a>(m))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#a67c3393af37e1fa51d1b0d65500b2670">BN_F_BN_MOD_EXP_MONT</a>,<a class="code" href="bn_8h.html#a71312d677f2ff4c465e31b6e360ee196">BN_R_CALLED_WITH_EVEN_MODULUS</a>);</div>
<div class="line">                <span class="keywordflow">return</span>(0);</div>
<div class="line">                }</div>
<div class="line">        bits=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line">        <span class="keywordflow">if</span> (bits == 0)</div>
<div class="line">                {</div>
<div class="line">                ret = <a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(rr);</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        d = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        r = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        val[0] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (!d || !r || !val[0]) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If this is not done, things will break in the montgomery</span></div>
<div class="line"><span class="comment">         * part */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (in_mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                mont=in_mont;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((mont=<a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont,m,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> || <a class="code" href="bn_8h.html#ab1ae0b9d9dfc923356e8a05a9a5be89a">BN_ucmp</a>(a,m) &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a762a91b13a7ad118051f34eacac4e104">BN_nnmod</a>(val[0],a,m,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                aa= val[0];</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                aa=<a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a8adb5a8606dfd0354a4d93b85e3996ab">BN_is_zero</a>(aa))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(rr);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(val[0],aa,mont,ctx)) <span class="keywordflow">goto</span> err; <span class="comment">/* 1 */</span></div>
<div class="line"></div>
<div class="line">        window = <a class="code" href="bn__lcl_8h.html#aa960de98937dbcc97931def7af45e608">BN_window_bits_for_exponent_size</a>(bits);</div>
<div class="line">        <span class="keywordflow">if</span> (window &gt; 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(d,val[0],val[0],mont,ctx)) <span class="keywordflow">goto</span> err; <span class="comment">/* 2 */</span></div>
<div class="line">                j=1&lt;&lt;(window-1);</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;j; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span>(((val[i] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) ||</div>
<div class="line">                                        !<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(val[i],val[i-1],</div>
<div class="line">                                                d,mont,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        start=1;        <span class="comment">/* This is used to avoid multiplication etc</span></div>
<div class="line"><span class="comment">                         * when there is only the value &#39;1&#39; in the</span></div>
<div class="line"><span class="comment">                         * buffer. */</span></div>
<div class="line">        wvalue=0;       <span class="comment">/* The &#39;value&#39; of the window */</span></div>
<div class="line">        wstart=bits-1;  <span class="comment">/* The top bit of the window */</span></div>
<div class="line">        wend=0;         <span class="comment">/* The bottom bit of the window */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 1   </span><span class="comment">/* by Shay Gueron&#39;s suggestion */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>        j = m-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>;     <span class="comment">/* borrow j */</span></div>
<div class="line">        <span class="keywordflow">if</span> (m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[j-1] &amp; (((BN_ULONG)1)&lt;&lt;(BN_BITS2-1)))</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a15094251b9047bc54ef42c702e65ce86">bn_wexpand</a>(r,j) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="comment">/* 2^(top*BN_BITS2) - m */</span></div>
<div class="line">                r-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] = (0-m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0])&amp;BN_MASK2;</div>
<div class="line">                <span class="keywordflow">for</span>(i=1;i&lt;j;i++) r-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i] = (~m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i])&amp;BN_MASK2;</div>
<div class="line">                r-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = j;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(r,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>(),mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart) == 0)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!start)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(r,r,r,mont,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        wstart--;</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                        }</div>
<div class="line">                <span class="comment">/* We now have wstart on a &#39;set&#39; bit, we now need to work out</span></div>
<div class="line"><span class="comment">                 * how bit a window to do.  To do this we need to scan</span></div>
<div class="line"><span class="comment">                 * forward until the last set bit before the end of the</span></div>
<div class="line"><span class="comment">                 * window */</span></div>
<div class="line">                j=wstart;</div>
<div class="line">                wvalue=1;</div>
<div class="line">                wend=0;</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;window; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart-i &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart-i))</div>
<div class="line">                                {</div>
<div class="line">                                wvalue&lt;&lt;=(i-wend);</div>
<div class="line">                                wvalue|=1;</div>
<div class="line">                                wend=i;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* wend is the size of the current window */</span></div>
<div class="line">                j=wend+1;</div>
<div class="line">                <span class="comment">/* add the &#39;bytes above&#39; */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!start)</div>
<div class="line">                        <span class="keywordflow">for</span> (i=0; i&lt;j; i++)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(r,r,r,mont,ctx))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                </div>
<div class="line">                <span class="comment">/* wvalue will be an odd number &lt; 2^window */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(r,r,val[wvalue&gt;&gt;1],mont,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* move the &#39;window&#39; down further */</span></div>
<div class="line">                wstart-=wend+1;</div>
<div class="line">                wvalue=0;</div>
<div class="line">                start=0;</div>
<div class="line">                <span class="keywordflow">if</span> (wstart &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#if defined(SPARC_T4_MONT)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="sparcv9cap_8c.html#af66a59e32f10d874a7c9452bf38c8109">OPENSSL_sparcv9cap_P</a>[0]&amp;(<a class="code" href="sparc__arch_8h.html#a811b561515ed6fba484302214c3089c9">SPARCV9_VIS3</a>|<a class="code" href="sparc__arch_8h.html#a3b9cab60f5c1f117a93487d932952aa8">SPARCV9_PREFER_FPU</a>))</div>
<div class="line">                {</div>
<div class="line">                j = mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>;        <span class="comment">/* borrow j */</span></div>
<div class="line">                val[0]-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] = 1;       <span class="comment">/* borrow val[0] */</span></div>
<div class="line">                <span class="keywordflow">for</span> (i=1;i&lt;j;i++) val[0]-&gt;d[i] = 0;</div>
<div class="line">                val[0]-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = j;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(rr,r,val[0],mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9977c9c5f9a09f4f2802b5ef8edae9ad">BN_from_montgomery</a>(rr,r,mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> ((in_mont == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) &amp;&amp; (mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)) <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(rr);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac4b4219879ef78064dce04a0d3f878b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp_mont_consttime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>rr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>in_mont</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00641">641</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>,ret=0,window,wvalue;</div>
<div class="line">        <span class="keywordtype">int</span> top;</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> numPowers;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *powerbufFree=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> powerbufLen = 0;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *powerbuf=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> tmp, am;</div>
<div class="line"><span class="preprocessor">#if defined(SPARC_T4_MONT)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t4=0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(a);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(p);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(m);</div>
<div class="line"></div>
<div class="line">        top = m-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!(m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] &amp; 1))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#af8ca54b6055bf3e3973569effcc48f0d">BN_F_BN_MOD_EXP_MONT_CONSTTIME</a>,<a class="code" href="bn_8h.html#a71312d677f2ff4c465e31b6e360ee196">BN_R_CALLED_WITH_EVEN_MODULUS</a>);</div>
<div class="line">                <span class="keywordflow">return</span>(0);</div>
<div class="line">                }</div>
<div class="line">        bits=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line">        <span class="keywordflow">if</span> (bits == 0)</div>
<div class="line">                {</div>
<div class="line">                ret = <a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(rr);</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Allocate a montgomery context if it was not supplied by the caller.</span></div>
<div class="line"><span class="comment">         * If this is not done, things will break in the montgomery part.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (in_mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                mont=in_mont;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((mont=<a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont,m,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef RSAZ_ENABLED</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * If the size of the operands allow it, perform the optimized</span></div>
<div class="line"><span class="comment">         * RSAZ exponentiation. For further information see</span></div>
<div class="line"><span class="comment">         * crypto/bn/rsaz_exp.c and accompanying assembly modules.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (((OPENSSL_ia32cap_P[2]&amp;0x80100) != 0x80100) <span class="comment">/* check for MULX/AD*X */</span></div>
<div class="line">            &amp;&amp; (16 == a-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>) &amp;&amp; (16 == p-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>) &amp;&amp; (<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(m) == 1024)</div>
<div class="line">            &amp;&amp; <a class="code" href="rsaz__exp_8h.html#aba03ecea443b8d6bef6bf89712e28bbe">rsaz_avx2_eligible</a>())</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> == <a class="code" href="bn_8h.html#a15094251b9047bc54ef42c702e65ce86">bn_wexpand</a>(rr, 16)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <a class="code" href="rsaz__exp_8c.html#a24d3a229ad49706963831d4157eea4d0">RSAZ_1024_mod_exp_avx2</a>(rr-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, a-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, p-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0]);</div>
<div class="line">                rr-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = 16;</div>
<div class="line">                rr-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> = 0;</div>
<div class="line">                <a class="code" href="bn_8h.html#ac7cda4cbe7c292e7acbc0e66d7f45364">bn_correct_top</a>(rr);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((8 == a-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>) &amp;&amp; (8 == p-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>) &amp;&amp; (<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(m) == 512))</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> == <a class="code" href="bn_8h.html#a15094251b9047bc54ef42c702e65ce86">bn_wexpand</a>(rr,8)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <a class="code" href="rsaz__exp_8c.html#a93d294ca8b69c825a1a635f186348415">RSAZ_512_mod_exp</a>(rr-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, a-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, p-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0], mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>);</div>
<div class="line">                rr-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = 8;</div>
<div class="line">                rr-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> = 0;</div>
<div class="line">                <a class="code" href="bn_8h.html#ac7cda4cbe7c292e7acbc0e66d7f45364">bn_correct_top</a>(rr);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="comment">/* Get the window size to use with size of p. */</span></div>
<div class="line">        window = <a class="code" href="bn__lcl_8h.html#aee2cc22cc63679eb7b0d04d3ac3a5d31">BN_window_bits_for_ctime_exponent_size</a>(bits);</div>
<div class="line"><span class="preprocessor">#if defined(SPARC_T4_MONT)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (window&gt;=5 &amp;&amp; (top&amp;15)==0 &amp;&amp; top&lt;=64 &amp;&amp;</div>
<div class="line">            (<a class="code" href="sparcv9cap_8c.html#af66a59e32f10d874a7c9452bf38c8109">OPENSSL_sparcv9cap_P</a>[1]&amp;(<a class="code" href="sparc__arch_8h.html#a1f83bc04d8b5081aae686209f1216751">CFR_MONTMUL</a>|<a class="code" href="sparc__arch_8h.html#a7d14e8a815cad95bf947fe4b628218a1">CFR_MONTSQR</a>))==</div>
<div class="line">                                     (<a class="code" href="sparc__arch_8h.html#a1f83bc04d8b5081aae686209f1216751">CFR_MONTMUL</a>|<a class="code" href="sparc__arch_8h.html#a7d14e8a815cad95bf947fe4b628218a1">CFR_MONTSQR</a>) &amp;&amp;</div>
<div class="line">            (t4=<a class="code" href="sparcv9cap_8c.html#af66a59e32f10d874a7c9452bf38c8109">OPENSSL_sparcv9cap_P</a>[0]))</div>
<div class="line">                window=5;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if defined(OPENSSL_BN_ASM_MONT5)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (window&gt;=5)</div>
<div class="line">                {</div>
<div class="line">                window=5;       <span class="comment">/* ~5% improvement for RSA2048 sign, and even for RSA4096 */</span></div>
<div class="line">                <span class="keywordflow">if</span> ((top&amp;7)==0) powerbufLen += 2*top*<span class="keyword">sizeof</span>(m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0]);</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        (void)0;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Allocate a buffer large enough to hold all of the pre-computed</span></div>
<div class="line"><span class="comment">         * powers of am, am itself and tmp.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        numPowers = 1 &lt;&lt; window;</div>
<div class="line">        powerbufLen += <span class="keyword">sizeof</span>(m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0])*(top*numPowers +</div>
<div class="line">                                ((2*top)&gt;numPowers?(2*top):numPowers));</div>
<div class="line"><span class="preprocessor">#ifdef alloca</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (powerbufLen &lt; 3072)</div>
<div class="line">                powerbufFree = alloca(powerbufLen+<a class="code" href="bn__lcl_8h.html#a29607830d47d3a901f79b940bee73fbc">MOD_EXP_CTIME_MIN_CACHE_LINE_WIDTH</a>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> ((powerbufFree=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(powerbufLen+<a class="code" href="bn__lcl_8h.html#a29607830d47d3a901f79b940bee73fbc">MOD_EXP_CTIME_MIN_CACHE_LINE_WIDTH</a>)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                </div>
<div class="line">        powerbuf = <a class="code" href="bn__exp_8c.html#ad2c4224b65d094651e81dfab87005e47">MOD_EXP_CTIME_ALIGN</a>(powerbufFree);</div>
<div class="line">        memset(powerbuf, 0, powerbufLen);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef alloca</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (powerbufLen &lt; 3072)</div>
<div class="line">                powerbufFree = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="comment">/* lay down tmp and am right after powers table */</span></div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>     = (BN_ULONG *)(powerbuf + <span class="keyword">sizeof</span>(m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0])*top*numPowers);</div>
<div class="line">        am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>      = tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a> + top;</div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>   = am.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>  = 0;</div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#adc321f2d3b6d3962fda140080275267c">dmax</a>  = am.<a class="code" href="structbignum__st.html#adc321f2d3b6d3962fda140080275267c">dmax</a> = top;</div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>   = am.<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>  = 0;</div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#a7ab1fc90f994e4428dbf1f354cbc82b4">flags</a> = am.<a class="code" href="structbignum__st.html#a7ab1fc90f994e4428dbf1f354cbc82b4">flags</a> = <a class="code" href="bn_8h.html#ae32355ce26c7a72424f52f6ae5358816">BN_FLG_STATIC_DATA</a>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* prepare a^0 in Montgomery domain */</span></div>
<div class="line"><span class="preprocessor">#if 1   </span><span class="comment">/* by Shay Gueron&#39;s suggestion */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[top-1] &amp; (((BN_ULONG)1)&lt;&lt;(BN_BITS2-1)))</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* 2^(top*BN_BITS2) - m */</span></div>
<div class="line">                tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] = (0-m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0])&amp;BN_MASK2;</div>
<div class="line">                <span class="keywordflow">for</span> (i=1;i&lt;top;i++) tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i] = (~m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i])&amp;BN_MASK2;</div>
<div class="line">                tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = top;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(&amp;tmp,<a class="code" href="bn_8h.html#a1f56e9f96a6739ab518cc75e4c374ac4">BN_value_one</a>(),mont,ctx))    <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* prepare a^1 in Montgomery domain */</span></div>
<div class="line">        <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> || <a class="code" href="bn_8h.html#ab1ae0b9d9dfc923356e8a05a9a5be89a">BN_ucmp</a>(a,m) &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a4f1447a894029080d727d6c9a051de58">BN_mod</a>(&amp;am,a,m,ctx))                       <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(&amp;am,&amp;am,mont,ctx))        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span>    <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a39ad99470fa9cd1f3765aec5cb0789ba">BN_to_montgomery</a>(&amp;am,a,mont,ctx))          <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(SPARC_T4_MONT)</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (t4)</div>
<div class="line">        {</div>
<div class="line">        <span class="keyword">typedef</span> int (*bn_pwr5_mont_f)(BN_ULONG *tp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keywordtype">int</span> power,<span class="keywordtype">int</span> <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>);</div>
<div class="line">        <span class="keywordtype">int</span> bn_pwr5_mont_t4_8(BN_ULONG *tp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keywordtype">int</span> power,<span class="keywordtype">int</span> bits);</div>
<div class="line">        <span class="keywordtype">int</span> bn_pwr5_mont_t4_16(BN_ULONG *tp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keywordtype">int</span> power,<span class="keywordtype">int</span> bits);</div>
<div class="line">        <span class="keywordtype">int</span> bn_pwr5_mont_t4_24(BN_ULONG *tp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keywordtype">int</span> power,<span class="keywordtype">int</span> bits);</div>
<div class="line">        <span class="keywordtype">int</span> bn_pwr5_mont_t4_32(BN_ULONG *tp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keywordtype">int</span> power,<span class="keywordtype">int</span> bits);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> bn_pwr5_mont_f pwr5_funcs[4] = {</div>
<div class="line">                        bn_pwr5_mont_t4_8,      bn_pwr5_mont_t4_16,</div>
<div class="line">                        bn_pwr5_mont_t4_24,     bn_pwr5_mont_t4_32 };</div>
<div class="line">        bn_pwr5_mont_f pwr5_worker = pwr5_funcs[top/16-1];</div>
<div class="line"></div>
<div class="line">        <span class="keyword">typedef</span> int (*bn_mul_mont_f)(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="conf_8h.html#a8f12a78fdc053e4143bc0896f8b3d937">bp</a>,<span class="keyword">const</span> BN_ULONG *np,<span class="keyword">const</span> BN_ULONG *n0);</div>
<div class="line">        <span class="keywordtype">int</span> bn_mul_mont_t4_8(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,<span class="keyword">const</span> BN_ULONG *n0);</div>
<div class="line">        <span class="keywordtype">int</span> bn_mul_mont_t4_16(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,<span class="keyword">const</span> BN_ULONG *n0);</div>
<div class="line">        <span class="keywordtype">int</span> bn_mul_mont_t4_24(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,<span class="keyword">const</span> BN_ULONG *n0);</div>
<div class="line">        <span class="keywordtype">int</span> bn_mul_mont_t4_32(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,<span class="keyword">const</span> BN_ULONG *n0);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> bn_mul_mont_f mul_funcs[4] = {</div>
<div class="line">                        bn_mul_mont_t4_8,       bn_mul_mont_t4_16,</div>
<div class="line">                        bn_mul_mont_t4_24,      bn_mul_mont_t4_32 };</div>
<div class="line">        bn_mul_mont_f mul_worker = mul_funcs[top/16-1];</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> bn_mul_mont_vis3(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num);</div>
<div class="line">        <span class="keywordtype">void</span> bn_mul_mont_t4(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *bp,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num);</div>
<div class="line">        <span class="keywordtype">void</span> bn_mul_mont_gather5_t4(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num,<span class="keywordtype">int</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_flip_n_scatter5_t4(<span class="keyword">const</span> BN_ULONG *inp,<span class="keywordtype">size_t</span> num,</div>
<div class="line">                        <span class="keywordtype">void</span> *table,<span class="keywordtype">size_t</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_gather5_t4(BN_ULONG *<a class="code" href="ideatest_8c.html#afdf65de9e264331943a9e5a248271311">out</a>,<span class="keywordtype">size_t</span> num,</div>
<div class="line">                        <span class="keywordtype">void</span> *table,<span class="keywordtype">size_t</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_flip_t4(BN_ULONG *dst,BN_ULONG *src,<span class="keywordtype">size_t</span> num);</div>
<div class="line"></div>
<div class="line">        BN_ULONG *np=mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, *n0=mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>;</div>
<div class="line">        <span class="keywordtype">int</span> stride = 5*(6-(top/16-1));  <span class="comment">/* multiple of 5, but less than 32 */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* BN_to_montgomery can contaminate words above .top</span></div>
<div class="line"><span class="comment">         * [in BN_DEBUG[_DEBUG] build]... */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i=am.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>; i&lt;top; i++)      am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i]=0;</div>
<div class="line">        <span class="keywordflow">for</span> (i=tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>; i&lt;top; i++)     tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i]=0;</div>
<div class="line"></div>
<div class="line">        bn_flip_n_scatter5_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,0);</div>
<div class="line">        bn_flip_n_scatter5_t4(am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,1);</div>
<div class="line">        <span class="keywordflow">if</span> (!(*mul_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0) &amp;&amp;</div>
<div class="line">            !(*mul_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0))</div>
<div class="line">                bn_mul_mont_vis3(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">        bn_flip_n_scatter5_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,2);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i=3; i&lt;32; i++)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* Calculate a^i = a^(i-1) * a */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!(*mul_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0) &amp;&amp;</div>
<div class="line">                    !(*mul_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0))</div>
<div class="line">                        bn_mul_mont_vis3(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_flip_n_scatter5_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* switch to 64-bit domain */</span> </div>
<div class="line">        np = alloca(top*<span class="keyword">sizeof</span>(BN_ULONG));</div>
<div class="line">        top /= 2;</div>
<div class="line">        bn_flip_t4(np,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top);</div>
<div class="line"></div>
<div class="line">        bits--;</div>
<div class="line">        <span class="keywordflow">for</span> (wvalue=0, i=bits%5; i&gt;=0; i--,bits--)</div>
<div class="line">                wvalue = (wvalue&lt;&lt;1)+<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,bits);</div>
<div class="line">        bn_gather5_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,wvalue);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Scan the exponent one window at a time starting from the most</span></div>
<div class="line"><span class="comment">         * significant bits.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">while</span> (bits &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (bits &lt; stride) stride = bits+1;</div>
<div class="line">                bits -= stride;</div>
<div class="line">                wvalue = bn_get_bits(p,bits+1);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> ((*pwr5_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,powerbuf,wvalue,stride)) <span class="keywordflow">continue</span>;</div>
<div class="line">                <span class="comment">/* retry once and fall back */</span></div>
<div class="line">                <span class="keywordflow">if</span> ((*pwr5_worker)(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,powerbuf,wvalue,stride)) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                bits += stride-5;</div>
<div class="line">                wvalue &gt;&gt;= stride-5;</div>
<div class="line">                wvalue &amp;= 31;</div>
<div class="line">                bn_mul_mont_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_gather5_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np,n0,top,wvalue);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        bn_flip_t4(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top);</div>
<div class="line">        top *= 2;</div>
<div class="line">        <span class="comment">/* back to 32-bit domain */</span></div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=top;</div>
<div class="line">        <a class="code" href="bn_8h.html#ac7cda4cbe7c292e7acbc0e66d7f45364">bn_correct_top</a>(&amp;tmp);</div>
<div class="line">        <a class="code" href="crypto_8h.html#a2aa47e40c63b05d00e9a780592f2a2b8">OPENSSL_cleanse</a>(np,top*<span class="keyword">sizeof</span>(BN_ULONG));</div>
<div class="line">        }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#if defined(OPENSSL_BN_ASM_MONT5)</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">/* This optimization uses ideas from http://eprint.iacr.org/2011/239,</span></div>
<div class="line"><span class="comment">     * specifically optimization of cache-timing attack countermeasures</span></div>
<div class="line"><span class="comment">     * and pre-computation optimization. */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Dedicated window==4 case improves 512-bit RSA sign by ~15%, but as</span></div>
<div class="line"><span class="comment">     * 512-bit RSA is hardly relevant, we omit it to spare size... */</span> </div>
<div class="line">    <span class="keywordflow">if</span> (window==5)</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordtype">void</span> bn_mul_mont_gather5(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num,<span class="keywordtype">int</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_scatter5(<span class="keyword">const</span> BN_ULONG *inp,<span class="keywordtype">size_t</span> num,</div>
<div class="line">                        <span class="keywordtype">void</span> *table,<span class="keywordtype">size_t</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_gather5(BN_ULONG *<a class="code" href="ideatest_8c.html#afdf65de9e264331943a9e5a248271311">out</a>,<span class="keywordtype">size_t</span> num,</div>
<div class="line">                        <span class="keywordtype">void</span> *table,<span class="keywordtype">size_t</span> power);</div>
<div class="line">        <span class="keywordtype">void</span> bn_power5(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> <span class="keywordtype">void</span> *table,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num,<span class="keywordtype">int</span> power);</div>
<div class="line">        <span class="keywordtype">int</span> bn_get_bits5(<span class="keyword">const</span> BN_ULONG *ap,<span class="keywordtype">int</span> off);</div>
<div class="line">        <span class="keywordtype">int</span> bn_from_montgomery(BN_ULONG *rp,<span class="keyword">const</span> BN_ULONG *ap,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *not_used,<span class="keyword">const</span> BN_ULONG *np,</div>
<div class="line">                        <span class="keyword">const</span> BN_ULONG *n0,<span class="keywordtype">int</span> num);</div>
<div class="line"></div>
<div class="line">        BN_ULONG *np=mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>, *n0=mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>, *np2;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* BN_to_montgomery can contaminate words above .top</span></div>
<div class="line"><span class="comment">         * [in BN_DEBUG[_DEBUG] build]... */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i=am.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>; i&lt;top; i++)      am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i]=0;</div>
<div class="line">        <span class="keywordflow">for</span> (i=tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>; i&lt;top; i++)     tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i]=0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (top&amp;7)</div>
<div class="line">                np2 = np;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">for</span> (np2=am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>+top,i=0; i&lt;top; i++) np2[2*i]=np[i];</div>
<div class="line"></div>
<div class="line">        bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,0);</div>
<div class="line">        bn_scatter5(am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>,powerbuf,1);</div>
<div class="line">        <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">        bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,2);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">for</span> (i=3; i&lt;32; i++)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* Calculate a^i = a^(i-1) * a */</span></div>
<div class="line">                bn_mul_mont_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np2,n0,top,i-1);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* same as above, but uses squaring for 1/2 of operations */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i=4; i&lt;32; i*=2)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">for</span> (i=3; i&lt;8; i+=2)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">int</span> j;</div>
<div class="line">                bn_mul_mont_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np2,n0,top,i-1);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                <span class="keywordflow">for</span> (j=2*i; j&lt;32; j*=2)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                        bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,j);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">for</span> (; i&lt;16; i+=2)</div>
<div class="line">                {</div>
<div class="line">                bn_mul_mont_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np2,n0,top,i-1);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,2*i);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">for</span> (; i&lt;32; i+=2)</div>
<div class="line">                {</div>
<div class="line">                bn_mul_mont_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np2,n0,top,i-1);</div>
<div class="line">                bn_scatter5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,i);</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        bits--;</div>
<div class="line">        <span class="keywordflow">for</span> (wvalue=0, i=bits%5; i&gt;=0; i--,bits--)</div>
<div class="line">                wvalue = (wvalue&lt;&lt;1)+<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,bits);</div>
<div class="line">        bn_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,top,powerbuf,wvalue);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Scan the exponent one window at a time starting from the most</span></div>
<div class="line"><span class="comment">         * significant bits.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (top&amp;7)</div>
<div class="line">            <span class="keywordflow">while</span> (bits &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (wvalue=0, i=0; i&lt;5; i++,bits--)</div>
<div class="line">                        wvalue = (wvalue&lt;&lt;1)+<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,bits);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                <a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,np,n0,top);</div>
<div class="line">                bn_mul_mont_gather5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np,n0,top,wvalue);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">while</span> (bits &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                wvalue = bn_get_bits5(p-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,bits-4);</div>
<div class="line">                bits-=5;</div>
<div class="line">                bn_power5(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,powerbuf,np2,n0,top,wvalue);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        ret=bn_from_montgomery(tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,tmp.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,np2,n0,top);</div>
<div class="line">        tmp.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=top;</div>
<div class="line">        <a class="code" href="bn_8h.html#ac7cda4cbe7c292e7acbc0e66d7f45364">bn_correct_top</a>(&amp;tmp);</div>
<div class="line">        <span class="keywordflow">if</span> (ret)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(rr,&amp;tmp)) ret=0;</div>
<div class="line">                <span class="keywordflow">goto</span> err; <span class="comment">/* non-zero ret means it&#39;s not error */</span></div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        {</div>
<div class="line">        <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_TO_PREBUF(&amp;tmp, top, powerbuf, 0, numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_TO_PREBUF(&amp;am,  top, powerbuf, 1, numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If the window size is greater than 1, then calculate</span></div>
<div class="line"><span class="comment">         * val[i=2..2^winsize-1]. Powers are computed as a*a^(i-1)</span></div>
<div class="line"><span class="comment">         * (even powers could instead be computed as (a^(i/2))^2</span></div>
<div class="line"><span class="comment">         * to use the slight performance advantage of sqr over mul).</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (window &gt; 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(&amp;tmp,&amp;am,&amp;am,mont,ctx))      <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_TO_PREBUF(&amp;tmp, top, powerbuf, 2, numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">for</span> (i=3; i&lt;numPowers; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="comment">/* Calculate a^i = a^(i-1) * a */</span></div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(&amp;tmp,&amp;am,&amp;tmp,mont,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_TO_PREBUF(&amp;tmp, top, powerbuf, i, numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        bits--;</div>
<div class="line">        <span class="keywordflow">for</span> (wvalue=0, i=bits%window; i&gt;=0; i--,bits--)</div>
<div class="line">                wvalue = (wvalue&lt;&lt;1)+<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,bits);</div>
<div class="line">        <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_FROM_PREBUF(&amp;tmp,top,powerbuf,wvalue,numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Scan the exponent one window at a time starting from the most</span></div>
<div class="line"><span class="comment">         * significant bits.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">while</span> (bits &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                wvalue=0; <span class="comment">/* The &#39;value&#39; of the window */</span></div>
<div class="line">                </div>
<div class="line">                <span class="comment">/* Scan the window, squaring the result as we go */</span></div>
<div class="line">                <span class="keywordflow">for</span> (i=0; i&lt;window; i++,bits--)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(&amp;tmp,&amp;tmp,&amp;tmp,mont,ctx))    <span class="keywordflow">goto</span> err;</div>
<div class="line">                        wvalue = (wvalue&lt;&lt;1)+<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,bits);</div>
<div class="line">                        }</div>
<div class="line">                </div>
<div class="line">                <span class="comment">/* Fetch the appropriate pre-computed value from the pre-buf */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!MOD_EXP_CTIME_COPY_FROM_PREBUF(&amp;am, top, powerbuf, wvalue, numPowers)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Multiply the result into the intermediate result */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(&amp;tmp,&amp;tmp,&amp;am,mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Convert the final result from montgomery to standard format */</span></div>
<div class="line"><span class="preprocessor">#if defined(SPARC_T4_MONT)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="sparcv9cap_8c.html#af66a59e32f10d874a7c9452bf38c8109">OPENSSL_sparcv9cap_P</a>[0]&amp;(<a class="code" href="sparc__arch_8h.html#a811b561515ed6fba484302214c3089c9">SPARCV9_VIS3</a>|<a class="code" href="sparc__arch_8h.html#a3b9cab60f5c1f117a93487d932952aa8">SPARCV9_PREFER_FPU</a>))</div>
<div class="line">                {</div>
<div class="line">                am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] = 1;    <span class="comment">/* borrow am */</span></div>
<div class="line">                <span class="keywordflow">for</span> (i=1;i&lt;top;i++) am.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[i] = 0;</div>
<div class="line">                if (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(rr,&amp;tmp,&amp;am,mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9977c9c5f9a09f4f2802b5ef8edae9ad">BN_from_montgomery</a>(rr,&amp;tmp,mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> ((in_mont == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) &amp;&amp; (mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)) <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <span class="keywordflow">if</span> (powerbuf!=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#a2aa47e40c63b05d00e9a780592f2a2b8">OPENSSL_cleanse</a>(powerbuf,powerbufLen);</div>
<div class="line">                <span class="keywordflow">if</span> (powerbufFree) <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(powerbufFree);</div>
<div class="line">                }</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a497e0d82713e2e9e3919a68f744bd49e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp_mont_word </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>rr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BN_ULONG&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>in_mont</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l01096">1096</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *mont = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> <a class="code" href="des_8c.html#af55342ae4b8be9b599750497bddc6687">b</a>, <a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>, ret=0;</div>
<div class="line">        <span class="keywordtype">int</span> r_is_one;</div>
<div class="line">        BN_ULONG w, next_w;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *d, *r, *<a class="code" href="asn1_8h.html#a3d54702d866c88bc4b3a88e68fb986d9">t</a>;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *swap_tmp;</div>
<div class="line"><span class="preprocessor">#define BN_MOD_MUL_WORD(r, w, m) \</span></div>
<div class="line"><span class="preprocessor">                (BN_mul_word(r, (w)) &amp;&amp; \</span></div>
<div class="line"><span class="preprocessor">                (</span><span class="comment">/* BN_ucmp(r, (m)) &lt; 0 ? 1 :*/</span><span class="preprocessor">  \</span></div>
<div class="line"><span class="preprocessor">                        (BN_mod(t, r, m, ctx) &amp;&amp; (swap_tmp = r, r = t, t = swap_tmp, 1))))</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="comment">/* BN_MOD_MUL_WORD is only used with &#39;w&#39; large,</span></div>
<div class="line"><span class="comment">                 * so the BN_ucmp test is probably more overhead</span></div>
<div class="line"><span class="comment">                 * than always using BN_mod (which uses BN_copy if</span></div>
<div class="line"><span class="comment">                 * a similar test returns true). */</span></div>
<div class="line">                <span class="comment">/* We can use BN_mod and do not need BN_nnmod because our</span></div>
<div class="line"><span class="comment">                 * accumulator is never negative (the result of BN_mod does</span></div>
<div class="line"><span class="comment">                 * not depend on the sign of the modulus).</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line"><span class="preprocessor">#define BN_TO_MONTGOMERY_WORD(r, w, mont) \</span></div>
<div class="line"><span class="preprocessor">                (BN_set_word(r, (w)) &amp;&amp; BN_to_montgomery(r, r, (mont), ctx))</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) != 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* BN_FLG_CONSTTIME only supported by BN_mod_exp_mont() */</span></div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#a48480cfa6ca81147bb1936fe82a0e159">BN_F_BN_MOD_EXP_MONT_WORD</a>,<a class="code" href="err_8h.html#a684342cd58ce91d08c16257fbd165437">ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(p);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(m);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae53ace8862904c6eb7bcd58db7f1ecad">BN_is_odd</a>(m))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#a48480cfa6ca81147bb1936fe82a0e159">BN_F_BN_MOD_EXP_MONT_WORD</a>,<a class="code" href="bn_8h.html#a71312d677f2ff4c465e31b6e360ee196">BN_R_CALLED_WITH_EVEN_MODULUS</a>);</div>
<div class="line">                <span class="keywordflow">return</span>(0);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (m-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> == 1)</div>
<div class="line">                <a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a> %= m-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0]; <span class="comment">/* make sure that &#39;a&#39; is reduced */</span></div>
<div class="line"></div>
<div class="line">        bits = <a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line">        <span class="keywordflow">if</span> (bits == 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* x**0 mod 1 is still zero. */</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ab1f2aa49c798c0f21b01899e8d562ee7">BN_is_one</a>(m))</div>
<div class="line">                        {</div>
<div class="line">                        ret = 1;</div>
<div class="line">                        <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(rr);</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        ret = <a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(rr);</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a> == 0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(rr);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        d = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        r = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        t = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (d == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || r == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || t == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (in_mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                mont=in_mont;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((mont = <a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>()) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(mont, m, ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        r_is_one = 1; <span class="comment">/* except for Montgomery factor */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* bits-1 &gt;= 0 */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* The result is accumulated in the product r*w. */</span></div>
<div class="line">        w = <a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>; <span class="comment">/* bit &#39;bits-1&#39; of &#39;p&#39; is always set */</span></div>
<div class="line">        <span class="keywordflow">for</span> (b = bits-2; b &gt;= 0; b--)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* First, square r*w. */</span></div>
<div class="line">                next_w = w*w;</div>
<div class="line">                <span class="keywordflow">if</span> ((next_w/w) != w) <span class="comment">/* overflow */</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (r_is_one)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#aba83c6a8e78852124e766e9dc5812933">BN_TO_MONTGOMERY_WORD</a>(r, w, mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                r_is_one = 0;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#acc368638df06b0865c95edeac1f4e62a">BN_MOD_MUL_WORD</a>(r, w, m)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                        next_w = 1;</div>
<div class="line">                        }</div>
<div class="line">                w = next_w;</div>
<div class="line">                <span class="keywordflow">if</span> (!r_is_one)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a>(r, r, r, mont, ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Second, multiply r*w by &#39;a&#39; if exponent bit is set. */</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p, b))</div>
<div class="line">                        {</div>
<div class="line">                        next_w = w*<a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>;</div>
<div class="line">                        <span class="keywordflow">if</span> ((next_w/a) != w) <span class="comment">/* overflow */</span></div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (r_is_one)</div>
<div class="line">                                        {</div>
<div class="line">                                        <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#aba83c6a8e78852124e766e9dc5812933">BN_TO_MONTGOMERY_WORD</a>(r, w, mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                        r_is_one = 0;</div>
<div class="line">                                        }</div>
<div class="line">                                <span class="keywordflow">else</span></div>
<div class="line">                                        {</div>
<div class="line">                                        <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#acc368638df06b0865c95edeac1f4e62a">BN_MOD_MUL_WORD</a>(r, w, m)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                        }</div>
<div class="line">                                next_w = <a class="code" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>;</div>
<div class="line">                                }</div>
<div class="line">                        w = next_w;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Finally, set r:=r*w. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (w != 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (r_is_one)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#aba83c6a8e78852124e766e9dc5812933">BN_TO_MONTGOMERY_WORD</a>(r, w, mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        r_is_one = 0;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn__exp_8c.html#acc368638df06b0865c95edeac1f4e62a">BN_MOD_MUL_WORD</a>(r, w, m)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (r_is_one) <span class="comment">/* can happen only if a == 1*/</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(rr)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9977c9c5f9a09f4f2802b5ef8edae9ad">BN_from_montgomery</a>(rr, r, mont, ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        ret = 1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> ((in_mont == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) &amp;&amp; (mont != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)) <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(mont);</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(rr);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5c15da80c8847b4a2d85e6e2f343f8c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp_recp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l00269">269</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i,j,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>,ret=0,wstart,wend,window,wvalue;</div>
<div class="line">        <span class="keywordtype">int</span> start=1;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *aa;</div>
<div class="line">        <span class="comment">/* Table of variables obtained from &#39;ctx&#39; */</span></div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *val[<a class="code" href="bn__exp_8c.html#a032503e76d6f69bc67e99e909c8125da">TABLE_SIZE</a>];</div>
<div class="line">        <a class="code" href="structbn__recp__ctx__st.html">BN_RECP_CTX</a> recp;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) != 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* BN_FLG_CONSTTIME only supported by BN_mod_exp_mont() */</span></div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#a757647f2ca502103e13be2dc22a26a6b">BN_F_BN_MOD_EXP_RECP</a>,<a class="code" href="err_8h.html#a684342cd58ce91d08c16257fbd165437">ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        bits=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (bits == 0)</div>
<div class="line">                {</div>
<div class="line">                ret = <a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(r);</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        aa = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        val[0] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span>(!aa || !val[0]) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#aac14d9be4ac98d2840f9b2e1e2f78653">BN_RECP_CTX_init</a>(&amp;recp);</div>
<div class="line">        <span class="keywordflow">if</span> (m-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* ignore sign of &#39;m&#39; */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(aa, m)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                aa-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#aea83263e7e0976a7137de67067edeb32">BN_RECP_CTX_set</a>(&amp;recp,aa,ctx) &lt;= 0) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#aea83263e7e0976a7137de67067edeb32">BN_RECP_CTX_set</a>(&amp;recp,m,ctx) &lt;= 0) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a762a91b13a7ad118051f34eacac4e104">BN_nnmod</a>(val[0],a,m,ctx)) <span class="keywordflow">goto</span> err;                <span class="comment">/* 1 */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a8adb5a8606dfd0354a4d93b85e3996ab">BN_is_zero</a>(val[0]))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(r);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        window = <a class="code" href="bn__lcl_8h.html#aa960de98937dbcc97931def7af45e608">BN_window_bits_for_exponent_size</a>(bits);</div>
<div class="line">        <span class="keywordflow">if</span> (window &gt; 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a095a194cd6d21cd08f33d5b40d406d11">BN_mod_mul_reciprocal</a>(aa,val[0],val[0],&amp;recp,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;                               <span class="comment">/* 2 */</span></div>
<div class="line">                j=1&lt;&lt;(window-1);</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;j; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span>(((val[i] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) ||</div>
<div class="line">                                        !<a class="code" href="bn_8h.html#a095a194cd6d21cd08f33d5b40d406d11">BN_mod_mul_reciprocal</a>(val[i],val[i-1],</div>
<div class="line">                                                aa,&amp;recp,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">        start=1;        <span class="comment">/* This is used to avoid multiplication etc</span></div>
<div class="line"><span class="comment">                         * when there is only the value &#39;1&#39; in the</span></div>
<div class="line"><span class="comment">                         * buffer. */</span></div>
<div class="line">        wvalue=0;       <span class="comment">/* The &#39;value&#39; of the window */</span></div>
<div class="line">        wstart=bits-1;  <span class="comment">/* The top bit of the window */</span></div>
<div class="line">        wend=0;         <span class="comment">/* The bottom bit of the window */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(r)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart) == 0)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!start)</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a095a194cd6d21cd08f33d5b40d406d11">BN_mod_mul_reciprocal</a>(r,r,r,&amp;recp,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        wstart--;</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                        }</div>
<div class="line">                <span class="comment">/* We now have wstart on a &#39;set&#39; bit, we now need to work out</span></div>
<div class="line"><span class="comment">                 * how bit a window to do.  To do this we need to scan</span></div>
<div class="line"><span class="comment">                 * forward until the last set bit before the end of the</span></div>
<div class="line"><span class="comment">                 * window */</span></div>
<div class="line">                j=wstart;</div>
<div class="line">                wvalue=1;</div>
<div class="line">                wend=0;</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;window; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart-i &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart-i))</div>
<div class="line">                                {</div>
<div class="line">                                wvalue&lt;&lt;=(i-wend);</div>
<div class="line">                                wvalue|=1;</div>
<div class="line">                                wend=i;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* wend is the size of the current window */</span></div>
<div class="line">                j=wend+1;</div>
<div class="line">                <span class="comment">/* add the &#39;bytes above&#39; */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!start)</div>
<div class="line">                        <span class="keywordflow">for</span> (i=0; i&lt;j; i++)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a095a194cd6d21cd08f33d5b40d406d11">BN_mod_mul_reciprocal</a>(r,r,r,&amp;recp,ctx))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                </div>
<div class="line">                <span class="comment">/* wvalue will be an odd number &lt; 2^window */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a095a194cd6d21cd08f33d5b40d406d11">BN_mod_mul_reciprocal</a>(r,r,val[wvalue&gt;&gt;1],&amp;recp,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* move the &#39;window&#39; down further */</span></div>
<div class="line">                wstart-=wend+1;</div>
<div class="line">                wvalue=0;</div>
<div class="line">                start=0;</div>
<div class="line">                <span class="keywordflow">if</span> (wstart &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <a class="code" href="bn_8h.html#aec1413fd7d9966bed801298f2c6bca8a">BN_RECP_CTX_free</a>(&amp;recp);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(r);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a424f046eb1b37786478ace51c6e97ae2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_exp_simple </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__exp_8c_source.html#l01254">1254</a> of file <a class="el" href="bn__exp_8c_source.html">bn_exp.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i,j,<a class="code" href="x509v3_8h.html#ab3c186980893d6836a68407d221ae9c9">bits</a>,ret=0,wstart,wend,window,wvalue;</div>
<div class="line">        <span class="keywordtype">int</span> start=1;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *d;</div>
<div class="line">        <span class="comment">/* Table of variables obtained from &#39;ctx&#39; */</span></div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *val[<a class="code" href="bn__exp_8c.html#a032503e76d6f69bc67e99e909c8125da">TABLE_SIZE</a>];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a703b5d815865cb0309567af078d8cd48">BN_get_flags</a>(p, <a class="code" href="bn_8h.html#adcf064b3d5a81b820d5054c7a6f6ddb9">BN_FLG_CONSTTIME</a>) != 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* BN_FLG_CONSTTIME only supported by BN_mod_exp_mont() */</span></div>
<div class="line">                <a class="code" href="err_8h.html#a16f8679dcdd6241ebccde4ef37f7f024">BNerr</a>(<a class="code" href="bn_8h.html#ab7130aef470c737cc96e841140951a4b">BN_F_BN_MOD_EXP_SIMPLE</a>,<a class="code" href="err_8h.html#a684342cd58ce91d08c16257fbd165437">ERR_R_SHOULD_NOT_HAVE_BEEN_CALLED</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        bits=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(p);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (bits == 0)</div>
<div class="line">                {</div>
<div class="line">                ret = <a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(r);</div>
<div class="line">                <span class="keywordflow">return</span> ret;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        d = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        val[0] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span>(!d || !val[0]) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a762a91b13a7ad118051f34eacac4e104">BN_nnmod</a>(val[0],a,m,ctx)) <span class="keywordflow">goto</span> err;                <span class="comment">/* 1 */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a8adb5a8606dfd0354a4d93b85e3996ab">BN_is_zero</a>(val[0]))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(r);</div>
<div class="line">                ret = 1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        window = <a class="code" href="bn__lcl_8h.html#aa960de98937dbcc97931def7af45e608">BN_window_bits_for_exponent_size</a>(bits);</div>
<div class="line">        <span class="keywordflow">if</span> (window &gt; 1)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad0146b160c761fbfc83c1eeda4aee561">BN_mod_mul</a>(d,val[0],val[0],m,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;                               <span class="comment">/* 2 */</span></div>
<div class="line">                j=1&lt;&lt;(window-1);</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;j; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span>(((val[i] = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) ||</div>
<div class="line">                                        !<a class="code" href="bn_8h.html#ad0146b160c761fbfc83c1eeda4aee561">BN_mod_mul</a>(val[i],val[i-1],d,m,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        start=1;        <span class="comment">/* This is used to avoid multiplication etc</span></div>
<div class="line"><span class="comment">                         * when there is only the value &#39;1&#39; in the</span></div>
<div class="line"><span class="comment">                         * buffer. */</span></div>
<div class="line">        wvalue=0;       <span class="comment">/* The &#39;value&#39; of the window */</span></div>
<div class="line">        wstart=bits-1;  <span class="comment">/* The top bit of the window */</span></div>
<div class="line">        wend=0;         <span class="comment">/* The bottom bit of the window */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aab9a156a4de1030438e4ddaf9c3e35cb">BN_one</a>(r)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (;;)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart) == 0)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!start)</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad0146b160c761fbfc83c1eeda4aee561">BN_mod_mul</a>(r,r,r,m,ctx))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        wstart--;</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                        }</div>
<div class="line">                <span class="comment">/* We now have wstart on a &#39;set&#39; bit, we now need to work out</span></div>
<div class="line"><span class="comment">                 * how bit a window to do.  To do this we need to scan</span></div>
<div class="line"><span class="comment">                 * forward until the last set bit before the end of the</span></div>
<div class="line"><span class="comment">                 * window */</span></div>
<div class="line">                j=wstart;</div>
<div class="line">                wvalue=1;</div>
<div class="line">                wend=0;</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;window; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (wstart-i &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#afe142a52a34b899e6e3891ebb74d1e2d">BN_is_bit_set</a>(p,wstart-i))</div>
<div class="line">                                {</div>
<div class="line">                                wvalue&lt;&lt;=(i-wend);</div>
<div class="line">                                wvalue|=1;</div>
<div class="line">                                wend=i;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* wend is the size of the current window */</span></div>
<div class="line">                j=wend+1;</div>
<div class="line">                <span class="comment">/* add the &#39;bytes above&#39; */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!start)</div>
<div class="line">                        <span class="keywordflow">for</span> (i=0; i&lt;j; i++)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad0146b160c761fbfc83c1eeda4aee561">BN_mod_mul</a>(r,r,r,m,ctx))</div>
<div class="line">                                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                </div>
<div class="line">                <span class="comment">/* wvalue will be an odd number &lt; 2^window */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ad0146b160c761fbfc83c1eeda4aee561">BN_mod_mul</a>(r,r,val[wvalue&gt;&gt;1],m,ctx))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* move the &#39;window&#39; down further */</span></div>
<div class="line">                wstart-=wend+1;</div>
<div class="line">                wvalue=0;</div>
<div class="line">                start=0;</div>
<div class="line">                <span class="keywordflow">if</span> (wstart &lt; 0) <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(r);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
