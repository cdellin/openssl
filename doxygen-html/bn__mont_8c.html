<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/bn/bn_mont.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_bf4984ea57f5888de95a64cb80bbf1fb.html">bn</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">bn_mont.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bn__lcl_8h_source.html">bn_lcl.h</a>&quot;</code><br/>
</div>
<p><a href="bn__mont_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a099e2c772dcc3de688ce53772001b364"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a099e2c772dcc3de688ce53772001b364">OPENSSL_FIPSAPI</a></td></tr>
<tr class="memitem:a118088a94ca19acc5830083fb1568e04"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a118088a94ca19acc5830083fb1568e04">MONT_WORD</a>&#160;&#160;&#160;/* use the faster word-based algorithm */</td></tr>
<tr class="memitem:af4147de1301ed6889c5301789f7a111f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#af4147de1301ed6889c5301789f7a111f">BRANCH_FREE</a>&#160;&#160;&#160;1</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a45f23a70e47aaee8e5a803b6bead2389"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a45f23a70e47aaee8e5a803b6bead2389">BN_mod_mul_montgomery</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *r, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="des_8c.html#af55342ae4b8be9b599750497bddc6687">b</a>, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *mont, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:a609ff59a267bd4b57f5c65185a05cccc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a609ff59a267bd4b57f5c65185a05cccc">BN_from_montgomery</a> (<a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *ret, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *<a class="el" href="hpux_8cc.html#af3e37283d97a42ffc096d8958a745f32">a</a>, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *mont, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:a999d23b49a7dda650cc474a5d23371b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a> (void)</td></tr>
<tr class="memitem:a372523413775537761de90c214860420"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a372523413775537761de90c214860420">BN_MONT_CTX_init</a> (<a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *ctx)</td></tr>
<tr class="memitem:a116cb1474c03454afc12f5256b6974e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a> (<a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *mont)</td></tr>
<tr class="memitem:a878255f2366943638d159fcf8a774493"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a> (<a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *mont, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *mod, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
<tr class="memitem:a625fb0eec5b9522d635ebfcdd5f87503"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#a625fb0eec5b9522d635ebfcdd5f87503">BN_MONT_CTX_copy</a> (<a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *to, <a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *from)</td></tr>
<tr class="memitem:af245fe3f8bfa9eb9dbbd0ad879b6b251"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bn__mont_8c.html#af245fe3f8bfa9eb9dbbd0ad879b6b251">BN_MONT_CTX_set_locked</a> (<a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> **pmont, int lock, const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *mod, <a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *ctx)</td></tr>
</table>
<h2>Macro Definition Documentation</h2>
<a class="anchor" id="af4147de1301ed6889c5301789f7a111f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BRANCH_FREE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a118088a94ca19acc5830083fb1568e04"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MONT_WORD&#160;&#160;&#160;/* use the faster word-based algorithm */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00125">125</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>

</div>
</div>
<a class="anchor" id="a099e2c772dcc3de688ce53772001b364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPENSSL_FIPSAPI</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00119">119</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a609ff59a267bd4b57f5c65185a05cccc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_from_montgomery </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>mont</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00282">282</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> retn=0;</div>
<div class="line"><span class="preprocessor">#ifdef MONT_WORD</span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="structbignum__st.html">BIGNUM</a> *<a class="code" href="asn1_8h.html#a3d54702d866c88bc4b3a88e68fb986d9">t</a>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> ((t = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx)) &amp;&amp; <a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(t,a))</div>
<div class="line">                retn = BN_from_montgomery_word(ret,t,mont);</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* !MONT_WORD */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="structbignum__st.html">BIGNUM</a> *t1,*t2;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        t1 = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        t2 = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (t1 == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || t2 == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(t1,a)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <a class="code" href="bn_8h.html#afef0313695959acb28432e718486d02e">BN_mask_bits</a>(t1,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a59c2fddbc3b4a0bdc548f08ee48f3af1">BN_mul</a>(t2,t1,&amp;mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <a class="code" href="bn_8h.html#afef0313695959acb28432e718486d02e">BN_mask_bits</a>(t2,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a59c2fddbc3b4a0bdc548f08ee48f3af1">BN_mul</a>(t1,t2,&amp;mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2ad946f29b201d22a2ca4750a587431">BN_add</a>(t2,a,t1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a518117a356ce88c99f896df71176c9a4">BN_rshift</a>(ret,t2,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#ab1ae0b9d9dfc923356e8a05a9a5be89a">BN_ucmp</a>(ret, &amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>)) &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9771bb6e21d1fa238b6e518746305825">BN_usub</a>(ret,ret,&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>))) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        retn=1;</div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(ret);</div>
<div class="line"> err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* MONT_WORD */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>(retn);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a45f23a70e47aaee8e5a803b6bead2389"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_mod_mul_montgomery </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>mont</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00131">131</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *tmp;</div>
<div class="line">        <span class="keywordtype">int</span> ret=0;</div>
<div class="line"><span class="preprocessor">#if defined(OPENSSL_BN_ASM_MONT) &amp;&amp; defined(MONT_WORD)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordtype">int</span> num = mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (num&gt;1 &amp;&amp; a-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>==num &amp;&amp; b-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>==num)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a15094251b9047bc54ef42c702e65ce86">bn_wexpand</a>(r,num) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">return</span>(0);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="bn__lcl_8h.html#a8bb9c9bd48d8c0edf0c23558d6826554">bn_mul_mont</a>(r-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,a-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,b-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>,num))</div>
<div class="line">                        {</div>
<div class="line">                        r-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> = a-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>^b-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>;</div>
<div class="line">                        r-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = num;</div>
<div class="line">                        <a class="code" href="bn_8h.html#ac7cda4cbe7c292e7acbc0e66d7f45364">bn_correct_top</a>(r);</div>
<div class="line">                        <span class="keywordflow">return</span>(1);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        tmp = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span> (tmp == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(tmp);</div>
<div class="line">        <span class="keywordflow">if</span> (a == b)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ac1995ae74557a3177b6375dde9914cbc">BN_sqr</a>(tmp,a,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a59c2fddbc3b4a0bdc548f08ee48f3af1">BN_mul</a>(tmp,a,b,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="comment">/* reduce from aRR to aR */</span></div>
<div class="line"><span class="preprocessor">#ifdef MONT_WORD</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!BN_from_montgomery_word(r,tmp,mont)) <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a9977c9c5f9a09f4f2802b5ef8edae9ad">BN_from_montgomery</a>(r,tmp,mont,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="bn_8h.html#a95257c8ba175f77c58a26d83369efc96">bn_check_top</a>(r);</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a625fb0eec5b9522d635ebfcdd5f87503"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a>* BN_MONT_CTX_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>from</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00467">467</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (to == from) <span class="keywordflow">return</span>(to);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(&amp;(to-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>),&amp;(from-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>))) <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(&amp;(to-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>),&amp;(from-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>))) <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(&amp;(to-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>),&amp;(from-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>))) <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        to-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>=from-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>;</div>
<div class="line">        to-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0]=from-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0];</div>
<div class="line">        to-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[1]=from-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[1];</div>
<div class="line">        <span class="keywordflow">return</span>(to);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a116cb1474c03454afc12f5256b6974e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BN_MONT_CTX_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>mont</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00345">345</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span>(mont == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>));</div>
<div class="line">        <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>));</div>
<div class="line">        <a class="code" href="bn_8h.html#a2d660f4ff6015d33035484c4e9f09e88">BN_free</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a8b43cc0971930aacb1fb2188e610dc8c">flags</a> &amp; <a class="code" href="bn_8h.html#afadc79b593fb90762b15a11cc4435d1d">BN_FLG_MALLOCED</a>)</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(mont);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a372523413775537761de90c214860420"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BN_MONT_CTX_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00335">335</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>=0;</div>
<div class="line">        <a class="code" href="bn_8h.html#a7fd31fb560daa37060a29f18a176d0e6">BN_init</a>(&amp;(ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>));</div>
<div class="line">        <a class="code" href="bn_8h.html#a7fd31fb560daa37060a29f18a176d0e6">BN_init</a>(&amp;(ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>));</div>
<div class="line">        <a class="code" href="bn_8h.html#a7fd31fb560daa37060a29f18a176d0e6">BN_init</a>(&amp;(ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>));</div>
<div class="line">        ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0] = ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[1] = 0;</div>
<div class="line">        ctx-&gt;<a class="code" href="structbn__mont__ctx__st.html#a8b43cc0971930aacb1fb2188e610dc8c">flags</a>=0;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a999d23b49a7dda650cc474a5d23371b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a>* BN_MONT_CTX_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00323">323</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *ret;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((ret=(<a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *)<a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a>))) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">return</span>(<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a372523413775537761de90c214860420">BN_MONT_CTX_init</a>(ret);</div>
<div class="line">        ret-&gt;<a class="code" href="structbn__mont__ctx__st.html#a8b43cc0971930aacb1fb2188e610dc8c">flags</a>=<a class="code" href="bn_8h.html#afadc79b593fb90762b15a11cc4435d1d">BN_FLG_MALLOCED</a>;</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a878255f2366943638d159fcf8a774493"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BN_MONT_CTX_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> *&#160;</td>
          <td class="paramname"><em>mont</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00357">357</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        <a class="code" href="structbignum__st.html">BIGNUM</a> *Ri,*R;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="bn_8h.html#a47741d3f4189363af52494a962178b2e">BN_CTX_start</a>(ctx);</div>
<div class="line">        <span class="keywordflow">if</span>((Ri = <a class="code" href="bn_8h.html#a606a551f58535bd3e7b530c4712dd369">BN_CTX_get</a>(ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> err;</div>
<div class="line">        R= &amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>);                                 <span class="comment">/* grab RR as a temp */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aea0c4e291bb4a98877f3e106aba231ad">BN_copy</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>),mod)) <span class="keywordflow">goto</span> err;         <span class="comment">/* Set N */</span></div>
<div class="line">        mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>.<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a> = 0;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef MONT_WORD</span></div>
<div class="line"><span class="preprocessor"></span>                {</div>
<div class="line">                <a class="code" href="structbignum__st.html">BIGNUM</a> tmod;</div>
<div class="line">                BN_ULONG buf[2];</div>
<div class="line"></div>
<div class="line">                <a class="code" href="bn_8h.html#a7fd31fb560daa37060a29f18a176d0e6">BN_init</a>(&amp;tmod);</div>
<div class="line">                tmod.<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>=buf;</div>
<div class="line">                tmod.<a class="code" href="structbignum__st.html#adc321f2d3b6d3962fda140080275267c">dmax</a>=2;</div>
<div class="line">                tmod.<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>=0;</div>
<div class="line"></div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>=(<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(mod)+(BN_BITS2-1))/BN_BITS2*BN_BITS2;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(OPENSSL_BN_ASM_MONT) &amp;&amp; (BN_BITS2&lt;=32)</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="comment">/* Only certain BN_BITS2&lt;=32 platforms actually make use of</span></div>
<div class="line"><span class="comment">                 * n0[1], and we could use the #else case (with a shorter R</span></div>
<div class="line"><span class="comment">                 * value) for the others.  However, currently only the assembler</span></div>
<div class="line"><span class="comment">                 * files do know which is which. */</span></div>
<div class="line"></div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(R);</div>
<div class="line">                <span class="keywordflow">if</span> (!(<a class="code" href="bn_8h.html#a749422e7fccf262d029ddf941418a39a">BN_set_bit</a>(R,2*BN_BITS2))) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">                                                                tmod.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=0;</div>
<div class="line">                <span class="keywordflow">if</span> ((buf[0] = mod-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0]))                       tmod.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=1;</div>
<div class="line">                <span class="keywordflow">if</span> ((buf[1] = mod-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>&gt;1 ? mod-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[1] : 0))      tmod.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=2;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="bn_8h.html#af0a3a412b596f78d0e8737e5dbff22c3">BN_mod_inverse</a>(Ri,R,&amp;tmod,ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(Ri,Ri,2*BN_BITS2)) <span class="keywordflow">goto</span> err; <span class="comment">/* R*Ri */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a8adb5a8606dfd0354a4d93b85e3996ab">BN_is_zero</a>(Ri))</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#af1b59addeb34d71582e7258061121fd7">BN_sub_word</a>(Ri,1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="comment">/* if N mod word size == 1 */</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="bn_8h.html#a89bc593cad986b83c6eceb7e86d93cb9">bn_expand</a>(Ri,(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(BN_ULONG)*2) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="comment">/* Ri-- (mod double word size) */</span></div>
<div class="line">                        Ri-&gt;<a class="code" href="structbignum__st.html#a4bffe6c6b7a0f7fa9821b0339b7d126f">neg</a>=0;</div>
<div class="line">                        Ri-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0]=BN_MASK2;</div>
<div class="line">                        Ri-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[1]=BN_MASK2;</div>
<div class="line">                        Ri-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a>=2;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2d806f97ad6b75e85e001d781090eb0">BN_div</a>(Ri,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,Ri,&amp;tmod,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="comment">/* Ni = (R*Ri-1)/N,</span></div>
<div class="line"><span class="comment">                 * keep only couple of least significant words: */</span></div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0] = (Ri-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> &gt; 0) ? Ri-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] : 0;</div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[1] = (Ri-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> &gt; 1) ? Ri-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[1] : 0;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(R);</div>
<div class="line">                <span class="keywordflow">if</span> (!(<a class="code" href="bn_8h.html#a749422e7fccf262d029ddf941418a39a">BN_set_bit</a>(R,BN_BITS2))) <span class="keywordflow">goto</span> err;        <span class="comment">/* R */</span></div>
<div class="line"></div>
<div class="line">                buf[0]=mod-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0]; <span class="comment">/* tmod = N mod word size */</span></div>
<div class="line">                buf[1]=0;</div>
<div class="line">                tmod.<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> = buf[0] != 0 ? 1 : 0;</div>
<div class="line">                                                        <span class="comment">/* Ri = R^-1 mod N*/</span></div>
<div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="bn_8h.html#af0a3a412b596f78d0e8737e5dbff22c3">BN_mod_inverse</a>(Ri,R,&amp;tmod,ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(Ri,Ri,BN_BITS2)) <span class="keywordflow">goto</span> err; <span class="comment">/* R*Ri */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a8adb5a8606dfd0354a4d93b85e3996ab">BN_is_zero</a>(Ri))</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#af1b59addeb34d71582e7258061121fd7">BN_sub_word</a>(Ri,1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="comment">/* if N mod word size == 1 */</span></div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae9b1fc316ffc1825cb8547ba169631b6">BN_set_word</a>(Ri,BN_MASK2)) <span class="keywordflow">goto</span> err;  <span class="comment">/* Ri-- (mod word size) */</span></div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2d806f97ad6b75e85e001d781090eb0">BN_div</a>(Ri,<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,Ri,&amp;tmod,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="comment">/* Ni = (R*Ri-1)/N,</span></div>
<div class="line"><span class="comment">                 * keep only least significant word: */</span></div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[0] = (Ri-&gt;<a class="code" href="structbignum__st.html#acb2587e7e0ff144adee978acd5b362f6">top</a> &gt; 0) ? Ri-&gt;<a class="code" href="structbignum__st.html#afa4e4a2eb24f9c3df7eb33fd589cba31">d</a>[0] : 0;</div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a728405e4c4ef9cf589c09b42afe109e0">n0</a>[1] = 0;</div>
<div class="line">#endif</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* !MONT_WORD */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>                { <span class="comment">/* bignum version */</span></div>
<div class="line">                mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>=<a class="code" href="bn_8h.html#ac86b87eb025891a758602a7153dbaae5">BN_num_bits</a>(&amp;mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>);</div>
<div class="line">                <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(R);</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a749422e7fccf262d029ddf941418a39a">BN_set_bit</a>(R,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>)) <span class="keywordflow">goto</span> err;  <span class="comment">/* R = 2^ri */</span></div>
<div class="line">                                                        <span class="comment">/* Ri = R^-1 mod N*/</span></div>
<div class="line">                <span class="keywordflow">if</span> ((<a class="code" href="bn_8h.html#af0a3a412b596f78d0e8737e5dbff22c3">BN_mod_inverse</a>(Ri,R,&amp;mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>,ctx)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#ae958fce9da220ca7158f9072752632a5">BN_lshift</a>(Ri,Ri,mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>)) <span class="keywordflow">goto</span> err; <span class="comment">/* R*Ri */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#af1b59addeb34d71582e7258061121fd7">BN_sub_word</a>(Ri,1)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                                                        <span class="comment">/* Ni = (R*Ri-1) / N */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#aa2d806f97ad6b75e85e001d781090eb0">BN_div</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#addf9ef45809c717971be3b8b724db8cd">Ni</a>),<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,Ri,&amp;mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>,ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="comment">/* setup RR for conversions */</span></div>
<div class="line">        <a class="code" href="bn_8h.html#ac97841d49b39ffdd49fcda8b152c0677">BN_zero</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a749422e7fccf262d029ddf941418a39a">BN_set_bit</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>),mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a62ed733165c48fa02734f7374b81dbe3">ri</a>*2)) <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="bn_8h.html#a4f1447a894029080d727d6c9a051de58">BN_mod</a>(&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>),&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#a80618d14450f431dfbd94cf22f603dda">RR</a>),&amp;(mont-&gt;<a class="code" href="structbn__mont__ctx__st.html#ab39e1c073bfde3c58c515d52f129e5fb">N</a>),ctx)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        ret = 1;</div>
<div class="line">err:</div>
<div class="line">        <a class="code" href="bn_8h.html#a79f7595a61a3e72069857a3e43902a56">BN_CTX_end</a>(ctx);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af245fe3f8bfa9eb9dbbd0ad879b6b251"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a>* BN_MONT_CTX_set_locked </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aec902d353e00ced6d3fee6cd033a8bd0">BN_MONT_CTX</a> **&#160;</td>
          <td class="paramname"><em>pmont</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#a6fb19728907ec6515e4bfb716bffa141">BIGNUM</a> *&#160;</td>
          <td class="paramname"><em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a0b235a35b7dd7922c097571ecd90e2bc">BN_CTX</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bn__mont_8c_source.html#l00480">480</a> of file <a class="el" href="bn__mont_8c_source.html">bn_mont.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> got_write_lock = 0;</div>
<div class="line">        <a class="code" href="structbn__mont__ctx__st.html">BN_MONT_CTX</a> *ret;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="crypto_8h.html#a1b327843e7f3b0e8c51d0ab1956f7c64">CRYPTO_r_lock</a>(lock);</div>
<div class="line">        <span class="keywordflow">if</span> (!*pmont)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#a55fc2b1744dc55033c8b0709a11f92fc">CRYPTO_r_unlock</a>(lock);</div>
<div class="line">                <a class="code" href="crypto_8h.html#ab3735c6a4dd562addce8043981d0ecdf">CRYPTO_w_lock</a>(lock);</div>
<div class="line">                got_write_lock = 1;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (!*pmont)</div>
<div class="line">                        {</div>
<div class="line">                        ret = <a class="code" href="bn_8h.html#a999d23b49a7dda650cc474a5d23371b3">BN_MONT_CTX_new</a>();</div>
<div class="line">                        <span class="keywordflow">if</span> (ret &amp;&amp; !<a class="code" href="bn_8h.html#a878255f2366943638d159fcf8a774493">BN_MONT_CTX_set</a>(ret, mod, ctx))</div>
<div class="line">                                <a class="code" href="bn_8h.html#a116cb1474c03454afc12f5256b6974e9">BN_MONT_CTX_free</a>(ret);</div>
<div class="line">                        <span class="keywordflow">else</span></div>
<div class="line">                                *pmont = ret;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        </div>
<div class="line">        ret = *pmont;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (got_write_lock)</div>
<div class="line">                <a class="code" href="crypto_8h.html#a337cca587e1ea6c81accc78f0373569d">CRYPTO_w_unlock</a>(lock);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="crypto_8h.html#a55fc2b1744dc55033c8b0709a11f92fc">CRYPTO_r_unlock</a>(lock);</div>
<div class="line">                </div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 15 2014 18:16:50 for openssl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
