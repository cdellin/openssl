<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/asn1/asn_mime.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_4789766cb6a80a806f336711a14ff3d1.html">asn1</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">asn_mime.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &lt;openssl/rand.h&gt;</code><br/>
<code>#include &lt;openssl/x509.h&gt;</code><br/>
<code>#include &lt;openssl/asn1.h&gt;</code><br/>
<code>#include &lt;openssl/asn1t.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="asn1__locl_8h_source.html">asn1_locl.h</a>&quot;</code><br/>
</div>
<p><a href="asn__mime_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structMIME__PARAM.html">MIME_PARAM</a></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structMIME__HEADER.html">MIME_HEADER</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af51238a973b9888b53280d93016b71b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#af51238a973b9888b53280d93016b71b6">MAX_SMLEN</a>&#160;&#160;&#160;1024</td></tr>
<tr class="memitem:a1e0cf4567555f45fe4926b7a42432805"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a1e0cf4567555f45fe4926b7a42432805">mime_debug</a>(<a class="el" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>)&#160;&#160;&#160;/* <a class="el" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a> */</td></tr>
<tr class="memitem:a5b091457df6a37f6541653633da80884"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a5b091457df6a37f6541653633da80884">MIME_INVALID</a>&#160;&#160;&#160;0</td></tr>
<tr class="memitem:ad64331c28b1d25ac1420a79f2be7b811"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#ad64331c28b1d25ac1420a79f2be7b811">MIME_START</a>&#160;&#160;&#160;1</td></tr>
<tr class="memitem:ab90152efb9d26580d27f98514cf2ca2a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#ab90152efb9d26580d27f98514cf2ca2a">MIME_TYPE</a>&#160;&#160;&#160;2</td></tr>
<tr class="memitem:afa04c07e7f8230d44fb5f38fbf9cd4d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#afa04c07e7f8230d44fb5f38fbf9cd4d5">MIME_NAME</a>&#160;&#160;&#160;3</td></tr>
<tr class="memitem:a00c8e883f7df2cc426ef47ad87c30253"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a00c8e883f7df2cc426ef47ad87c30253">MIME_VALUE</a>&#160;&#160;&#160;4</td></tr>
<tr class="memitem:abfc2efae11a68815c001026d07d2ce0c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#abfc2efae11a68815c001026d07d2ce0c">MIME_QUOTE</a>&#160;&#160;&#160;5</td></tr>
<tr class="memitem:ab76cc8478450c6254e2c02548f29f169"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#ab76cc8478450c6254e2c02548f29f169">MIME_COMMENT</a>&#160;&#160;&#160;6</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a388d05c56973084b5d51fef31546ed6d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a388d05c56973084b5d51fef31546ed6d">PEM_write_bio_ASN1_stream</a> (<a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#afdf65de9e264331943a9e5a248271311">out</a>, <a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *val, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#a006e60e2361d5936856cf2b1883c6d61">in</a>, int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, const char *hdr, const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *it)</td></tr>
<tr class="memitem:a78c99cbbb90fbb7aed945f72eb25c980"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a78c99cbbb90fbb7aed945f72eb25c980">SMIME_write_ASN1</a> (<a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *bio, <a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *val, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ec__curve_8c.html#af1780c54f65adaed36d43e53ad9afe51">data</a>, int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, int ctype_nid, int econt_nid, <a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)*mdalgs, const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *it)</td></tr>
<tr class="memitem:ad1223792f16994da711058087f5bea5d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#ad1223792f16994da711058087f5bea5d">SMIME_read_ASN1</a> (<a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *bio, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> **bcont, const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *it)</td></tr>
<tr class="memitem:a9733cdb626618d20a99ee483bcfa55aa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#a9733cdb626618d20a99ee483bcfa55aa">SMIME_crlf_copy</a> (<a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#a006e60e2361d5936856cf2b1883c6d61">in</a>, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#afdf65de9e264331943a9e5a248271311">out</a>, int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)</td></tr>
<tr class="memitem:aa0b7d82a31e8f480bc15b164dee35b4b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asn__mime_8c.html#aa0b7d82a31e8f480bc15b164dee35b4b">SMIME_text</a> (<a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#a006e60e2361d5936856cf2b1883c6d61">in</a>, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *<a class="el" href="ideatest_8c.html#afdf65de9e264331943a9e5a248271311">out</a>)</td></tr>
</table>
<h2>Macro Definition Documentation</h2>
<a class="anchor" id="af51238a973b9888b53280d93016b71b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SMLEN&#160;&#160;&#160;1024</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab76cc8478450c6254e2c02548f29f169"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_COMMENT&#160;&#160;&#160;6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00673">673</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1e0cf4567555f45fe4926b7a42432805"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define mime_debug</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a></td><td>)</td>
          <td>&#160;&#160;&#160;/* <a class="el" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a> */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a5b091457df6a37f6541653633da80884"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_INVALID&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00667">667</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="afa04c07e7f8230d44fb5f38fbf9cd4d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_NAME&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00670">670</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="abfc2efae11a68815c001026d07d2ce0c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_QUOTE&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00672">672</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad64331c28b1d25ac1420a79f2be7b811"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_START&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00668">668</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab90152efb9d26580d27f98514cf2ca2a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_TYPE&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00669">669</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<a class="anchor" id="a00c8e883f7df2cc426ef47ad87c30253"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIME_VALUE&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00671">671</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a388d05c56973084b5d51fef31546ed6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PEM_write_bio_ASN1_stream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *&#160;</td>
          <td class="paramname"><em>it</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00171">171</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> r;</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(out, <span class="stringliteral">&quot;-----BEGIN %s-----\n&quot;</span>, hdr);</div>
<div class="line">        r = B64_write_ASN1(out, val, in, <a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, it);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(out, <span class="stringliteral">&quot;-----END %s-----\n&quot;</span>, hdr);</div>
<div class="line">        <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9733cdb626618d20a99ee483bcfa55aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SMIME_crlf_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00536">536</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <a class="code" href="structbio__st.html">BIO</a> *bf;</div>
<div class="line">        <span class="keywordtype">char</span> eol;</div>
<div class="line">        <span class="keywordtype">int</span> <a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div>
<div class="line">        <span class="keywordtype">char</span> linebuf[<a class="code" href="asn__mime_8c.html#af51238a973b9888b53280d93016b71b6">MAX_SMLEN</a>];</div>
<div class="line">        <span class="comment">/* Buffer output so we don&#39;t write one line at a time. This is</span></div>
<div class="line"><span class="comment">         * useful when streaming as we don&#39;t end up with one OCTET STRING</span></div>
<div class="line"><span class="comment">         * per line.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        bf = <a class="code" href="bio_8h.html#a581a4f51e785ab7df2d032d38f589259">BIO_new</a>(<a class="code" href="bf__buff_8c.html#ad75c3eae398d1afd70f9bbd9b738e454">BIO_f_buffer</a>());</div>
<div class="line">        <span class="keywordflow">if</span> (!bf)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        out = <a class="code" href="bio_8h.html#a4e509280cddd4eb3537fe7e3bc0827a9">BIO_push</a>(bf, out);</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="pkcs7_8h.html#a8b3711e984e8d68ac47fa26ac179dbb6">SMIME_BINARY</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">while</span>((len = <a class="code" href="bio_8h.html#aa9c073049884e4f84d442529a7f14861">BIO_read</a>(in, linebuf, MAX_SMLEN)) &gt; 0)</div>
<div class="line">                                                <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, linebuf, len);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">int</span> eolcnt = 0;</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="pkcs7_8h.html#ad1e2a025c0e863a04c7e32b25b62f7e0">SMIME_TEXT</a>)</div>
<div class="line">                        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(out, <span class="stringliteral">&quot;Content-Type: text/plain\r\n\r\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">while</span> ((len = <a class="code" href="bio_8h.html#a66854c7e9d463b9655b6a949ddc581f7">BIO_gets</a>(in, linebuf, MAX_SMLEN)) &gt; 0)</div>
<div class="line">                        {</div>
<div class="line">                        eol = strip_eol(linebuf, &amp;len, <a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>);</div>
<div class="line">                        <span class="keywordflow">if</span> (len)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="comment">/* Not EOF: write out all CRLF */</span></div>
<div class="line">                                <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="pkcs7_8h.html#abe324e569e9686c7a179e6549e5b9335">SMIME_ASCIICRLF</a>)</div>
<div class="line">                                        {</div>
<div class="line">                                        <span class="keywordtype">int</span> i;</div>
<div class="line">                                        <span class="keywordflow">for</span>(i = 0; i &lt; eolcnt; i++)</div>
<div class="line">                                                <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line">                                        eolcnt = 0;</div>
<div class="line">                                        }</div>
<div class="line">                                <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, linebuf, len);</div>
<div class="line">                                <span class="keywordflow">if</span>(eol)</div>
<div class="line">                                        <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; SMIME_ASCIICRLF)</div>
<div class="line">                                eolcnt++;       </div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eol)</div>
<div class="line">                                <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, <span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        (void)<a class="code" href="bio_8h.html#a6e1d8242b642b53ee9aefdc79ff10f3e">BIO_flush</a>(out);</div>
<div class="line">        <a class="code" href="bio_8h.html#a3904b4a0c039ba9fbe4991fc08c3bd59">BIO_pop</a>(out);</div>
<div class="line">        <a class="code" href="bio_8h.html#abbfb67b5eb998ce232f2482b097da8b2">BIO_free</a>(bf);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad1223792f16994da711058087f5bea5d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a>* SMIME_read_ASN1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>bio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> **&#160;</td>
          <td class="paramname"><em>bcont</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *&#160;</td>
          <td class="paramname"><em>it</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00432">432</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <a class="code" href="structbio__st.html">BIO</a> *asnin;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structMIME__HEADER.html">MIME_HEADER</a>) *headers = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structbio__st.html">BIO</a>) *parts = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structMIME__HEADER.html">MIME_HEADER</a> *hdr;</div>
<div class="line">        <a class="code" href="structMIME__PARAM.html">MIME_PARAM</a> *prm;</div>
<div class="line">        <a class="code" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *val;</div>
<div class="line">        <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(bcont) *bcont = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!(headers = mime_parse_hdr(bio))) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>,<a class="code" href="asn1_8h.html#a3a15226bea76952228dc5607b501e20f">ASN1_R_MIME_PARSE_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(!(hdr = mime_hdr_find(headers, <span class="stringliteral">&quot;content-type&quot;</span>)) || !hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>) {</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>, <a class="code" href="asn1_8h.html#a6202956f43a336fd57335d65ead0bdc0">ASN1_R_NO_CONTENT_TYPE</a>);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Handle multipart/signed */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(!strcmp(hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;multipart/signed&quot;</span>)) {</div>
<div class="line">                <span class="comment">/* Split into two parts */</span></div>
<div class="line">                prm = mime_param_find(hdr, <span class="stringliteral">&quot;boundary&quot;</span>);</div>
<div class="line">                <span class="keywordflow">if</span>(!prm || !prm-&gt;<a class="code" href="structMIME__PARAM.html#a6b68717ccf941de4c8a383616627e90b">param_value</a>) {</div>
<div class="line">                        <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>, <a class="code" href="asn1_8h.html#a81bc50cc45d751e323a6e86e6d078c47">ASN1_R_NO_MULTIPART_BOUNDARY</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                ret = multi_split(bio, prm-&gt;<a class="code" href="structMIME__PARAM.html#a6b68717ccf941de4c8a383616627e90b">param_value</a>, &amp;parts);</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <span class="keywordflow">if</span>(!ret || (<a class="code" href="safestack_8h.html#a404af0d4ec7845b8381df63b18016d48">sk_BIO_num</a>(parts) != 2) ) {</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>, <a class="code" href="asn1_8h.html#ac394c89a38ed54ec03626ba476425303">ASN1_R_NO_MULTIPART_BODY_FAILURE</a>);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a6d0feb22d80c88191908c17ccedd8a70">sk_BIO_pop_free</a>(parts, <a class="code" href="bio_8h.html#a5f1e35aa2c0cafcfb18503fc96277400">BIO_vfree</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Parse the signature piece */</span></div>
<div class="line">                asnin = <a class="code" href="safestack_8h.html#a7489e00430e8c6c4c43822179c3a0427">sk_BIO_value</a>(parts, 1);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (!(headers = mime_parse_hdr(asnin))) {</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>,<a class="code" href="asn1_8h.html#a880d3cc94760d04d8792b0b64af76e24">ASN1_R_MIME_SIG_PARSE_ERROR</a>);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a6d0feb22d80c88191908c17ccedd8a70">sk_BIO_pop_free</a>(parts, <a class="code" href="bio_8h.html#a5f1e35aa2c0cafcfb18503fc96277400">BIO_vfree</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Get content type */</span></div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(!(hdr = mime_hdr_find(headers, <span class="stringliteral">&quot;content-type&quot;</span>)) ||</div>
<div class="line">                                                                 !hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>) {</div>
<div class="line">                        <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>, <a class="code" href="asn1_8h.html#a603ff35b058228863e183aba7c24880f">ASN1_R_NO_SIG_CONTENT_TYPE</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(strcmp(hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;application/x-pkcs7-signature&quot;</span>) &amp;&amp;</div>
<div class="line">                        strcmp(hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;application/pkcs7-signature&quot;</span>)) {</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>,<a class="code" href="asn1_8h.html#a027805225f079c8c91eaa1b92ffb8798">ASN1_R_SIG_INVALID_MIME_TYPE</a>);</div>
<div class="line">                        <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(2, <span class="stringliteral">&quot;type: &quot;</span>, hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a6d0feb22d80c88191908c17ccedd8a70">sk_BIO_pop_free</a>(parts, <a class="code" href="bio_8h.html#a5f1e35aa2c0cafcfb18503fc96277400">BIO_vfree</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <span class="comment">/* Read in ASN1 */</span></div>
<div class="line">                <span class="keywordflow">if</span>(!(val = b64_read_asn1(asnin, it))) {</div>
<div class="line">                        <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>,<a class="code" href="asn1_8h.html#a91de73b1ad701e52a28b1486269efa45">ASN1_R_ASN1_SIG_PARSE_ERROR</a>);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a6d0feb22d80c88191908c17ccedd8a70">sk_BIO_pop_free</a>(parts, <a class="code" href="bio_8h.html#a5f1e35aa2c0cafcfb18503fc96277400">BIO_vfree</a>);</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(bcont) {</div>
<div class="line">                        *bcont = <a class="code" href="safestack_8h.html#a7489e00430e8c6c4c43822179c3a0427">sk_BIO_value</a>(parts, 0);</div>
<div class="line">                        <a class="code" href="bio_8h.html#abbfb67b5eb998ce232f2482b097da8b2">BIO_free</a>(asnin);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a7954212e09d332044a8eb104db0d9cc2">sk_BIO_free</a>(parts);</div>
<div class="line">                } <span class="keywordflow">else</span> <a class="code" href="safestack_8h.html#a6d0feb22d80c88191908c17ccedd8a70">sk_BIO_pop_free</a>(parts, <a class="code" href="bio_8h.html#a5f1e35aa2c0cafcfb18503fc96277400">BIO_vfree</a>);</div>
<div class="line">                <span class="keywordflow">return</span> val;</div>
<div class="line">        }</div>
<div class="line">                </div>
<div class="line">        <span class="comment">/* OK, if not multipart/signed try opaque signature */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp (hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;application/x-pkcs7-mime&quot;</span>) &amp;&amp;</div>
<div class="line">            strcmp (hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;application/pkcs7-mime&quot;</span>)) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>,<a class="code" href="asn1_8h.html#a2f611592411b7b9a7b6bb75aecc5c22f">ASN1_R_INVALID_MIME_TYPE</a>);</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(2, <span class="stringliteral">&quot;type: &quot;</span>, hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>);</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>(!(val = b64_read_asn1(bio, it))) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#ae638d0215da51529eff8cb1b66a230a6">ASN1_F_SMIME_READ_ASN1</a>, <a class="code" href="asn1_8h.html#a2ec1549260a83f07fde4c5a5b5081576">ASN1_R_ASN1_PARSE_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> val;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa0b7d82a31e8f480bc15b164dee35b4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SMIME_text </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00590">590</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span> iobuf[4096];</div>
<div class="line">        <span class="keywordtype">int</span> <a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structMIME__HEADER.html">MIME_HEADER</a>) *headers;</div>
<div class="line">        <a class="code" href="structMIME__HEADER.html">MIME_HEADER</a> *hdr;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!(headers = mime_parse_hdr(in))) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#a95946c8f1f21a4d1ef1612493d911070">ASN1_F_SMIME_TEXT</a>,<a class="code" href="asn1_8h.html#a3a15226bea76952228dc5607b501e20f">ASN1_R_MIME_PARSE_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(!(hdr = mime_hdr_find(headers, <span class="stringliteral">&quot;content-type&quot;</span>)) || !hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#a95946c8f1f21a4d1ef1612493d911070">ASN1_F_SMIME_TEXT</a>,<a class="code" href="asn1_8h.html#a13967625f2c9621c5350aa10cbf96189">ASN1_R_MIME_NO_CONTENT_TYPE</a>);</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp (hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>, <span class="stringliteral">&quot;text/plain&quot;</span>)) {</div>
<div class="line">                <a class="code" href="err_8h.html#aee1665e6ac96d8693cecb07c2d2c7c8e">ASN1err</a>(<a class="code" href="asn1_8h.html#a95946c8f1f21a4d1ef1612493d911070">ASN1_F_SMIME_TEXT</a>,<a class="code" href="asn1_8h.html#a2f611592411b7b9a7b6bb75aecc5c22f">ASN1_R_INVALID_MIME_TYPE</a>);</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(2, <span class="stringliteral">&quot;type: &quot;</span>, hdr-&gt;<a class="code" href="structMIME__HEADER.html#a757e0e848d690828cd66209b3ff14baa">value</a>);</div>
<div class="line">                <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="safestack_8h.html#af42c1413231ce58ee861bd31790d6c32">sk_MIME_HEADER_pop_free</a>(headers, mime_hdr_free);</div>
<div class="line">        <span class="keywordflow">while</span> ((len = <a class="code" href="bio_8h.html#aa9c073049884e4f84d442529a7f14861">BIO_read</a>(in, iobuf, <span class="keyword">sizeof</span>(iobuf))) &gt; 0)</div>
<div class="line">                                                <a class="code" href="bio_8h.html#a7b4c64ffdc342154cf923744210a8429">BIO_write</a>(out, iobuf, len);</div>
<div class="line">        <span class="keywordflow">if</span> (len &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a78c99cbbb90fbb7aed945f72eb25c980"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SMIME_write_ASN1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>bio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ctype_nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>econt_nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)*&#160;</td>
          <td class="paramname"><em>mdalgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aea7867d0d5f4d561d2cbf24a9ce49e40">ASN1_ITEM</a> *&#160;</td>
          <td class="paramname"><em>it</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="asn__mime_8c_source.html#l00278">278</a> of file <a class="el" href="asn__mime_8c_source.html">asn_mime.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span> bound[33], <a class="code" href="ideatest_8c.html#aa8bc5d06b176e45541cdfaf9c2c9dfea">c</a>;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *mime_prefix, *mime_eol, *cname = <span class="stringliteral">&quot;smime.p7m&quot;</span>;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *msg_type=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="asn1_8h.html#acf9b371c44923490ecfbf84195d6373d">SMIME_OLDMIME</a>)</div>
<div class="line">                mime_prefix = <span class="stringliteral">&quot;application/x-pkcs7-&quot;</span>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                mime_prefix = <span class="stringliteral">&quot;application/pkcs7-&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="asn1_8h.html#a765953ac19f9777a5a5d755b81bcd8de">SMIME_CRLFEOL</a>)</div>
<div class="line">                mime_eol = <span class="stringliteral">&quot;\r\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                mime_eol = <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span>((<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="pkcs7_8h.html#a3bc51ea5e44588ee8e8a22cce0968811">SMIME_DETACHED</a>) &amp;&amp; data) {</div>
<div class="line">        <span class="comment">/* We want multipart/signed */</span></div>
<div class="line">                <span class="comment">/* Generate a random boundary */</span></div>
<div class="line">                <a class="code" href="rand_8h.html#a8a4e911a9be281eb797faa8590637ac3">RAND_pseudo_bytes</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)bound, 32);</div>
<div class="line">                <span class="keywordflow">for</span>(i = 0; i &lt; 32; i++) {</div>
<div class="line">                        c = bound[i] &amp; 0xf;</div>
<div class="line">                        <span class="keywordflow">if</span>(c &lt; 10) c += <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">                        <span class="keywordflow">else</span> c += <span class="charliteral">&#39;A&#39;</span> - 10;</div>
<div class="line">                        bound[i] = c;</div>
<div class="line">                }</div>
<div class="line">                bound[32] = 0;</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;MIME-Version: 1.0%s&quot;</span>, mime_eol);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Type: multipart/signed;&quot;</span>);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; protocol=\&quot;%ssignature\&quot;;&quot;</span>, mime_prefix);</div>
<div class="line">                <a class="code" href="bio_8h.html#a69ef4de9bee4e518fbcebd999d1b3358">BIO_puts</a>(bio, <span class="stringliteral">&quot; micalg=\&quot;&quot;</span>);</div>
<div class="line">                asn1_write_micalg(bio, mdalgs);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;\&quot;; boundary=\&quot;----%s\&quot;%s%s&quot;</span>,</div>
<div class="line">                                                bound, mime_eol, mime_eol);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;This is an S/MIME signed message%s%s&quot;</span>,</div>
<div class="line">                                                mime_eol, mime_eol);</div>
<div class="line">                <span class="comment">/* Now write out the first part */</span></div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;------%s%s&quot;</span>, bound, mime_eol);</div>
<div class="line">                <span class="keywordflow">if</span> (!asn1_output_data(bio, data, val, <a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, it))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;%s------%s%s&quot;</span>, mime_eol, bound, mime_eol);</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Headers for signature */</span></div>
<div class="line"></div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Type: %ssignature;&quot;</span>, mime_prefix); </div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; name=\&quot;smime.p7s\&quot;%s&quot;</span>, mime_eol);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Transfer-Encoding: base64%s&quot;</span>,</div>
<div class="line">                                                                mime_eol);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Disposition: attachment;&quot;</span>);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; filename=\&quot;smime.p7s\&quot;%s%s&quot;</span>,</div>
<div class="line">                                                        mime_eol, mime_eol);</div>
<div class="line">                B64_write_ASN1(bio, val, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, 0, it);</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio,<span class="stringliteral">&quot;%s------%s--%s%s&quot;</span>, mime_eol, bound,</div>
<div class="line">                                                        mime_eol, mime_eol);</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Determine smime-type header */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (ctype_nid == <a class="code" href="obj__mac_8h.html#a4587e848643383571699c4b1fdaf5710">NID_pkcs7_enveloped</a>)</div>
<div class="line">                msg_type = <span class="stringliteral">&quot;enveloped-data&quot;</span>;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctype_nid == <a class="code" href="obj__mac_8h.html#a085f07bc1100332366a5675145f8fea9">NID_pkcs7_signed</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (econt_nid == <a class="code" href="obj__mac_8h.html#af2ef6f53a32ba0f8dd0b3377bedc02d0">NID_id_smime_ct_receipt</a>)</div>
<div class="line">                        msg_type = <span class="stringliteral">&quot;signed-receipt&quot;</span>;</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="safestack_8h.html#a94c75bbf81b8ad2a5ae09b10c8e47719">sk_X509_ALGOR_num</a>(mdalgs) &gt;= 0)</div>
<div class="line">                        msg_type = <span class="stringliteral">&quot;signed-data&quot;</span>;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        msg_type = <span class="stringliteral">&quot;certs-only&quot;</span>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctype_nid == <a class="code" href="obj__mac_8h.html#a9abb7bbfc6731d3e9b72e01cbd595357">NID_id_smime_ct_compressedData</a>)</div>
<div class="line">                {</div>
<div class="line">                msg_type = <span class="stringliteral">&quot;compressed-data&quot;</span>;</div>
<div class="line">                cname = <span class="stringliteral">&quot;smime.p7z&quot;</span>;</div>
<div class="line">                }</div>
<div class="line">        <span class="comment">/* MIME headers */</span></div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;MIME-Version: 1.0%s&quot;</span>, mime_eol);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Disposition: attachment;&quot;</span>);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; filename=\&quot;%s\&quot;%s&quot;</span>, cname, mime_eol);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Type: %smime;&quot;</span>, mime_prefix);</div>
<div class="line">        <span class="keywordflow">if</span> (msg_type)</div>
<div class="line">                <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; smime-type=%s;&quot;</span>, msg_type);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot; name=\&quot;%s\&quot;%s&quot;</span>, cname, mime_eol);</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;Content-Transfer-Encoding: base64%s%s&quot;</span>,</div>
<div class="line">                                                mime_eol, mime_eol);</div>
<div class="line">        <span class="keywordflow">if</span> (!B64_write_ASN1(bio, val, data, <a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, it))</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <a class="code" href="b__print_8c.html#a53da52fd1c69fe357b8a122476352be7">BIO_printf</a>(bio, <span class="stringliteral">&quot;%s&quot;</span>, mime_eol);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
