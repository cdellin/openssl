<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/bio/b_sock.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_c5a221fb10ad418f17266024703620f0.html">bio</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">b_sock.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &lt;openssl/bio.h&gt;</code><br/>
<code>#include &lt;openssl/dso.h&gt;</code><br/>
</div>
<p><a href="b__sock_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acc88493bed5c7a1a3f7485dae7e0f955"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#acc88493bed5c7a1a3f7485dae7e0f955">USE_SOCKETS</a></td></tr>
<tr class="memitem:a8e10ae8c6cefe057e750e3b990beb676"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a8e10ae8c6cefe057e750e3b990beb676">SOCKET_PROTOCOL</a>&#160;&#160;&#160;IPPROTO_TCP</td></tr>
<tr class="memitem:a53cd64db72112e00cc1f75a37ea63fea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a53cd64db72112e00cc1f75a37ea63fea">MAX_LISTEN</a>&#160;&#160;&#160;32</td></tr>
<tr class="memitem:afbdb42805685c4b213b23e664f760c9f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#afbdb42805685c4b213b23e664f760c9f">WSAAPI</a></td></tr>
<tr class="memitem:a15daceb4f37933a09e36c0bfc3e32a98"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a15daceb4f37933a09e36c0bfc3e32a98">ARG</a>&#160;&#160;&#160;<a class="el" href="e__rc5_8c.html#ab61d1a51a70b259a10d7e90ff697c353">arg</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9ac252994f2822546107d2f397afec3a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a9ac252994f2822546107d2f397afec3a">BIO_get_host_ip</a> (const char *str, unsigned char *ip)</td></tr>
<tr class="memitem:a9601f713826f683d851233f648b91327"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a9601f713826f683d851233f648b91327">BIO_get_port</a> (const char *str, unsigned short *port_ptr)</td></tr>
<tr class="memitem:a3046dd8f230fdd7a3d1874325454de40"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a3046dd8f230fdd7a3d1874325454de40">BIO_sock_error</a> (int sock)</td></tr>
<tr class="memitem:a7c6afb9ffbb3ea16ca393446e201ddfc"><td class="memItemLeft" align="right" valign="top">struct hostent *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a7c6afb9ffbb3ea16ca393446e201ddfc">BIO_gethostbyname</a> (const char *name)</td></tr>
<tr class="memitem:a20faadb1e189edc057ed0118a6ab355b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a20faadb1e189edc057ed0118a6ab355b">BIO_sock_init</a> (void)</td></tr>
<tr class="memitem:a6228766432b0ae96ee00746229323bdf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a6228766432b0ae96ee00746229323bdf">BIO_sock_cleanup</a> (void)</td></tr>
<tr class="memitem:a8166ad9704ff85f1c9b22dd2d3e87352"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a8166ad9704ff85f1c9b22dd2d3e87352">BIO_socket_ioctl</a> (int fd, long <a class="el" href="x509_8h.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>, void *<a class="el" href="e__rc5_8c.html#ab61d1a51a70b259a10d7e90ff697c353">arg</a>)</td></tr>
<tr class="memitem:abdf2dff7a11f9d6dd0ac4f67e32e36a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#abdf2dff7a11f9d6dd0ac4f67e32e36a8">BIO_get_accept_socket</a> (char *host, int bind_mode)</td></tr>
<tr class="memitem:a3a817ed4dfe3398257206593132a5276"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a3a817ed4dfe3398257206593132a5276">BIO_accept</a> (int sock, char **addr)</td></tr>
<tr class="memitem:a767d2f524ed140b4fffc1c16344ce58e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a767d2f524ed140b4fffc1c16344ce58e">BIO_set_tcp_ndelay</a> (int s, int on)</td></tr>
<tr class="memitem:a220a26749987ae25ec3fcbd33ce53dad"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="b__sock_8c.html#a220a26749987ae25ec3fcbd33ce53dad">BIO_socket_nbio</a> (int s, int mode)</td></tr>
</table>
<h2>Macro Definition Documentation</h2>
<a class="anchor" id="a15daceb4f37933a09e36c0bfc3e32a98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ARG&#160;&#160;&#160;<a class="el" href="e__rc5_8c.html#ab61d1a51a70b259a10d7e90ff697c353">arg</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a53cd64db72112e00cc1f75a37ea63fea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_LISTEN&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00084">84</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8e10ae8c6cefe057e750e3b990beb676"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SOCKET_PROTOCOL&#160;&#160;&#160;IPPROTO_TCP</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00077">77</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>

</div>
</div>
<a class="anchor" id="acc88493bed5c7a1a3f7485dae7e0f955"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USE_SOCKETS</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00062">62</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbdb42805685c4b213b23e664f760c9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WSAAPI</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00099">99</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a3a817ed4dfe3398257206593132a5276"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_accept </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00828">828</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret=INVALID_SOCKET;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> l;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port;</div>
<div class="line">        <span class="keywordtype">char</span> *p;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * As for following union. Trouble is that there are platforms</span></div>
<div class="line"><span class="comment">         * that have socklen_t and there are platforms that don&#39;t, on</span></div>
<div class="line"><span class="comment">         * some platforms socklen_t is int and on some size_t. So what</span></div>
<div class="line"><span class="comment">         * one can do? One can cook #ifdef spaghetti, which is nothing</span></div>
<div class="line"><span class="comment">         * but masochistic. Or one can do union between int and size_t.</span></div>
<div class="line"><span class="comment">         * One naturally does it primarily for 64-bit platforms where</span></div>
<div class="line"><span class="comment">         * sizeof(int) != sizeof(size_t). But would it work? Note that</span></div>
<div class="line"><span class="comment">         * if size_t member is initialized to 0, then later int member</span></div>
<div class="line"><span class="comment">         * assignment naturally does the job on little-endian platforms</span></div>
<div class="line"><span class="comment">         * regardless accept&#39;s expectations! What about big-endians?</span></div>
<div class="line"><span class="comment">         * If accept expects int*, then it works, and if size_t*, then</span></div>
<div class="line"><span class="comment">         * length value would appear as unreasonably large. But this</span></div>
<div class="line"><span class="comment">         * won&#39;t prevent it from filling in the address structure. The</span></div>
<div class="line"><span class="comment">         * trouble of course would be if accept returns more data than</span></div>
<div class="line"><span class="comment">         * actual buffer can accomodate and overwrite stack... That&#39;s</span></div>
<div class="line"><span class="comment">         * where early OPENSSL_assert comes into picture. Besides, the</span></div>
<div class="line"><span class="comment">         * only 64-bit big-endian platform found so far that expects</span></div>
<div class="line"><span class="comment">         * size_t* is HP-UX, where stack grows towards higher address.</span></div>
<div class="line"><span class="comment">         * &lt;appro&gt;</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keyword">union </span>{ <span class="keywordtype">size_t</span> s; <span class="keywordtype">int</span> i; } <a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>;</div>
<div class="line">        <span class="keyword">union </span>{</div>
<div class="line">                <span class="keyword">struct </span>sockaddr sa;</div>
<div class="line">                <span class="keyword">struct </span>sockaddr_in sa_in;</div>
<div class="line"><span class="preprocessor">#if OPENSSL_USE_IPV6</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keyword">struct </span>sockaddr_in6 sa_in6;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                } from;</div>
<div class="line">        } sa;</div>
<div class="line"></div>
<div class="line">        sa.len.s=0;</div>
<div class="line">        sa.len.i=<span class="keyword">sizeof</span>(sa.from);</div>
<div class="line">        memset(&amp;sa.from,0,<span class="keyword">sizeof</span>(sa.from));</div>
<div class="line">        ret=accept(sock,&amp;sa.from.sa,(<span class="keywordtype">void</span> *)&amp;sa.len);</div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(sa.len.i)!=<span class="keyword">sizeof</span>(sa.len.s) &amp;&amp; sa.len.i==0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#a6e3638bf542fc7a6a394f34124aa2cba">OPENSSL_assert</a>(sa.len.s&lt;=<span class="keyword">sizeof</span>(sa.from));</div>
<div class="line">                sa.len.i = (int)sa.len.s;</div>
<div class="line">                <span class="comment">/* use sa.len.i from this point */</span></div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (ret == INVALID_SOCKET)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="bio_8h.html#a1a2237c28a33853e4a3907142c7bdcaa">BIO_sock_should_retry</a>(ret)) <span class="keywordflow">return</span> -2;</div>
<div class="line">                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a029327b0e777ddb7e9f200f7d4f97976">SYS_F_ACCEPT</a>,get_last_socket_error());</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a4cfa9951a8cbc04388d21bf225b0ea0c">BIO_F_BIO_ACCEPT</a>,<a class="code" href="bio_8h.html#ae50e927c1dd13584942a3af7c117a3e4">BIO_R_ACCEPT_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> end;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (addr == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">goto</span> end;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef EAI_FAMILY</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordtype">char</span>   <a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>[NI_MAXHOST],s[NI_MAXSERV];</div>
<div class="line">        <span class="keywordtype">size_t</span> nl;</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">union </span>{  <span class="keywordtype">void</span> *p;</div>
<div class="line">                        int (<a class="code" href="b__sock_8c.html#afbdb42805685c4b213b23e664f760c9f">WSAAPI</a> *f)(<span class="keyword">const</span> <span class="keyword">struct </span>sockaddr *,<span class="keywordtype">size_t</span><span class="comment">/*socklen_t*/</span>,</div>
<div class="line">                                 <span class="keywordtype">char</span> *,size_t,<span class="keywordtype">char</span> *,size_t,int);</div>
<div class="line">                        } p_getnameinfo = {<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>};</div>
<div class="line">                        <span class="comment">/* 2nd argument to getnameinfo is specified to</span></div>
<div class="line"><span class="comment">                         * be socklen_t. Unfortunately there is a number</span></div>
<div class="line"><span class="comment">                         * of environments where socklen_t is not defined.</span></div>
<div class="line"><span class="comment">                         * As it&#39;s passed by value, it&#39;s safe to pass it</span></div>
<div class="line"><span class="comment">                         * as size_t... &lt;appro&gt; */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (p_getnameinfo.p==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((p_getnameinfo.p=<a class="code" href="dso_8h.html#a8d321dbc52fa35ef1f7c3d40849ae76b">DSO_global_lookup</a>(<span class="stringliteral">&quot;getnameinfo&quot;</span>))==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        p_getnameinfo.p=(<span class="keywordtype">void</span>*)-1;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (p_getnameinfo.p==(<span class="keywordtype">void</span> *)-1) <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((*p_getnameinfo.f)(&amp;sa.from.sa,sa.len.i,<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>,<span class="keyword">sizeof</span>(<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>),s,<span class="keyword">sizeof</span>(s),</div>
<div class="line">            NI_NUMERICHOST|NI_NUMERICSERV)) <span class="keywordflow">break</span>;</div>
<div class="line">        nl = strlen(h)+strlen(s)+2;</div>
<div class="line">        p = *addr;</div>
<div class="line">        <span class="keywordflow">if</span> (p)  { *p = <span class="charliteral">&#39;\0&#39;</span>; p = <a class="code" href="crypto_8h.html#aba1c282c55c099a7f164b9380febfdf9">OPENSSL_realloc</a>(p,nl); }</div>
<div class="line">        <span class="keywordflow">else</span>    { p = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(nl);               }</div>
<div class="line">        <span class="keywordflow">if</span> (p==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a4cfa9951a8cbc04388d21bf225b0ea0c">BIO_F_BIO_ACCEPT</a>,<a class="code" href="err_8h.html#ae17d140bd9b2b4d297015e6a260d63c2">ERR_R_MALLOC_FAILURE</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> end;</div>
<div class="line">                }</div>
<div class="line">        *addr = p;</div>
<div class="line">        <a class="code" href="b__print_8c.html#a81ca789053c48a3b5201d3dc2431b0dd">BIO_snprintf</a>(*addr,nl,<span class="stringliteral">&quot;%s:%s&quot;</span>,h,s);</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">        } <span class="keywordflow">while</span>(0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (sa.from.sa.sa_family != AF_INET) <span class="keywordflow">goto</span> end;</div>
<div class="line">        l=ntohl(sa.from.sa_in.sin_addr.s_addr);</div>
<div class="line">        port=ntohs(sa.from.sa_in.sin_port);</div>
<div class="line">        <span class="keywordflow">if</span> (*addr == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((p=<a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(24)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a4cfa9951a8cbc04388d21bf225b0ea0c">BIO_F_BIO_ACCEPT</a>,<a class="code" href="err_8h.html#ae17d140bd9b2b4d297015e6a260d63c2">ERR_R_MALLOC_FAILURE</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> end;</div>
<div class="line">                        }</div>
<div class="line">                *addr=p;</div>
<div class="line">                }</div>
<div class="line">        <a class="code" href="b__print_8c.html#a81ca789053c48a3b5201d3dc2431b0dd">BIO_snprintf</a>(*addr,24,<span class="stringliteral">&quot;%d.%d.%d.%d:%d&quot;</span>,</div>
<div class="line">                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(l&gt;&gt;24L)&amp;0xff,</div>
<div class="line">                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(l&gt;&gt;16L)&amp;0xff,</div>
<div class="line">                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(l&gt;&gt; 8L)&amp;0xff,</div>
<div class="line">                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(l     )&amp;0xff,</div>
<div class="line">                     port);</div>
<div class="line">end:</div>
<div class="line">        <span class="keywordflow">return</span>(ret);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abdf2dff7a11f9d6dd0ac4f67e32e36a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_get_accept_socket </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bind_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00623">623</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret=0;</div>
<div class="line">        <span class="keyword">union </span>{</div>
<div class="line">                <span class="keyword">struct </span>sockaddr sa;</div>
<div class="line">                <span class="keyword">struct </span>sockaddr_in sa_in;</div>
<div class="line"><span class="preprocessor">#if OPENSSL_USE_IPV6</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keyword">struct </span>sockaddr_in6 sa_in6;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        } server,client;</div>
<div class="line">        <span class="keywordtype">int</span> s=INVALID_SOCKET,cs,addrlen;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ip[4];</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port;</div>
<div class="line">        <span class="keywordtype">char</span> *str=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>,*e;</div>
<div class="line">        <span class="keywordtype">char</span> *<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>,*p;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> l;</div>
<div class="line">        <span class="keywordtype">int</span> err_num;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="b__sock_8c.html#a20faadb1e189edc057ed0118a6ab355b">BIO_sock_init</a>() != 1) <span class="keywordflow">return</span>(INVALID_SOCKET);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((str=<a class="code" href="buf__str_8c.html#a5fd2e2db1bea821930a6f96f2ec22ed3">BUF_strdup</a>(host)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <span class="keywordflow">return</span>(INVALID_SOCKET);</div>
<div class="line"></div>
<div class="line">        h=p=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        h=str;</div>
<div class="line">        <span class="keywordflow">for</span> (e=str; *e; e++)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (*e == <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line">                        {</div>
<div class="line">                        p=e;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*e == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line">                        {</div>
<div class="line">                        *e=<span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (p)  *p++=<span class="charliteral">&#39;\0&#39;</span>;      <span class="comment">/* points at last &#39;:&#39;, &#39;::port&#39; is special [see below] */</span></div>
<div class="line">        <span class="keywordflow">else</span>    p=<a class="code" href="ec__curve_8c.html#a5138e082c1d42b393c076f8f796b3c96">h</a>,h=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef EAI_FAMILY</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">union </span>{  <span class="keywordtype">void</span> *p;</div>
<div class="line">                        int (<a class="code" href="b__sock_8c.html#afbdb42805685c4b213b23e664f760c9f">WSAAPI</a> *f)(<span class="keyword">const</span> <span class="keywordtype">char</span> *,<span class="keyword">const</span> <span class="keywordtype">char</span> *,</div>
<div class="line">                                 <span class="keyword">const</span> <span class="keyword">struct </span>addrinfo *,</div>
<div class="line">                                 <span class="keyword">struct </span>addrinfo **);</div>
<div class="line">                        } p_getaddrinfo = {<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>};</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">union </span>{  <span class="keywordtype">void</span> *p;</div>
<div class="line">                        void (<a class="code" href="b__sock_8c.html#afbdb42805685c4b213b23e664f760c9f">WSAAPI</a> *f)(<span class="keyword">struct </span>addrinfo *);</div>
<div class="line">                        } p_freeaddrinfo = {<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>};</div>
<div class="line">        <span class="keyword">struct </span>addrinfo *res,hint;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (p_getaddrinfo.p==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> ((p_getaddrinfo.p=<a class="code" href="dso_8h.html#a8d321dbc52fa35ef1f7c3d40849ae76b">DSO_global_lookup</a>(<span class="stringliteral">&quot;getaddrinfo&quot;</span>))==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> ||</div>
<div class="line">                    (p_freeaddrinfo.p=<a class="code" href="dso_8h.html#a8d321dbc52fa35ef1f7c3d40849ae76b">DSO_global_lookup</a>(<span class="stringliteral">&quot;freeaddrinfo&quot;</span>))==<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        p_getaddrinfo.p=(<span class="keywordtype">void</span>*)-1;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (p_getaddrinfo.p==(<span class="keywordtype">void</span> *)-1) <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* &#39;::port&#39; enforces IPv6 wildcard listener. Some OSes,</span></div>
<div class="line"><span class="comment">         * e.g. Solaris, default to IPv6 without any hint. Also</span></div>
<div class="line"><span class="comment">         * note that commonly IPv6 wildchard socket can service</span></div>
<div class="line"><span class="comment">         * IPv4 connections just as well...  */</span></div>
<div class="line">        memset(&amp;hint,0,<span class="keyword">sizeof</span>(hint));</div>
<div class="line">        hint.ai_flags = AI_PASSIVE;</div>
<div class="line">        <span class="keywordflow">if</span> (h)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (strchr(h,<span class="charliteral">&#39;:&#39;</span>))</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (h[1]==<span class="charliteral">&#39;\0&#39;</span>) h=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"><span class="preprocessor">#if OPENSSL_USE_IPV6</span></div>
<div class="line"><span class="preprocessor"></span>                        hint.ai_family = AF_INET6;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                        h=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (h[0]==<span class="charliteral">&#39;*&#39;</span> &amp;&amp; h[1]==<span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line">                        {</div>
<div class="line">                        hint.ai_family = AF_INET;</div>
<div class="line">                        h=<a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((*p_getaddrinfo.f)(h,p,&amp;hint,&amp;res)) <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        addrlen = res-&gt;ai_addrlen&lt;=<span class="keyword">sizeof</span>(server) ?</div>
<div class="line">                        res-&gt;ai_addrlen :</div>
<div class="line">                        <span class="keyword">sizeof</span>(server);</div>
<div class="line">        memcpy(&amp;server, res-&gt;ai_addr, addrlen);</div>
<div class="line"></div>
<div class="line">        (*p_freeaddrinfo.f)(res);</div>
<div class="line">        <span class="keywordflow">goto</span> again;</div>
<div class="line">        } <span class="keywordflow">while</span> (0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="b__sock_8c.html#a9601f713826f683d851233f648b91327">BIO_get_port</a>(p,&amp;port)) <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        memset((<span class="keywordtype">char</span> *)&amp;server,0,<span class="keyword">sizeof</span>(server));</div>
<div class="line">        server.sa_in.sin_family=AF_INET;</div>
<div class="line">        server.sa_in.sin_port=htons(port);</div>
<div class="line">        addrlen = <span class="keyword">sizeof</span>(server.sa_in);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (h == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || strcmp(h,<span class="stringliteral">&quot;*&quot;</span>) == 0)</div>
<div class="line">                server.sa_in.sin_addr.s_addr=INADDR_ANY;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                if (!<a class="code" href="b__sock_8c.html#a9ac252994f2822546107d2f397afec3a">BIO_get_host_ip</a>(h,&amp;(ip[0]))) <span class="keywordflow">goto</span> err;</div>
<div class="line">                l=(<span class="keywordtype">unsigned</span> long)</div>
<div class="line">                        ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ip[0]&lt;&lt;24L)|</div>
<div class="line">                        ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ip[1]&lt;&lt;16L)|</div>
<div class="line">                        ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ip[2]&lt;&lt; 8L)|</div>
<div class="line">                        ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ip[3]);</div>
<div class="line">                server.sa_in.sin_addr.s_addr=htonl(l);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">again:</div>
<div class="line">        s=socket(server.sa.sa_family,SOCK_STREAM,<a class="code" href="b__sock_8c.html#a8e10ae8c6cefe057e750e3b990beb676">SOCKET_PROTOCOL</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (s == INVALID_SOCKET)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a144b0fa92037fb4f1aac3c0874bfed49">SYS_F_SOCKET</a>,get_last_socket_error());</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(3,<span class="stringliteral">&quot;port=&#39;&quot;</span>,host,<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#ae94963922fd814cb0a151f5857f6b8f7">BIO_F_BIO_GET_ACCEPT_SOCKET</a>,<a class="code" href="bio_8h.html#aed6e4a48c000518fe903189f1675e27b">BIO_R_UNABLE_TO_CREATE_SOCKET</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef SO_REUSEADDR</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (bind_mode == <a class="code" href="bio_8h.html#a85fe4e4fc2a9c805f80a5db69eafd5ff">BIO_BIND_REUSEADDR</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">int</span> i=1;</div>
<div class="line"></div>
<div class="line">                ret=setsockopt(s,SOL_SOCKET,SO_REUSEADDR,(<span class="keywordtype">char</span> *)&amp;i,<span class="keyword">sizeof</span>(i));</div>
<div class="line">                bind_mode=<a class="code" href="bio_8h.html#a6822c29879d7331158e48c4ec2f8f10e">BIO_BIND_NORMAL</a>;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (bind(s,&amp;server.sa,addrlen) == -1)</div>
<div class="line">                {</div>
<div class="line"><span class="preprocessor">#ifdef SO_REUSEADDR</span></div>
<div class="line"><span class="preprocessor"></span>                err_num=get_last_socket_error();</div>
<div class="line">                <span class="keywordflow">if</span> ((bind_mode == <a class="code" href="bio_8h.html#a5f193ee0839d72321e0061f0c6c774ea">BIO_BIND_REUSEADDR_IF_UNUSED</a>) &amp;&amp;</div>
<div class="line">#ifdef OPENSSL_SYS_WINDOWS</div>
<div class="line">                        <span class="comment">/* Some versions of Windows define EADDRINUSE to</span></div>
<div class="line"><span class="comment">                         * a dummy value.</span></div>
<div class="line"><span class="comment">                         */</span></div>
<div class="line">                        (err_num == WSAEADDRINUSE))</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                        (err_num == EADDRINUSE))</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        {</div>
<div class="line">                        client = server;</div>
<div class="line">                        <span class="keywordflow">if</span> (h == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a> || strcmp(h,<span class="stringliteral">&quot;*&quot;</span>) == 0)</div>
<div class="line">                                {</div>
<div class="line"><span class="preprocessor">#if OPENSSL_USE_IPV6</span></div>
<div class="line"><span class="preprocessor"></span>                                <span class="keywordflow">if</span> (client.sa.sa_family == AF_INET6)</div>
<div class="line">                                        {</div>
<div class="line">                                        memset(&amp;client.sa_in6.sin6_addr,0,<span class="keyword">sizeof</span>(client.sa_in6.sin6_addr));</div>
<div class="line">                                        client.sa_in6.sin6_addr.s6_addr[15]=1;</div>
<div class="line">                                        }</div>
<div class="line">                                <span class="keywordflow">else</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                                <span class="keywordflow">if</span> (client.sa.sa_family == AF_INET)</div>
<div class="line">                                        {</div>
<div class="line">                                        client.sa_in.sin_addr.s_addr=htonl(0x7F000001);</div>
<div class="line">                                        }</div>
<div class="line">                                <span class="keywordflow">else</span>    <span class="keywordflow">goto</span> err;</div>
<div class="line">                                }</div>
<div class="line">                        cs=socket(client.sa.sa_family,SOCK_STREAM,<a class="code" href="b__sock_8c.html#a8e10ae8c6cefe057e750e3b990beb676">SOCKET_PROTOCOL</a>);</div>
<div class="line">                        <span class="keywordflow">if</span> (cs != INVALID_SOCKET)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordtype">int</span> ii;</div>
<div class="line">                                ii=connect(cs,&amp;client.sa,addrlen);</div>
<div class="line">                                closesocket(cs);</div>
<div class="line">                                <span class="keywordflow">if</span> (ii == INVALID_SOCKET)</div>
<div class="line">                                        {</div>
<div class="line">                                        bind_mode=<a class="code" href="bio_8h.html#a85fe4e4fc2a9c805f80a5db69eafd5ff">BIO_BIND_REUSEADDR</a>;</div>
<div class="line">                                        closesocket(s);</div>
<div class="line">                                        <span class="keywordflow">goto</span> again;</div>
<div class="line">                                        }</div>
<div class="line">                                <span class="comment">/* else error */</span></div>
<div class="line">                                }</div>
<div class="line">                        <span class="comment">/* else error */</span></div>
<div class="line">                        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a1ed5f42b46ac3ec2b1e67121634af0b9">SYS_F_BIND</a>,err_num);</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(3,<span class="stringliteral">&quot;port=&#39;&quot;</span>,host,<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#ae94963922fd814cb0a151f5857f6b8f7">BIO_F_BIO_GET_ACCEPT_SOCKET</a>,<a class="code" href="bio_8h.html#adb3792aa4167a1840c20948c9d583a89">BIO_R_UNABLE_TO_BIND_SOCKET</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (listen(s,<a class="code" href="b__sock_8c.html#a53cd64db72112e00cc1f75a37ea63fea">MAX_LISTEN</a>) == -1)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a1ed5f42b46ac3ec2b1e67121634af0b9">SYS_F_BIND</a>,get_last_socket_error());</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(3,<span class="stringliteral">&quot;port=&#39;&quot;</span>,host,<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#ae94963922fd814cb0a151f5857f6b8f7">BIO_F_BIO_GET_ACCEPT_SOCKET</a>,<a class="code" href="bio_8h.html#abd3d26d294ec7c907ffee2435bbd57bb">BIO_R_UNABLE_TO_LISTEN_SOCKET</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        ret=1;</div>
<div class="line">err:</div>
<div class="line">        <span class="keywordflow">if</span> (str != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>) <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(str);</div>
<div class="line">        <span class="keywordflow">if</span> ((ret == 0) &amp;&amp; (s != INVALID_SOCKET))</div>
<div class="line">                {</div>
<div class="line">                closesocket(s);</div>
<div class="line">                s= INVALID_SOCKET;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span>(s);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9ac252994f2822546107d2f397afec3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_get_host_ip </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00120">120</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keywordtype">int</span> err = 1;</div>
<div class="line">        <span class="keywordtype">int</span> locked = 0;</div>
<div class="line">        <span class="keyword">struct </span>hostent *he;</div>
<div class="line"></div>
<div class="line">        i=get_ip(str,ip);</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; 0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a136193d082857189e5320b8824cf0496">BIO_F_BIO_GET_HOST_IP</a>,<a class="code" href="bio_8h.html#a7ab0e8f79f4fe10c3d3c2faecf36bcd8">BIO_R_INVALID_IP_ADDRESS</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* At this point, we have something that is most probably correct</span></div>
<div class="line"><span class="comment">           in some way, so let&#39;s init the socket. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="b__sock_8c.html#a20faadb1e189edc057ed0118a6ab355b">BIO_sock_init</a>() != 1)</div>
<div class="line">                <span class="keywordflow">return</span> 0; <span class="comment">/* don&#39;t generate another error code here */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If the string actually contained an IP address, we need not do</span></div>
<div class="line"><span class="comment">           anything more */</span></div>
<div class="line">        <span class="keywordflow">if</span> (i &gt; 0) <span class="keywordflow">return</span>(1);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* do a gethostbyname */</span></div>
<div class="line">        <a class="code" href="crypto_8h.html#ab3735c6a4dd562addce8043981d0ecdf">CRYPTO_w_lock</a>(<a class="code" href="crypto_8h.html#a485c8893a086095e5e7e615782262fa5">CRYPTO_LOCK_GETHOSTBYNAME</a>);</div>
<div class="line">        locked = 1;</div>
<div class="line">        he=<a class="code" href="b__sock_8c.html#a7c6afb9ffbb3ea16ca393446e201ddfc">BIO_gethostbyname</a>(str);</div>
<div class="line">        <span class="keywordflow">if</span> (he == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a136193d082857189e5320b8824cf0496">BIO_F_BIO_GET_HOST_IP</a>,<a class="code" href="bio_8h.html#a4674f63b6d3cc106c6aa27318f5a353b">BIO_R_BAD_HOSTNAME_LOOKUP</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* cast to short because of win16 winsock definition */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((<span class="keywordtype">short</span>)he-&gt;h_addrtype != AF_INET)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a136193d082857189e5320b8824cf0496">BIO_F_BIO_GET_HOST_IP</a>,<a class="code" href="bio_8h.html#ae36dbe902c324c01b3c0297f71d7e7e0">BIO_R_GETHOSTBYNAME_ADDR_IS_NOT_AF_INET</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">for</span> (i=0; i&lt;4; i++)</div>
<div class="line">                ip[i]=he-&gt;h_addr_list[0][i];</div>
<div class="line">        err = 0;</div>
<div class="line"></div>
<div class="line"> err:</div>
<div class="line">        if (locked)</div>
<div class="line">                <a class="code" href="crypto_8h.html#a337cca587e1ea6c81accc78f0373569d">CRYPTO_w_unlock</a>(<a class="code" href="crypto_8h.html#a485c8893a086095e5e7e615782262fa5">CRYPTO_LOCK_GETHOSTBYNAME</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (err)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(2,<span class="stringliteral">&quot;host=&quot;</span>,str);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9601f713826f683d851233f648b91327"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_get_port </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short *&#160;</td>
          <td class="paramname"><em>port_ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00175">175</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <span class="keyword">struct </span>servent *s;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (str == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#a997c6417e674d1a9eb18a72979013953">BIO_F_BIO_GET_PORT</a>,<a class="code" href="bio_8h.html#a95b38dba00730eaaf05e6a20a7d96440">BIO_R_NO_PORT_DEFINED</a>);</div>
<div class="line">                <span class="keywordflow">return</span>(0);</div>
<div class="line">                }</div>
<div class="line">        i=atoi(str);</div>
<div class="line">        <span class="keywordflow">if</span> (i != 0)</div>
<div class="line">                *port_ptr=(<span class="keywordtype">unsigned</span> short)i;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#ab3735c6a4dd562addce8043981d0ecdf">CRYPTO_w_lock</a>(<a class="code" href="crypto_8h.html#a088e7619b09051943015a1ae265fa75e">CRYPTO_LOCK_GETSERVBYNAME</a>);</div>
<div class="line">                <span class="comment">/* Note: under VMS with SOCKETSHR, it seems like the first</span></div>
<div class="line"><span class="comment">                 * parameter is &#39;char *&#39;, instead of &#39;const char *&#39;</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line"><span class="preprocessor">#ifndef CONST_STRICT</span></div>
<div class="line"><span class="preprocessor"></span>                s=getservbyname((<span class="keywordtype">char</span> *)str,<span class="stringliteral">&quot;tcp&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                s=getservbyname(str,<span class="stringliteral">&quot;tcp&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">if</span>(s != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        *port_ptr=ntohs((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)s-&gt;s_port);</div>
<div class="line">                <a class="code" href="crypto_8h.html#a337cca587e1ea6c81accc78f0373569d">CRYPTO_w_unlock</a>(<a class="code" href="crypto_8h.html#a088e7619b09051943015a1ae265fa75e">CRYPTO_LOCK_GETSERVBYNAME</a>);</div>
<div class="line">                <span class="keywordflow">if</span>(s == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;http&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=80;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;telnet&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=23;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;socks&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=1080;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;https&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=443;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;ssl&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=443;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;ftp&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=21;</div>
<div class="line">                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;gopher&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=70;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(str,<span class="stringliteral">&quot;wais&quot;</span>) == 0)</div>
<div class="line">                                *port_ptr=21;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">else</span></div>
<div class="line">                                {</div>
<div class="line">                                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a1210031d66d4214f1497d987cdb2f4d4">SYS_F_GETSERVBYNAME</a>,get_last_socket_error());</div>
<div class="line">                                <a class="code" href="err_8c.html#a89d6b806fcd20c4ea07229451d489616">ERR_add_error_data</a>(3,<span class="stringliteral">&quot;service=&#39;&quot;</span>,str,<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">return</span>(0);</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span>(1);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c6afb9ffbb3ea16ca393446e201ddfc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct hostent* BIO_gethostbyname </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00376">376</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* Caching gethostbyname() results forever is wrong,</span></div>
<div class="line"><span class="comment">         * so we have to let the true gethostbyname() worry about this */</span></div>
<div class="line"><span class="preprocessor">#if (defined(NETWARE_BSDSOCK) &amp;&amp; !defined(__NOVELL_LIBC__))</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span> gethostbyname((<span class="keywordtype">char</span>*)name);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span> gethostbyname(name);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keyword">struct </span>hostent *ret;</div>
<div class="line">        <span class="keywordtype">int</span> i,lowi=0,j;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> low= (<span class="keywordtype">unsigned</span> long)-1;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#  if 0</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* It doesn&#39;t make sense to use locking here: The function interface</span></div>
<div class="line"><span class="comment">         * is not thread-safe, because threads can never be sure when</span></div>
<div class="line"><span class="comment">         * some other thread destroys the data they were given a pointer to.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <a class="code" href="crypto_8h.html#ab3735c6a4dd562addce8043981d0ecdf">CRYPTO_w_lock</a>(<a class="code" href="crypto_8h.html#a485c8893a086095e5e7e615782262fa5">CRYPTO_LOCK_GETHOSTBYNAME</a>);</div>
<div class="line"><span class="preprocessor">#  endif</span></div>
<div class="line"><span class="preprocessor"></span>        j=strlen(name);</div>
<div class="line">        <span class="keywordflow">if</span> (j &lt; 128)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (i=0; i&lt;GHBN_NUM; i++)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (low &gt; ghbn_cache[i].order)</div>
<div class="line">                                {</div>
<div class="line">                                low=ghbn_cache[i].order;</div>
<div class="line">                                lowi=i;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">if</span> (ghbn_cache[i].order &gt; 0)</div>
<div class="line">                                {</div>
<div class="line">                                <span class="keywordflow">if</span> (strncmp(name,ghbn_cache[i].name,128) == 0)</div>
<div class="line">                                        <span class="keywordflow">break</span>;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                i=GHBN_NUM;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (i == GHBN_NUM) <span class="comment">/* no hit*/</span></div>
<div class="line">                {</div>
<div class="line">                BIO_ghbn_miss++;</div>
<div class="line">                <span class="comment">/* Note: under VMS with SOCKETSHR, it seems like the first</span></div>
<div class="line"><span class="comment">                 * parameter is &#39;char *&#39;, instead of &#39;const char *&#39;</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line"><span class="preprocessor">#  ifndef CONST_STRICT</span></div>
<div class="line"><span class="preprocessor"></span>                ret=gethostbyname((<span class="keywordtype">char</span> *)name);</div>
<div class="line"><span class="preprocessor">#  else</span></div>
<div class="line"><span class="preprocessor"></span>                ret=gethostbyname(name);</div>
<div class="line"><span class="preprocessor">#  endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">                <span class="keywordflow">if</span> (ret == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        <span class="keywordflow">goto</span> end;</div>
<div class="line">                <span class="keywordflow">if</span> (j &gt; 128) <span class="comment">/* too big to cache */</span></div>
<div class="line">                        {</div>
<div class="line"><span class="preprocessor">#  if 0</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="comment">/* If we were trying to make this function thread-safe (which</span></div>
<div class="line"><span class="comment">                         * is bound to fail), we&#39;d have to give up in this case</span></div>
<div class="line"><span class="comment">                         * (or allocate more memory). */</span></div>
<div class="line">                        ret = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"><span class="preprocessor">#  endif</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">goto</span> end;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* else add to cache */</span></div>
<div class="line">                <span class="keywordflow">if</span> (ghbn_cache[lowi].ent != <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        ghbn_free(ghbn_cache[lowi].ent); <span class="comment">/* XXX not thread-safe */</span></div>
<div class="line">                ghbn_cache[lowi].name[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>((ret=ghbn_cache[lowi].ent=ghbn_dup(ret)) == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#ab4dd91afa9ddbc8ebc71fb1de0b6bd68">BIO_F_BIO_GETHOSTBYNAME</a>,<a class="code" href="err_8h.html#ae17d140bd9b2b4d297015e6a260d63c2">ERR_R_MALLOC_FAILURE</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> end;</div>
<div class="line">                        }</div>
<div class="line">                strncpy(ghbn_cache[lowi].name,name,128);</div>
<div class="line">                ghbn_cache[lowi].order=BIO_ghbn_miss+BIO_ghbn_hits;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                BIO_ghbn_hits++;</div>
<div class="line">                ret= ghbn_cache[i].ent;</div>
<div class="line">                ghbn_cache[i].order=BIO_ghbn_miss+BIO_ghbn_hits;</div>
<div class="line">                }</div>
<div class="line">end:</div>
<div class="line"><span class="preprocessor">#  if 0</span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="crypto_8h.html#a337cca587e1ea6c81accc78f0373569d">CRYPTO_w_unlock</a>(<a class="code" href="crypto_8h.html#a485c8893a086095e5e7e615782262fa5">CRYPTO_LOCK_GETHOSTBYNAME</a>);</div>
<div class="line"><span class="preprocessor">#  endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>(ret);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a767d2f524ed140b4fffc1c16344ce58e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_set_tcp_ndelay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>on</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00946">946</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret=0;</div>
<div class="line"><span class="preprocessor">#if defined(TCP_NODELAY) &amp;&amp; (defined(IPPROTO_TCP) || defined(SOL_TCP))</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordtype">int</span> opt;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef SOL_TCP</span></div>
<div class="line"><span class="preprocessor"></span>        opt=SOL_TCP;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifdef IPPROTO_TCP</span></div>
<div class="line"><span class="preprocessor"></span>        opt=IPPROTO_TCP;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        </div>
<div class="line">        ret=setsockopt(s,opt,TCP_NODELAY,(<span class="keywordtype">char</span> *)&amp;on,<span class="keyword">sizeof</span>(on));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>(ret == 0);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6228766432b0ae96ee00746229323bdf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BIO_sock_cleanup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00526">526</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line"><span class="preprocessor">#ifdef OPENSSL_SYS_WINDOWS</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (wsa_init_done)</div>
<div class="line">                {</div>
<div class="line">                wsa_init_done=0;</div>
<div class="line"><span class="preprocessor">#if 0           </span><span class="comment">/* this call is claimed to be non-present in Winsock2 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>                WSACancelBlockingCall();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                WSACleanup();</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#elif defined(OPENSSL_SYS_NETWARE) &amp;&amp; !defined(NETWARE_BSDSOCK)</span></div>
<div class="line"><span class="preprocessor"></span>   <span class="keywordflow">if</span> (wsa_init_done)</div>
<div class="line">        {</div>
<div class="line">        wsa_init_done=0;</div>
<div class="line">        WSACleanup();</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3046dd8f230fdd7a3d1874325454de40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_sock_error </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00233">233</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> j,i;</div>
<div class="line">        <span class="keyword">union </span>{ <span class="keywordtype">size_t</span> s; <span class="keywordtype">int</span> i; } size;</div>
<div class="line">                 </div>
<div class="line"><span class="preprocessor">#if defined(OPENSSL_SYS_BEOS_R5)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span> </div>
<div class="line">        <span class="comment">/* heuristic way to adapt for platforms that expect 64-bit optlen */</span></div>
<div class="line">        size.s=0, size.i=<span class="keyword">sizeof</span>(j);</div>
<div class="line">        <span class="comment">/* Note: under Windows the third parameter is of type (char *)</span></div>
<div class="line"><span class="comment">         * whereas under other systems it is (void *) if you don&#39;t have</span></div>
<div class="line"><span class="comment">         * a cast it will choke the compiler: if you do have a cast then</span></div>
<div class="line"><span class="comment">         * you can either go for (char *) or (void *).</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        i=getsockopt(sock,SOL_SOCKET,SO_ERROR,(<span class="keywordtype">void</span> *)&amp;j,(<span class="keywordtype">void</span> *)&amp;size);</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>(1);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span>(j);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a20faadb1e189edc057ed0118a6ab355b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_sock_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00472">472</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line"><span class="preprocessor">#ifdef OPENSSL_SYS_WINDOWS</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keyword">struct </span>WSAData wsa_state;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!wsa_init_done)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">int</span> err;</div>
<div class="line">          </div>
<div class="line">                wsa_init_done=1;</div>
<div class="line">                memset(&amp;wsa_state,0,<span class="keyword">sizeof</span>(wsa_state));</div>
<div class="line">                <span class="comment">/* Not making wsa_state available to the rest of the</span></div>
<div class="line"><span class="comment">                 * code is formally wrong. But the structures we use</span></div>
<div class="line"><span class="comment">                 * are [beleived to be] invariable among Winsock DLLs,</span></div>
<div class="line"><span class="comment">                 * while API availability is [expected to be] probed</span></div>
<div class="line"><span class="comment">                 * at run-time with DSO_global_lookup. */</span></div>
<div class="line">                <span class="keywordflow">if</span> (WSAStartup(0x0202,&amp;wsa_state)!=0)</div>
<div class="line">                        {</div>
<div class="line">                        err=WSAGetLastError();</div>
<div class="line">                        <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a07275c7924e8251c500a4ddba9afa270">SYS_F_WSASTARTUP</a>,err);</div>
<div class="line">                        <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#aee6a795502a4211d766ff31ddb2a8425">BIO_F_BIO_SOCK_INIT</a>,<a class="code" href="bio_8h.html#a794bce5e095ea9e49e30f9a613080cc9">BIO_R_WSASTARTUP</a>);</div>
<div class="line">                        <span class="keywordflow">return</span>(-1);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* OPENSSL_SYS_WINDOWS */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifdef WATT32</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keyword">extern</span> <span class="keywordtype">int</span> _watt_do_exit;</div>
<div class="line">        _watt_do_exit = 0;    <span class="comment">/* don&#39;t make sock_init() call exit() */</span></div>
<div class="line">        <span class="keywordflow">if</span> (sock_init())</div>
<div class="line">                <span class="keywordflow">return</span> (-1);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#if defined(OPENSSL_SYS_NETWARE) &amp;&amp; !defined(NETWARE_BSDSOCK)</span></div>
<div class="line"><span class="preprocessor"></span>    WORD wVerReq;</div>
<div class="line">    WSADATA wsaData;</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!wsa_init_done)</div>
<div class="line">    {</div>
<div class="line">        wsa_init_done=1;</div>
<div class="line">        wVerReq = MAKEWORD( 2, 0 );</div>
<div class="line">        err = WSAStartup(wVerReq,&amp;wsaData);</div>
<div class="line">        <span class="keywordflow">if</span> (err != 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a07275c7924e8251c500a4ddba9afa270">SYS_F_WSASTARTUP</a>,err);</div>
<div class="line">            <a class="code" href="err_8h.html#ab969073e2d5f75e189d9b3441f7a75a9">BIOerr</a>(<a class="code" href="bio_8h.html#aee6a795502a4211d766ff31ddb2a8425">BIO_F_BIO_SOCK_INIT</a>,<a class="code" href="bio_8h.html#a794bce5e095ea9e49e30f9a613080cc9">BIO_R_WSASTARTUP</a>);</div>
<div class="line">            <span class="keywordflow">return</span>(-1);</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">return</span>(1);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8166ad9704ff85f1c9b22dd2d3e87352"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_socket_ioctl </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00548">548</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef __DJGPP__</span></div>
<div class="line"><span class="preprocessor"></span>        i=ioctlsocket(fd,<a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>,(<span class="keywordtype">char</span> *)<a class="code" href="e__aes_8c.html#a1e84538c461c4c72654eb01a281dfd68">arg</a>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># if defined(OPENSSL_SYS_VMS)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* 2011-02-18 SMS.</span></div>
<div class="line"><span class="comment">         * VMS ioctl() can&#39;t tolerate a 64-bit &quot;void *arg&quot;, but we</span></div>
<div class="line"><span class="comment">         * observe that all the consumers pass in an &quot;unsigned long *&quot;,</span></div>
<div class="line"><span class="comment">         * so we arrange a local copy with a short pointer, and use</span></div>
<div class="line"><span class="comment">         * that, instead.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"><span class="preprocessor">#  if __INITIAL_POINTER_SIZE == 64</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   define ARG arg_32p</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   pragma pointer_size save</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   pragma pointer_size 32</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg_32;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *arg_32p;</div>
<div class="line"><span class="preprocessor">#   pragma pointer_size restore</span></div>
<div class="line"><span class="preprocessor"></span>        arg_32p = &amp;arg_32;</div>
<div class="line">        arg_32 = *((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *) <a class="code" href="e__aes_8c.html#a1e84538c461c4c72654eb01a281dfd68">arg</a>);</div>
<div class="line"><span class="preprocessor">#  else </span><span class="comment">/* __INITIAL_POINTER_SIZE == 64 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   define ARG arg</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  endif </span><span class="comment">/* __INITIAL_POINTER_SIZE == 64 [else] */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># else </span><span class="comment">/* defined(OPENSSL_SYS_VMS) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  define ARG arg</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># endif </span><span class="comment">/* defined(OPENSSL_SYS_VMS) [else] */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        i=ioctlsocket(fd,<a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>,ARG);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* __DJGPP__ */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (i &lt; 0)</div>
<div class="line">                <a class="code" href="err_8h.html#af7a25444607e04d2b1e501efd8042d02">SYSerr</a>(<a class="code" href="err_8h.html#a8deafd2178ba9e3b8c4db0752a0db1f2">SYS_F_IOCTLSOCKET</a>,get_last_socket_error());</div>
<div class="line">        <span class="keywordflow">return</span>(i);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a220a26749987ae25ec3fcbd33ce53dad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BIO_socket_nbio </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="b__sock_8c_source.html#l00965">965</a> of file <a class="el" href="b__sock_8c_source.html">b_sock.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ret= -1;</div>
<div class="line">        <span class="keywordtype">int</span> l;</div>
<div class="line"></div>
<div class="line">        l=mode;</div>
<div class="line"><span class="preprocessor">#ifdef FIONBIO</span></div>
<div class="line"><span class="preprocessor"></span>        ret=<a class="code" href="b__sock_8c.html#a8166ad9704ff85f1c9b22dd2d3e87352">BIO_socket_ioctl</a>(s,FIONBIO,&amp;l);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>(ret == 0);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 15 2014 18:16:50 for openssl by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
