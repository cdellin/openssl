<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/cms/cms_sd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_7882632c4dffce91474d1f2c5c940725.html">cms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cms_sd.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="cryptlib_8h_source.html">cryptlib.h</a>&quot;</code><br/>
<code>#include &lt;openssl/asn1t.h&gt;</code><br/>
<code>#include &lt;openssl/pem.h&gt;</code><br/>
<code>#include &lt;openssl/x509.h&gt;</code><br/>
<code>#include &lt;openssl/x509v3.h&gt;</code><br/>
<code>#include &lt;openssl/err.h&gt;</code><br/>
<code>#include &lt;openssl/cms.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cms__lcl_8h_source.html">cms_lcl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="asn1__locl_8h_source.html">asn1_locl.h</a>&quot;</code><br/>
</div>
<p><a href="cms__sd_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1644c2838a48d575d251f2b658ae4034"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a1644c2838a48d575d251f2b658ae4034">CMS_SignedData_init</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms)</td></tr>
<tr class="memitem:ae2f46d9be341636d0e22d58d86fb7c1e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#ae2f46d9be341636d0e22d58d86fb7c1e">cms_set1_SignerIdentifier</a> (<a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *sid, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *cert, int <a class="el" href="x509_8h.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>)</td></tr>
<tr class="memitem:a73e3ae14ece4aba2d5bcc38796b23907"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a73e3ae14ece4aba2d5bcc38796b23907">cms_SignerIdentifier_get0_signer_id</a> (<a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *sid, <a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **keyid, <a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **issuer, <a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **sno)</td></tr>
<tr class="memitem:ae15c777be21e1c02be97ddf5bc27dc54"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#ae15c777be21e1c02be97ddf5bc27dc54">cms_SignerIdentifier_cert_cmp</a> (<a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *sid, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *cert)</td></tr>
<tr class="memitem:a2eb58dd50af8338432ec5b09c11becbc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a2eb58dd50af8338432ec5b09c11becbc">CMS_add1_signer</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *signer, <a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *pk, const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *md, unsigned int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)</td></tr>
<tr class="memitem:af51972010dbe8b59ad7afdc9f0b8fb16"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#aaadbb75633e4460a52864970a3b875de">EVP_PKEY_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#af51972010dbe8b59ad7afdc9f0b8fb16">CMS_SignerInfo_get0_pkey_ctx</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si)</td></tr>
<tr class="memitem:acb3b0881dbad94057600a0f166d44b96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#a69cda4d21bd068f01c469222c1dd92fe">EVP_MD_CTX</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#acb3b0881dbad94057600a0f166d44b96">CMS_SignerInfo_get0_md_ctx</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si)</td></tr>
<tr class="memitem:ab657363c65f3baeae906cfe21eb21d2a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#ab657363c65f3baeae906cfe21eb21d2a">STACK_OF</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a>)</td></tr>
<tr class="memitem:a00cf9f18b18b26449b4cde33c2f1d5ff"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a00cf9f18b18b26449b4cde33c2f1d5ff">STACK_OF</a> (<a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a>)</td></tr>
<tr class="memitem:a6c7423a2fbefe9e3519679784265c973"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a6c7423a2fbefe9e3519679784265c973">CMS_SignerInfo_set1_signer_cert</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *signer)</td></tr>
<tr class="memitem:af9530c8048cf7bece6d09717f7e4e737"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#af9530c8048cf7bece6d09717f7e4e737">CMS_SignerInfo_get0_signer_id</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **keyid, <a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **issuer, <a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **sno)</td></tr>
<tr class="memitem:a844f95e7b7bf9837c05c16989f0dd634"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a844f95e7b7bf9837c05c16989f0dd634">CMS_SignerInfo_cert_cmp</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *cert)</td></tr>
<tr class="memitem:a55ddb6f0b292536b7fb1dd40dbb6a3e0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a55ddb6f0b292536b7fb1dd40dbb6a3e0">CMS_set1_signers_certs</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms, <a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a>)*scerts, unsigned int <a class="el" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>)</td></tr>
<tr class="memitem:a41425496f0226eec3323fb81c66172f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a41425496f0226eec3323fb81c66172f5">CMS_SignerInfo_get0_algs</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> **pk, <a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> **signer, <a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **pdig, <a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **psig)</td></tr>
<tr class="memitem:a02ea025a7f70db116cdd2aefc4d3c355"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a02ea025a7f70db116cdd2aefc4d3c355">CMS_SignerInfo_get0_signature</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si)</td></tr>
<tr class="memitem:aeaa6987a61ee75542fde7e9d4b5dbe56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#aeaa6987a61ee75542fde7e9d4b5dbe56">cms_SignedData_final</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *chain)</td></tr>
<tr class="memitem:a426439b64ded9f572e4afd97bdfb4015"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a426439b64ded9f572e4afd97bdfb4015">CMS_SignerInfo_sign</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si)</td></tr>
<tr class="memitem:a37e31a3a3362596f3e950cefddb10678"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a37e31a3a3362596f3e950cefddb10678">CMS_SignerInfo_verify</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si)</td></tr>
<tr class="memitem:a0ab3d20e8cc3de71f04703dfa7c62017"><td class="memItemLeft" align="right" valign="top"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a0ab3d20e8cc3de71f04703dfa7c62017">cms_SignedData_init_bio</a> (<a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *cms)</td></tr>
<tr class="memitem:a3892cb7d22ea2d5bcb409c1404409857"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a3892cb7d22ea2d5bcb409c1404409857">CMS_SignerInfo_verify_content</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *chain)</td></tr>
<tr class="memitem:a90229c07fd143aba2279b472319f7bf8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a90229c07fd143aba2279b472319f7bf8">CMS_add_smimecap</a> (<a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *si, <a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)*algs)</td></tr>
<tr class="memitem:a8dbdee035fa4fe59e9de524f28f941ed"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#a8dbdee035fa4fe59e9de524f28f941ed">CMS_add_simple_smimecap</a> (<a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)**algs, int algnid, int keysize)</td></tr>
<tr class="memitem:aafde25928ef5918da9c63d3e74236a58"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cms__sd_8c.html#aafde25928ef5918da9c63d3e74236a58">CMS_add_standard_smimecap</a> (<a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)**smcap)</td></tr>
</table>
<h2>Function Documentation</h2>
<a class="anchor" id="a2eb58dd50af8338432ec5b09c11becbc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a>* CMS_add1_signer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>signer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> *&#160;</td>
          <td class="paramname"><em>pk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ossl__typ_8h.html#aac66cf010326fa9a927c2a34888f45d3">EVP_MD</a> *&#160;</td>
          <td class="paramname"><em>md</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00287">287</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__SignedData__st.html">CMS_SignedData</a> *sd;</div>
<div class="line">        <a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a> *si = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structX509__algor__st.html">X509_ALGOR</a> *alg;</div>
<div class="line">        <span class="keywordtype">int</span> i, <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>;</div>
<div class="line">        <span class="keywordflow">if</span>(!<a class="code" href="x509_8h.html#aa2b4d3747ff3ce6998e1e1423f2c6051">X509_check_private_key</a>(signer, pk))</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a33310fdd60839acfda68c53c7cf41209">CMS_F_CMS_ADD1_SIGNER</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a4f3e4ec51eccf1e1fa8c225f4165e35b">CMS_R_PRIVATE_KEY_DOES_NOT_MATCH_CERTIFICATE</a>);</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">        sd = cms_signed_data_init(cms);</div>
<div class="line">        <span class="keywordflow">if</span> (!sd)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        si = <a class="code" href="asn1_8h.html#ae2f9bfe2b1e8a6b13251fb01ca2dc25c">M_ASN1_new_of</a>(<a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (!si)</div>
<div class="line">                <span class="keywordflow">goto</span> merr;</div>
<div class="line">        <a class="code" href="v3__purp_8c.html#ad14cac500b50cb3b5b1392af85d35e0d">X509_check_purpose</a>(signer, -1, -1);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="crypto_8h.html#ab8556c4f12443f1876ce487dd0c8db27">CRYPTO_add</a>(&amp;pk-&gt;<a class="code" href="structevp__pkey__st.html#a89b11b788ffad7d747d1c7eed4cf279f">references</a>, 1, <a class="code" href="crypto_8h.html#aee0129d89ab09d6bccecd1ce55307584">CRYPTO_LOCK_EVP_PKEY</a>);</div>
<div class="line">        <a class="code" href="crypto_8h.html#ab8556c4f12443f1876ce487dd0c8db27">CRYPTO_add</a>(&amp;signer-&gt;<a class="code" href="structx509__st.html#ab1114b325664bca1cdfd6854f247a4d5">references</a>, 1, <a class="code" href="crypto_8h.html#abcd6591ef6acea51bf9f6edb6bb05bca">CRYPTO_LOCK_X509</a>);</div>
<div class="line"></div>
<div class="line">        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a> = pk;</div>
<div class="line">        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a> = signer;</div>
<div class="line">        <a class="code" href="digest_8c.html#afe58145aa88a8ee187d858c762c00399">EVP_MD_CTX_init</a>(&amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa3b8138df00f7ba614925bb5f831ce4a">mctx</a>);</div>
<div class="line">        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a> = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#ae4670dfe3e27c5494ea55bc9f7a70296">CMS_USE_KEYID</a>)</div>
<div class="line">                {</div>
<div class="line">                si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ad243577fd14766c90b12254ec3648d39">version</a> = 3;</div>
<div class="line">                <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="structCMS__SignedData__st.html#a46be0df1ce89115c84a063894b0b94b1">version</a> &lt; 3)</div>
<div class="line">                        sd-&gt;<a class="code" href="structCMS__SignedData__st.html#a46be0df1ce89115c84a063894b0b94b1">version</a> = 3;</div>
<div class="line">                type = <a class="code" href="cms_8h.html#ad42a4799f8919e59919223af98623ca0">CMS_SIGNERINFO_KEYIDENTIFIER</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                type = <a class="code" href="cms_8h.html#aa90a5540395664981482a8f6aa9e5e33">CMS_SIGNERINFO_ISSUER_SERIAL</a>;</div>
<div class="line">                si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ad243577fd14766c90b12254ec3648d39">version</a> = 1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#ae2f46d9be341636d0e22d58d86fb7c1e">cms_set1_SignerIdentifier</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a5c2475b3f78c9362b3b0bbb8e56cbdf4">sid</a>, signer, type))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (md == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordtype">int</span> def_nid;</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#ab97462edded31d985db968904ce5488c">EVP_PKEY_get_default_digest_nid</a>(pk, &amp;def_nid) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                md = <a class="code" href="evp_8h.html#af21731974d1c9b9467b3bf209d378e36">EVP_get_digestbynid</a>(def_nid);</div>
<div class="line">                <span class="keywordflow">if</span> (md == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a33310fdd60839acfda68c53c7cf41209">CMS_F_CMS_ADD1_SIGNER</a>, <a class="code" href="cms_8h.html#abaa0a56b68d2bed5aa3456bcf05b6b73">CMS_R_NO_DEFAULT_DIGEST</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!md)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a33310fdd60839acfda68c53c7cf41209">CMS_F_CMS_ADD1_SIGNER</a>, <a class="code" href="cms_8h.html#a51319470b072ceafad8d6f8bbf32ff81">CMS_R_NO_DIGEST_SET</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="x509_8h.html#ab44f4d3bad3d1c20afa59b4c38772cf3">X509_ALGOR_set_md</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a97656c5d82a9704229706ac22a328615">digestAlgorithm</a>, md);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* See if digest is present in digestAlgorithms */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#a94c75bbf81b8ad2a5ae09b10c8e47719">sk_X509_ALGOR_num</a>(sd-&gt;digestAlgorithms); i++)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="structasn1__object__st.html">ASN1_OBJECT</a> *aoid;</div>
<div class="line">                alg = <a class="code" href="safestack_8h.html#a6f0738d8fab06b164ea825826b366fd0">sk_X509_ALGOR_value</a>(sd-&gt;digestAlgorithms, i);</div>
<div class="line">                <a class="code" href="x509_8h.html#acfea022df77108974470fa98aa88d9b9">X509_ALGOR_get0</a>(&amp;aoid, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, alg);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="obj__dat_8c.html#a8b51f927a6f1ee63665c43ef6fc98552">OBJ_obj2nid</a>(aoid) == <a class="code" href="evp_8h.html#aff41d734c0cba5932bf15eba86eadf8f">EVP_MD_type</a>(md))</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (i == <a class="code" href="safestack_8h.html#a94c75bbf81b8ad2a5ae09b10c8e47719">sk_X509_ALGOR_num</a>(sd-&gt;digestAlgorithms))</div>
<div class="line">                {</div>
<div class="line">                alg = X509_ALGOR_new();</div>
<div class="line">                <span class="keywordflow">if</span> (!alg)</div>
<div class="line">                        <span class="keywordflow">goto</span> merr;</div>
<div class="line">                <a class="code" href="x509_8h.html#ab44f4d3bad3d1c20afa59b4c38772cf3">X509_ALGOR_set_md</a>(alg, md);</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="safestack_8h.html#affb785b9b1d003ce8d76019bd5ecd46d">sk_X509_ALGOR_push</a>(sd-&gt;digestAlgorithms, alg))</div>
<div class="line">                        {</div>
<div class="line">                        X509_ALGOR_free(alg);</div>
<div class="line">                        <span class="keywordflow">goto</span> merr;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#afcd7a48a3b9f4a217ad110d7b4adc5ba">CMS_KEY_PARAM</a>) &amp;&amp; !cms_sd_asn1_ctrl(si, 0))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (!(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#a55173b8e2b621059aec758e57360c043">CMS_NOATTR</a>))</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* Initialialize signed attributes strutucture so other</span></div>
<div class="line"><span class="comment">                 * attributes such as signing time etc are added later</span></div>
<div class="line"><span class="comment">                 * even if we add none here.</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!si-&gt;signedAttrs)</div>
<div class="line">                        {</div>
<div class="line">                        si-&gt;signedAttrs = <a class="code" href="safestack_8h.html#a19fe352db05d7fb6ef53031d73644609">sk_X509_ATTRIBUTE_new_null</a>();</div>
<div class="line">                        <span class="keywordflow">if</span> (!si-&gt;signedAttrs)</div>
<div class="line">                                <span class="keywordflow">goto</span> merr;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (!(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#ac1f8028ac155516a5750f6c35a294f24">CMS_NOSMIMECAP</a>))</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structX509__algor__st.html">X509_ALGOR</a>) *smcap = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                        i = <a class="code" href="cms_8h.html#aafde25928ef5918da9c63d3e74236a58">CMS_add_standard_smimecap</a>(&amp;smcap);</div>
<div class="line">                        <span class="keywordflow">if</span> (i)</div>
<div class="line">                                i = <a class="code" href="cms_8h.html#a90229c07fd143aba2279b472319f7bf8">CMS_add_smimecap</a>(si, smcap);</div>
<div class="line">                        <a class="code" href="safestack_8h.html#a36bd4e666109f68887de0ce1b8aaff5a">sk_X509_ALGOR_pop_free</a>(smcap, X509_ALGOR_free);</div>
<div class="line">                        <span class="keywordflow">if</span> (!i)</div>
<div class="line">                                <span class="keywordflow">goto</span> merr;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#a925a18a0aeb4d0f8cdec3b24ffa9774b">CMS_REUSE_DIGEST</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!cms_copy_messageDigest(cms, si))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (!(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; (<a class="code" href="cms_8h.html#a20b64bc8c182f7ac666da5bcb0190c07">CMS_PARTIAL</a>|CMS_KEY_PARAM)) &amp;&amp;</div>
<div class="line">                                        !<a class="code" href="cms_8h.html#a426439b64ded9f572e4afd97bdfb4015">CMS_SignerInfo_sign</a>(si))</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!(<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#aebd9b8ff6570442e29aa864e3b91d645">CMS_NOCERTS</a>))</div>
<div class="line">                {</div>
<div class="line">                <span class="comment">/* NB ignore -1 return for duplicate cert */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="cms_8h.html#a9ba4ef68ee60c507f65b0a18e38de4fe">CMS_add1_cert</a>(cms, signer))</div>
<div class="line">                        <span class="keywordflow">goto</span> merr;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; CMS_KEY_PARAM)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; CMS_NOATTR)</div>
<div class="line">                        {</div>
<div class="line">                        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a> = <a class="code" href="evp_8h.html#a23d1c787f99b2aaa6d8283c2db325eea">EVP_PKEY_CTX_new</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line">                        <span class="keywordflow">if</span> (!si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a423a99ea5dbdd496bbf6fe31ca3b275e">EVP_PKEY_sign_init</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>) &lt;= 0)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a743ec645aadfb7f5ff5cbfc134c105a9">EVP_PKEY_CTX_set_signature_md</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>, md) &lt;= 0)</div>
<div class="line">                                <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a6e42bb779758e541a2987e52223e7e50">EVP_DigestSignInit</a>(&amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa3b8138df00f7ba614925bb5f831ce4a">mctx</a>, &amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>, md, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, pk) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!sd-&gt;signerInfos)</div>
<div class="line">                sd-&gt;signerInfos = <a class="code" href="safestack_8h.html#a80c53a144056a5ab2d14abfaa537099b">sk_CMS_SignerInfo_new_null</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!sd-&gt;signerInfos ||</div>
<div class="line">                !<a class="code" href="safestack_8h.html#a758754120cfb1cc07767043ae902bdc9">sk_CMS_SignerInfo_push</a>(sd-&gt;signerInfos, si))</div>
<div class="line">                <span class="keywordflow">goto</span> merr;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> si;</div>
<div class="line"></div>
<div class="line">        merr:</div>
<div class="line">        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a33310fdd60839acfda68c53c7cf41209">CMS_F_CMS_ADD1_SIGNER</a>, <a class="code" href="err_8h.html#ae17d140bd9b2b4d297015e6a260d63c2">ERR_R_MALLOC_FAILURE</a>);</div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (si)</div>
<div class="line">                <a class="code" href="asn1_8h.html#a64344e58b69188c21fd5ec2abe3a4a38">M_ASN1_free_of</a>(si, <a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8dbdee035fa4fe59e9de524f28f941ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_add_simple_smimecap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)**&#160;</td>
          <td class="paramname"><em>algs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>algnid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>keysize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00976">976</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structX509__algor__st.html">X509_ALGOR</a> *alg;</div>
<div class="line">        <a class="code" href="structasn1__string__st.html">ASN1_INTEGER</a> *<a class="code" href="des_8c.html#a6a4ff80275090619f35902b61a8c6bf6">key</a> = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (keysize &gt; 0)</div>
<div class="line">                {</div>
<div class="line">                key = ASN1_INTEGER_new();</div>
<div class="line">                <span class="keywordflow">if</span> (!key || !<a class="code" href="a__int_8c.html#a5716313a70738f4ab0c80c7d19c5f2d5">ASN1_INTEGER_set</a>(key, keysize))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        alg = X509_ALGOR_new();</div>
<div class="line">        <span class="keywordflow">if</span> (!alg)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (key)</div>
<div class="line">                        ASN1_INTEGER_free(key);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">        <a class="code" href="x509_8h.html#a5c289a6fbc3107fefb5dc6184b5b7cc4">X509_ALGOR_set0</a>(alg, <a class="code" href="obj__dat_8c.html#a42d9bf0fd7cd17fe4101c74c215b37ca">OBJ_nid2obj</a>(algnid),</div>
<div class="line">                                key ? <a class="code" href="asn1_8h.html#a0fc996672dd3dd88bfcd087456a6796b">V_ASN1_INTEGER</a> : <a class="code" href="asn1_8h.html#ae9ce601db9cb8ba6fa09b69d399d7475">V_ASN1_UNDEF</a>, key);</div>
<div class="line">        <span class="keywordflow">if</span> (!*algs)</div>
<div class="line">                *algs = <a class="code" href="safestack_8h.html#a842fb6bbef61a34c4082669e43dd4080">sk_X509_ALGOR_new_null</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (!*algs || !<a class="code" href="safestack_8h.html#affb785b9b1d003ce8d76019bd5ecd46d">sk_X509_ALGOR_push</a>(*algs, alg))</div>
<div class="line">                {</div>
<div class="line">                X509_ALGOR_free(alg);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a90229c07fd143aba2279b472319f7bf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_add_smimecap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)*&#160;</td>
          <td class="paramname"><em>algs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00963">963</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *smder = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> smderlen, r;</div>
<div class="line">        smderlen = i2d_X509_ALGORS(algs, &amp;smder);</div>
<div class="line">        <span class="keywordflow">if</span> (smderlen &lt;= 0)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        r = <a class="code" href="cms_8h.html#ac54e63b2827670c7b82c449f536ae59d">CMS_signed_add1_attr_by_NID</a>(si, <a class="code" href="obj__mac_8h.html#ad60ad571a28cfcbb886f20b64dd633b3">NID_SMIMECapabilities</a>,</div>
<div class="line">                                        <a class="code" href="asn1_8h.html#ab76fef5a089d894b827029a84a6f4f7a">V_ASN1_SEQUENCE</a>, smder, smderlen);</div>
<div class="line">        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(smder);</div>
<div class="line">        <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aafde25928ef5918da9c63d3e74236a58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_add_standard_smimecap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a>)**&#160;</td>
          <td class="paramname"><em>smcap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l01023">1023</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (!cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#a720aea1da22b9537f4a540d3721e0d85">NID_aes_256_cbc</a>, -1)</div>
<div class="line">                || !cms_add_digest_smcap(smcap, <a class="code" href="obj__mac_8h.html#a2b8776188557eae155d3fa6a91452390">NID_id_GostR3411_94</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#acbf14fbfaa2119f12d3ff9e2f1931172">NID_id_Gost28147_89</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#a79a7937ec024133a05e76d7644dd8127">NID_aes_192_cbc</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#a8ebaffe01b7df98d5da9d0e43edc80ac">NID_aes_128_cbc</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#a8a1e8ea0dceb665cd7a19b2fb1a99ad2">NID_des_ede3_cbc</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#abd186c6b6e3a641e4f1da0cf38d4bdac">NID_rc2_cbc</a>, 128)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#abd186c6b6e3a641e4f1da0cf38d4bdac">NID_rc2_cbc</a>, 64)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#ac6062b978d3b452f0dba5bdf37efd56f">NID_des_cbc</a>, -1)</div>
<div class="line">                || !cms_add_cipher_smcap(smcap, <a class="code" href="obj__mac_8h.html#abd186c6b6e3a641e4f1da0cf38d4bdac">NID_rc2_cbc</a>, 40))</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2f46d9be341636d0e22d58d86fb7c1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_set1_SignerIdentifier </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *&#160;</td>
          <td class="paramname"><em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00211">211</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">switch</span>(<a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="cms_8h.html#aa90a5540395664981482a8f6aa9e5e33">CMS_SIGNERINFO_ISSUER_SERIAL</a>:</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#af1abd64a7d3f7b9e06fcd1111652ea00">cms_set1_ias</a>(&amp;sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a0e446b4a9385e947da9678125042ba15">issuerAndSerialNumber</a>, cert))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="cms_8h.html#ad42a4799f8919e59919223af98623ca0">CMS_SIGNERINFO_KEYIDENTIFIER</a>:</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#aedcc935c2d546a5704b460ccf277e053">cms_set1_keyid</a>(&amp;sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a5b7e3008060b95223bc13cd335c40f34">subjectKeyIdentifier</a>, cert))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#aca9ac7d7daad952eb717b68b6018c314">CMS_F_CMS_SET1_SIGNERIDENTIFIER</a>, <a class="code" href="cms_8h.html#ac9bcaaf30c0d054b260b256208cf0bbf">CMS_R_UNKNOWN_ID</a>);</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a8e06fab2a2986e15ae733216cba6a09e">type</a> = <a class="code" href="e__aes_8c.html#ab512b8f495325c7ea0f5a5a5d3f938eb">type</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55ddb6f0b292536b7fb1dd40dbb6a3e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_set1_signers_certs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="x509v3_8h.html#a9c9204f1c9200b4c0ac4cfb65ddf0397">STACK_OF</a>(<a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a>)*&#160;</td>
          <td class="paramname"><em>scerts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00555">555</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__SignedData__st.html">CMS_SignedData</a> *sd;</div>
<div class="line">        <a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a> *si;</div>
<div class="line">        <a class="code" href="structCMS__CertificateChoices.html">CMS_CertificateChoices</a> *cch;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structCMS__CertificateChoices.html">CMS_CertificateChoices</a>) *certs;</div>
<div class="line">        <a class="code" href="structx509__st.html">X509</a> *<a class="code" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>;</div>
<div class="line">        <span class="keywordtype">int</span> i, j;</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        sd = cms_get0_signed(cms);</div>
<div class="line">        <span class="keywordflow">if</span> (!sd)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        certs = sd-&gt;certificates;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#a60f8dafbf2a20918520d0f334fcd8be6">sk_CMS_SignerInfo_num</a>(sd-&gt;signerInfos); i++)</div>
<div class="line">                {</div>
<div class="line">                si = <a class="code" href="safestack_8h.html#a6b01d6da466a0cfe0bf35f47870735ae">sk_CMS_SignerInfo_value</a>(sd-&gt;signerInfos, i);</div>
<div class="line">                <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>)</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="safestack_8h.html#af8495d81a6dda58254c7e12528af0118">sk_X509_num</a>(scerts); j++)</div>
<div class="line">                        {</div>
<div class="line">                        x = <a class="code" href="safestack_8h.html#a6ce8e2d1c31859b9b27cd535caba4388">sk_X509_value</a>(scerts, j);</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="cms_8h.html#a844f95e7b7bf9837c05c16989f0dd634">CMS_SignerInfo_cert_cmp</a>(si, x) == 0)</div>
<div class="line">                                {</div>
<div class="line">                                <a class="code" href="cms_8h.html#a6c7423a2fbefe9e3519679784265c973">CMS_SignerInfo_set1_signer_cert</a>(si, x);</div>
<div class="line">                                ret++;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a> || (<a class="code" href="pkcs7_8h.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="cms_8h.html#a7e17b533e127751bf3bea0370437c365">CMS_NOINTERN</a>))</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="safestack_8h.html#a809f17e57bc4cd94f16649dbd6301fc0">sk_CMS_CertificateChoices_num</a>(certs); j++)</div>
<div class="line">                        {</div>
<div class="line">                        cch = <a class="code" href="safestack_8h.html#a2c8ace5f3a7bb9a157622cf42340c1fa">sk_CMS_CertificateChoices_value</a>(certs, j);</div>
<div class="line">                        <span class="keywordflow">if</span> (cch-&gt;<a class="code" href="structCMS__CertificateChoices.html#af446184e0fdd56690ad06c6c4a0dba5c">type</a> != 0)</div>
<div class="line">                                <span class="keywordflow">continue</span>;</div>
<div class="line">                        x = cch-&gt;<a class="code" href="structCMS__CertificateChoices.html#a9d8fa9df292b45f229970f4a41273cff">d</a>.<a class="code" href="structCMS__CertificateChoices.html#a73bb916b33aef426bc1d27b8261feaeb">certificate</a>;</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="cms_8h.html#a844f95e7b7bf9837c05c16989f0dd634">CMS_SignerInfo_cert_cmp</a>(si, x) == 0)</div>
<div class="line">                                {</div>
<div class="line">                                <a class="code" href="cms_8h.html#a6c7423a2fbefe9e3519679784265c973">CMS_SignerInfo_set1_signer_cert</a>(si, x);</div>
<div class="line">                                ret++;</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeaa6987a61ee75542fde7e9d4b5dbe56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_SignedData_final </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>chain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00717">717</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a>) *sinfos;</div>
<div class="line">        <a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a> *si;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        sinfos = CMS_get0_SignerInfos(cms);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#a60f8dafbf2a20918520d0f334fcd8be6">sk_CMS_SignerInfo_num</a>(sinfos); i++)</div>
<div class="line">                {</div>
<div class="line">                si = <a class="code" href="safestack_8h.html#a6b01d6da466a0cfe0bf35f47870735ae">sk_CMS_SignerInfo_value</a>(sinfos, i);</div>
<div class="line">                <span class="keywordflow">if</span> (!cms_SignerInfo_content_sign(cms, si, chain))</div>
<div class="line">                        <span class="keywordflow">return</span> 0;</div>
<div class="line">                }</div>
<div class="line">        cms-&gt;<a class="code" href="structCMS__ContentInfo__st.html#a5d7048ed3f6cbbae2020c1d4e9e85197">d</a>.<a class="code" href="structCMS__ContentInfo__st.html#aa4afa3c04a5347cfe6f27f4fe2aa94d0">signedData</a>-&gt;<a class="code" href="structCMS__SignedData__st.html#a258881ecd96a6577de4ae0bbf605980e">encapContentInfo</a>-&gt;<a class="code" href="structCMS__EncapsulatedContentInfo__st.html#ad9d37ab0702d6cdbd3106fb22b3dd3e3">partial</a> = 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1644c2838a48d575d251f2b658ae4034"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignedData_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00101">101</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (cms_signed_data_init(cms))</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0ab3d20e8cc3de71f04703dfa7c62017"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a>* cms_SignedData_init_bio </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a8f6e99fcf6597c9d6ef2959736e697b3">CMS_ContentInfo</a> *&#160;</td>
          <td class="paramname"><em>cms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00850">850</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <a class="code" href="structCMS__SignedData__st.html">CMS_SignedData</a> *sd;</div>
<div class="line">        <a class="code" href="structbio__st.html">BIO</a> *chain = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        sd = cms_get0_signed(cms);</div>
<div class="line">        <span class="keywordflow">if</span> (!sd)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (cms-&gt;<a class="code" href="structCMS__ContentInfo__st.html#a5d7048ed3f6cbbae2020c1d4e9e85197">d</a>.<a class="code" href="structCMS__ContentInfo__st.html#aa4afa3c04a5347cfe6f27f4fe2aa94d0">signedData</a>-&gt;<a class="code" href="structCMS__SignedData__st.html#a258881ecd96a6577de4ae0bbf605980e">encapContentInfo</a>-&gt;<a class="code" href="structCMS__EncapsulatedContentInfo__st.html#ad9d37ab0702d6cdbd3106fb22b3dd3e3">partial</a>)</div>
<div class="line">                cms_sd_set_version(sd);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#a94c75bbf81b8ad2a5ae09b10c8e47719">sk_X509_ALGOR_num</a>(sd-&gt;digestAlgorithms); i++)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="structX509__algor__st.html">X509_ALGOR</a> *digestAlgorithm;</div>
<div class="line">                <a class="code" href="structbio__st.html">BIO</a> *mdbio;</div>
<div class="line">                digestAlgorithm = <a class="code" href="safestack_8h.html#a6f0738d8fab06b164ea825826b366fd0">sk_X509_ALGOR_value</a>(sd-&gt;digestAlgorithms, i);</div>
<div class="line">                mdbio = <a class="code" href="cms__lcl_8h.html#a149b22de836f8e10d2e6671d7c5b2847">cms_DigestAlgorithm_init_bio</a>(digestAlgorithm);</div>
<div class="line">                <span class="keywordflow">if</span> (!mdbio)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;       </div>
<div class="line">                <span class="keywordflow">if</span> (chain)</div>
<div class="line">                         <a class="code" href="bio_8h.html#a4e509280cddd4eb3537fe7e3bc0827a9">BIO_push</a>(chain, mdbio);</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        chain = mdbio;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span> chain;</div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (chain)</div>
<div class="line">                <a class="code" href="bio_8h.html#a9cc47fc222c166cd863e1dfb5467a14e">BIO_free_all</a>(chain);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae15c777be21e1c02be97ddf5bc27dc54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_SignerIdentifier_cert_cmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *&#160;</td>
          <td class="paramname"><em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00256">256</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a8e06fab2a2986e15ae733216cba6a09e">type</a> == <a class="code" href="cms_8h.html#aa90a5540395664981482a8f6aa9e5e33">CMS_SIGNERINFO_ISSUER_SERIAL</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#a013cca1c46db1e5c849677157326d3eb">cms_ias_cert_cmp</a>(sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a0e446b4a9385e947da9678125042ba15">issuerAndSerialNumber</a>, cert);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a8e06fab2a2986e15ae733216cba6a09e">type</a> == <a class="code" href="cms_8h.html#ad42a4799f8919e59919223af98623ca0">CMS_SIGNERINFO_KEYIDENTIFIER</a>)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#ac7878a1f6e7641e2d71cc14cb69b209e">cms_keyid_cert_cmp</a>(sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a5b7e3008060b95223bc13cd335c40f34">subjectKeyIdentifier</a>, cert);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a73e3ae14ece4aba2d5bcc38796b23907"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cms_SignerIdentifier_get0_signer_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms__lcl_8h.html#ae014235d4e06243d4ec1b9ac00cc0315">CMS_SignerIdentifier</a> *&#160;</td>
          <td class="paramname"><em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **&#160;</td>
          <td class="paramname"><em>keyid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **&#160;</td>
          <td class="paramname"><em>issuer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **&#160;</td>
          <td class="paramname"><em>sno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00235">235</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a8e06fab2a2986e15ae733216cba6a09e">type</a> == <a class="code" href="cms_8h.html#aa90a5540395664981482a8f6aa9e5e33">CMS_SIGNERINFO_ISSUER_SERIAL</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (issuer)</div>
<div class="line">                        *issuer = sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a0e446b4a9385e947da9678125042ba15">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#ae8924a6986383f83257f1c08c1ac301a">issuer</a>;</div>
<div class="line">                <span class="keywordflow">if</span> (sno)</div>
<div class="line">                        *sno = sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a0e446b4a9385e947da9678125042ba15">issuerAndSerialNumber</a>-&gt;<a class="code" href="structCMS__IssuerAndSerialNumber__st.html#aa44d6bf4b715606d29551da6bdad464f">serialNumber</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a8e06fab2a2986e15ae733216cba6a09e">type</a> == <a class="code" href="cms_8h.html#ad42a4799f8919e59919223af98623ca0">CMS_SIGNERINFO_KEYIDENTIFIER</a>)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (keyid)</div>
<div class="line">                        *keyid = sid-&gt;<a class="code" href="structCMS__SignerIdentifier__st.html#a4c826dd9127fe3254f61ac9ba083e089">d</a>.<a class="code" href="structCMS__SignerIdentifier__st.html#a5b7e3008060b95223bc13cd335c40f34">subjectKeyIdentifier</a>;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a844f95e7b7bf9837c05c16989f0dd634"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignerInfo_cert_cmp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00550">550</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#ae15c777be21e1c02be97ddf5bc27dc54">cms_SignerIdentifier_cert_cmp</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a5c2475b3f78c9362b3b0bbb8e56cbdf4">sid</a>, cert);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a41425496f0226eec3323fb81c66172f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CMS_SignerInfo_get0_algs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a2fca4fef9e4c7a2a739b1ea04acb56ce">EVP_PKEY</a> **&#160;</td>
          <td class="paramname"><em>pk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> **&#160;</td>
          <td class="paramname"><em>signer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **&#160;</td>
          <td class="paramname"><em>pdig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#aa2b6185e6254f36f709cd6577fb5022e">X509_ALGOR</a> **&#160;</td>
          <td class="paramname"><em>psig</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00606">606</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (pk)</div>
<div class="line">                *pk = si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (signer)</div>
<div class="line">                *signer = si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (pdig)</div>
<div class="line">                *pdig = si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a97656c5d82a9704229706ac22a328615">digestAlgorithm</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (psig)</div>
<div class="line">                *psig = si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa67b68149892bbe6f7a5b9e97c66e1ca">signatureAlgorithm</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acb3b0881dbad94057600a0f166d44b96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#a69cda4d21bd068f01c469222c1dd92fe">EVP_MD_CTX</a>* CMS_SignerInfo_get0_md_ctx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00487">487</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">return</span> &amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa3b8138df00f7ba614925bb5f831ce4a">mctx</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af51972010dbe8b59ad7afdc9f0b8fb16"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#aaadbb75633e4460a52864970a3b875de">EVP_PKEY_CTX</a>* CMS_SignerInfo_get0_pkey_ctx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00482">482</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">return</span> si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02ea025a7f70db116cdd2aefc4d3c355"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a>* CMS_SignerInfo_get0_signature </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00619">619</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">return</span> si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af9530c8048cf7bece6d09717f7e4e737"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignerInfo_get0_signer_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#afbd05e94e0f0430a2b729473efec88c1">ASN1_OCTET_STRING</a> **&#160;</td>
          <td class="paramname"><em>keyid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a5c5fc036757e87b9bd163d0221696533">X509_NAME</a> **&#160;</td>
          <td class="paramname"><em>issuer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#af4335399bf9774cb410a5e93de65998b">ASN1_INTEGER</a> **&#160;</td>
          <td class="paramname"><em>sno</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00543">543</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="cms__lcl_8h.html#a73e3ae14ece4aba2d5bcc38796b23907">cms_SignerIdentifier_get0_signer_id</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a5c2475b3f78c9362b3b0bbb8e56cbdf4">sid</a>, keyid, issuer, sno);</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6c7423a2fbefe9e3519679784265c973"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CMS_SignerInfo_set1_signer_cert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a> *&#160;</td>
          <td class="paramname"><em>signer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00529">529</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keywordflow">if</span> (signer)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="crypto_8h.html#ab8556c4f12443f1876ce487dd0c8db27">CRYPTO_add</a>(&amp;signer-&gt;<a class="code" href="structx509__st.html#ab1114b325664bca1cdfd6854f247a4d5">references</a>, 1, <a class="code" href="crypto_8h.html#abcd6591ef6acea51bf9f6edb6bb05bca">CRYPTO_LOCK_X509</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>)</div>
<div class="line">                        <a class="code" href="evp_8h.html#a448d9f9209a54694aff045d403850db7">EVP_PKEY_free</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>);</div>
<div class="line">                si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a> = <a class="code" href="x509_8h.html#a97c3703b14a1f4a987c5d31cdf6cb205">X509_get_pubkey</a>(signer);</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>)</div>
<div class="line">                X509_free(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>);</div>
<div class="line">        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a> = signer;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a426439b64ded9f572e4afd97bdfb4015"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignerInfo_sign </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00733">733</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structenv__md__ctx__st.html">EVP_MD_CTX</a> *mctx = &amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa3b8138df00f7ba614925bb5f831ce4a">mctx</a>;</div>
<div class="line">        <a class="code" href="structevp__pkey__ctx__st.html">EVP_PKEY_CTX</a> *pctx;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *abuf = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> alen;</div>
<div class="line">        <span class="keywordtype">size_t</span> siglen;</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structenv__md__st.html">EVP_MD</a> *md = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        md = <a class="code" href="evp_8h.html#afd1d14292f13b363355410634e00ec09">EVP_get_digestbyobj</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a97656c5d82a9704229706ac22a328615">digestAlgorithm</a>-&gt;<a class="code" href="structX509__algor__st.html#a79eaee9147e50e87d311ccd20f781960">algorithm</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (md == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="cms_8h.html#ab1a10728ac6fa2defa464eea43912184">CMS_signed_get_attr_by_NID</a>(si, <a class="code" href="obj__mac_8h.html#a8709600c4bef59170abf4f94e1b3b7b3">NID_pkcs9_signingTime</a>, -1) &lt; 0)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (!cms_add1_signingTime(si, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>)</div>
<div class="line">                pctx = si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="digest_8c.html#afe58145aa88a8ee187d858c762c00399">EVP_MD_CTX_init</a>(mctx);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a6e42bb779758e541a2987e52223e7e50">EVP_DigestSignInit</a>(mctx, &amp;pctx, md, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#ac215192017d713cda37872ad4d9daf54">EVP_PKEY_CTX_ctrl</a>(pctx, -1, <a class="code" href="evp_8h.html#ad018f5b3f98b2eb5d6886e8b47dc5858">EVP_PKEY_OP_SIGN</a>,</div>
<div class="line">                                <a class="code" href="evp_8h.html#a23b89039f51a7a3296c8c6b1b535af9d">EVP_PKEY_CTRL_CMS_SIGN</a>, 0, si) &lt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#accf2f06fdd0b93862ba1da22b2b7eaf2">CMS_F_CMS_SIGNERINFO_SIGN</a>, <a class="code" href="cms_8h.html#acaacc3148004af71679e726810e7d532">CMS_R_CTRL_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        alen = <a class="code" href="asn1_8h.html#ada80d0bea54b10298b0668eabba68e9e">ASN1_item_i2d</a>((<a class="code" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *)si-&gt;signedAttrs,&amp;abuf,</div>
<div class="line">                                <a class="code" href="asn1_8h.html#a704c92967a505aaabb8a8f7065bc88d0">ASN1_ITEM_rptr</a>(CMS_Attributes_Sign));</div>
<div class="line">        <span class="keywordflow">if</span>(!abuf)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a03bbc2d5a147ccea2adb2aa8cfc43972">EVP_DigestSignUpdate</a>(mctx, abuf, alen) &lt;= 0)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a44b11e0cf78f36a8650277e36cf4a65e">EVP_DigestSignFinal</a>(mctx, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, &amp;siglen) &lt;= 0)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(abuf);</div>
<div class="line">        abuf = <a class="code" href="crypto_8h.html#afdb80d14aed3b15d0ef71f72a872310d">OPENSSL_malloc</a>(siglen);</div>
<div class="line">        <span class="keywordflow">if</span>(!abuf)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a44b11e0cf78f36a8650277e36cf4a65e">EVP_DigestSignFinal</a>(mctx, abuf, &amp;siglen) &lt;= 0)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#ac215192017d713cda37872ad4d9daf54">EVP_PKEY_CTX_ctrl</a>(pctx, -1, <a class="code" href="evp_8h.html#ad018f5b3f98b2eb5d6886e8b47dc5858">EVP_PKEY_OP_SIGN</a>,</div>
<div class="line">                                <a class="code" href="evp_8h.html#a23b89039f51a7a3296c8c6b1b535af9d">EVP_PKEY_CTRL_CMS_SIGN</a>, 1, si) &lt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#accf2f06fdd0b93862ba1da22b2b7eaf2">CMS_F_CMS_SIGNERINFO_SIGN</a>, <a class="code" href="cms_8h.html#acaacc3148004af71679e726810e7d532">CMS_R_CTRL_ERROR</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="digest_8c.html#ac6c8c38d6c8e3e274c9a974792b8342d">EVP_MD_CTX_cleanup</a>(mctx);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="asn1_8h.html#add085933f3a303f7c59acf0e9b072d63">ASN1_STRING_set0</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>, abuf, siglen);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (abuf)</div>
<div class="line">                <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(abuf);</div>
<div class="line">        <a class="code" href="digest_8c.html#ac6c8c38d6c8e3e274c9a974792b8342d">EVP_MD_CTX_cleanup</a>(mctx);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a37e31a3a3362596f3e950cefddb10678"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignerInfo_verify </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00805">805</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structenv__md__ctx__st.html">EVP_MD_CTX</a> *mctx = &amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aa3b8138df00f7ba614925bb5f831ce4a">mctx</a>;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *abuf = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> alen, r = -1;</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structenv__md__st.html">EVP_MD</a> *md = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#ae5b35633f5666771cb9488c601b51ee7">CMS_F_CMS_SIGNERINFO_VERIFY</a>, <a class="code" href="cms_8h.html#af3a4a80c8965f53fded432c7cd39c1fb">CMS_R_NO_PUBLIC_KEY</a>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        md = <a class="code" href="evp_8h.html#afd1d14292f13b363355410634e00ec09">EVP_get_digestbyobj</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a97656c5d82a9704229706ac22a328615">digestAlgorithm</a>-&gt;<a class="code" href="structX509__algor__st.html#a79eaee9147e50e87d311ccd20f781960">algorithm</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (md == <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        <a class="code" href="digest_8c.html#afe58145aa88a8ee187d858c762c00399">EVP_MD_CTX_init</a>(mctx);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#aeb9e942f3ca5a391d66cc1080b7cfd19">EVP_DigestVerifyInit</a>(mctx, &amp;si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a>, md, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>) &lt;= 0)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!cms_sd_asn1_ctrl(si, 1))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        alen = <a class="code" href="asn1_8h.html#ada80d0bea54b10298b0668eabba68e9e">ASN1_item_i2d</a>((<a class="code" href="asn1_8h.html#aaa5ffa26b0bbba094a9ee353b8ade6ab">ASN1_VALUE</a> *)si-&gt;signedAttrs,&amp;abuf,</div>
<div class="line">                                <a class="code" href="asn1_8h.html#a704c92967a505aaabb8a8f7065bc88d0">ASN1_ITEM_rptr</a>(CMS_Attributes_Verify));</div>
<div class="line">        <span class="keywordflow">if</span>(!abuf)</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">        r = <a class="code" href="evp_8h.html#a007a74a80271ebc873d58c4a280bb58b">EVP_DigestVerifyUpdate</a>(mctx, abuf, alen);</div>
<div class="line">        <a class="code" href="crypto_8h.html#aeb21bb7e51c4f5af3bdce7226e52ca5a">OPENSSL_free</a>(abuf);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt;= 0)</div>
<div class="line">                {</div>
<div class="line">                r = -1;</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line">        r = <a class="code" href="evp_8h.html#aef90373183ab6f9b06aa26b8a38b46bf">EVP_DigestVerifyFinal</a>(mctx,</div>
<div class="line">                        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>-&gt;<a class="code" href="structasn1__string__st.html#a275a9784693f470debfb2b97411a4fea">data</a>, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>-&gt;<a class="code" href="structasn1__string__st.html#a425b332bd4925320832bb18c59f6a9df">length</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt;= 0)</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#ae5b35633f5666771cb9488c601b51ee7">CMS_F_CMS_SIGNERINFO_VERIFY</a>, <a class="code" href="cms_8h.html#aa49b30049d0eb233a76d8c3396f72d7a">CMS_R_VERIFICATION_FAILURE</a>);</div>
<div class="line">        err:</div>
<div class="line">        <a class="code" href="digest_8c.html#ac6c8c38d6c8e3e274c9a974792b8342d">EVP_MD_CTX_cleanup</a>(mctx);</div>
<div class="line">        <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3892cb7d22ea2d5bcb409c1404409857"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CMS_SignerInfo_verify_content </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a> *&#160;</td>
          <td class="paramname"><em>si</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bio_8h.html#af3fabae1c9af50b9312cdff41e11d1dd">BIO</a> *&#160;</td>
          <td class="paramname"><em>chain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00880">880</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structasn1__string__st.html">ASN1_OCTET_STRING</a> *os = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="structenv__md__ctx__st.html">EVP_MD_CTX</a> mctx;</div>
<div class="line">        <a class="code" href="structevp__pkey__ctx__st.html">EVP_PKEY_CTX</a> *pkctx = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordtype">int</span> r = -1;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mval[<a class="code" href="evp_8h.html#a71bfc78a168f00f0c4ffd2535082b129">EVP_MAX_MD_SIZE</a>];</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mlen;</div>
<div class="line">        <a class="code" href="digest_8c.html#afe58145aa88a8ee187d858c762c00399">EVP_MD_CTX_init</a>(&amp;mctx);</div>
<div class="line">        <span class="comment">/* If we have any signed attributes look for messageDigest value */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="cms_8h.html#ad32fc38b6df05652fe4543b813366550">CMS_signed_get_attr_count</a>(si) &gt;= 0)</div>
<div class="line">                {</div>
<div class="line">                os = <a class="code" href="cms_8h.html#af1803123210af8b7304b66eb4c704941">CMS_signed_get0_data_by_OBJ</a>(si,</div>
<div class="line">                                        <a class="code" href="obj__dat_8c.html#a42d9bf0fd7cd17fe4101c74c215b37ca">OBJ_nid2obj</a>(<a class="code" href="obj__mac_8h.html#aeaaf631dea9b53302214ef2d461cfc40">NID_pkcs9_messageDigest</a>),</div>
<div class="line">                                        -3, <a class="code" href="asn1_8h.html#ab7338bcfcfbbd8f90c680759f373663b">V_ASN1_OCTET_STRING</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (!os)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a24e6725e6b743b3ac25a447c7385f1f8">CMS_F_CMS_SIGNERINFO_VERIFY_CONTENT</a>,</div>
<div class="line">                                <a class="code" href="cms_8h.html#ac98cad4079e4febb50fb1652d6268b7c">CMS_R_ERROR_READING_MESSAGEDIGEST_ATTRIBUTE</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="cms__lcl_8h.html#a061cd98f90341e462ce7050fafe88768">cms_DigestAlgorithm_find_ctx</a>(&amp;mctx, chain, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a97656c5d82a9704229706ac22a328615">digestAlgorithm</a>))</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="digest_8c.html#a3c3bec018dd4bdf73a3f14d27ea9b718">EVP_DigestFinal_ex</a>(&amp;mctx, mval, &amp;mlen) &lt;= 0)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a24e6725e6b743b3ac25a447c7385f1f8">CMS_F_CMS_SIGNERINFO_VERIFY_CONTENT</a>,</div>
<div class="line">                        <a class="code" href="cms_8h.html#a60859dfda32464c93da459b430439950">CMS_R_UNABLE_TO_FINALIZE_CONTEXT</a>);</div>
<div class="line">                <span class="keywordflow">goto</span> err;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If messageDigest found compare it */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (os)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">if</span> (mlen != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)os-&gt;<a class="code" href="structasn1__string__st.html#a425b332bd4925320832bb18c59f6a9df">length</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a24e6725e6b743b3ac25a447c7385f1f8">CMS_F_CMS_SIGNERINFO_VERIFY_CONTENT</a>,</div>
<div class="line">                                <a class="code" href="cms_8h.html#a8769c8c179d967156e761dd9d4b89503">CMS_R_MESSAGEDIGEST_ATTRIBUTE_WRONG_LENGTH</a>);</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (memcmp(mval, os-&gt;<a class="code" href="structasn1__string__st.html#a275a9784693f470debfb2b97411a4fea">data</a>, mlen))</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a24e6725e6b743b3ac25a447c7385f1f8">CMS_F_CMS_SIGNERINFO_VERIFY_CONTENT</a>,</div>
<div class="line">                                <a class="code" href="cms_8h.html#aa49b30049d0eb233a76d8c3396f72d7a">CMS_R_VERIFICATION_FAILURE</a>);</div>
<div class="line">                        r = 0;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        r = 1;</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                <span class="keyword">const</span> <a class="code" href="structenv__md__st.html">EVP_MD</a> *md = <a class="code" href="evp_8h.html#a71fed39076aec9a43d618177317e3691">EVP_MD_CTX_md</a>(&amp;mctx);</div>
<div class="line">                pkctx = <a class="code" href="evp_8h.html#a23d1c787f99b2aaa6d8283c2db325eea">EVP_PKEY_CTX_new</a>(si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#a031a060e636d6bbd2fb77c04cfd00d58">pkey</a>, <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#ac8a26ed0478363046e96e20c1b16273b">EVP_PKEY_verify_init</a>(pkctx) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="evp_8h.html#a743ec645aadfb7f5ff5cbfc134c105a9">EVP_PKEY_CTX_set_signature_md</a>(pkctx, md) &lt;= 0)</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#af2308aafc9e8f1b1ec2fd885a168870c">pctx</a> = pkctx;</div>
<div class="line">                <span class="keywordflow">if</span> (!cms_sd_asn1_ctrl(si, 1))</div>
<div class="line">                        <span class="keywordflow">goto</span> err;</div>
<div class="line">                r = <a class="code" href="evp_8h.html#a6dca630e7d00cafcf91277e67781278c">EVP_PKEY_verify</a>(pkctx, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>-&gt;<a class="code" href="structasn1__string__st.html#a275a9784693f470debfb2b97411a4fea">data</a>,</div>
<div class="line">                                        si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#aee2347ee93351b9d44fb978a71295ca8">signature</a>-&gt;<a class="code" href="structasn1__string__st.html#a425b332bd4925320832bb18c59f6a9df">length</a>,</div>
<div class="line">                                        mval, mlen);</div>
<div class="line">                <span class="keywordflow">if</span> (r &lt;= 0)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="err_8h.html#a7f1e52a75a4c3d2ee7541c219a79617a">CMSerr</a>(<a class="code" href="cms_8h.html#a24e6725e6b743b3ac25a447c7385f1f8">CMS_F_CMS_SIGNERINFO_VERIFY_CONTENT</a>,</div>
<div class="line">                                <a class="code" href="cms_8h.html#aa49b30049d0eb233a76d8c3396f72d7a">CMS_R_VERIFICATION_FAILURE</a>);</div>
<div class="line">                        r = 0;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        err:</div>
<div class="line">        <span class="keywordflow">if</span> (pkctx)</div>
<div class="line">                <a class="code" href="evp_8h.html#a9a2d5ac99985dda36f15bd92d83c1621">EVP_PKEY_CTX_free</a>(pkctx);</div>
<div class="line">        <a class="code" href="digest_8c.html#ac6c8c38d6c8e3e274c9a974792b8342d">EVP_MD_CTX_cleanup</a>(&amp;mctx);</div>
<div class="line">        <span class="keywordflow">return</span> r;</div>
<div class="line"></div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab657363c65f3baeae906cfe21eb21d2a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STACK_OF </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cms_8h.html#a3f38c8c8e63c9af0a13f373f9f9df2f5">CMS_SignerInfo</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00492">492</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="structCMS__SignedData__st.html">CMS_SignedData</a> *sd;</div>
<div class="line">        sd = cms_get0_signed(cms);</div>
<div class="line">        <span class="keywordflow">if</span> (!sd)</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <span class="keywordflow">return</span> sd-&gt;signerInfos;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a00cf9f18b18b26449b4cde33c2f1d5ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STACK_OF </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ossl__typ_8h.html#a4f666bde6518f95deb3050c54b408416">X509</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="cms__sd_8c_source.html#l00501">501</a> of file <a class="el" href="cms__sd_8c_source.html">cms_sd.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structx509__st.html">X509</a>) *signers = <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">        <a class="code" href="safestack_8h.html#ac5f89a88ae9f79f8c27a2bf748e5fbb2">STACK_OF</a>(<a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a>) *sinfos;</div>
<div class="line">        <a class="code" href="structCMS__SignerInfo__st.html">CMS_SignerInfo</a> *si;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        sinfos = CMS_get0_SignerInfos(cms);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="safestack_8h.html#a60f8dafbf2a20918520d0f334fcd8be6">sk_CMS_SignerInfo_num</a>(sinfos); i++)</div>
<div class="line">                {</div>
<div class="line">                si = <a class="code" href="safestack_8h.html#a6b01d6da466a0cfe0bf35f47870735ae">sk_CMS_SignerInfo_value</a>(sinfos, i);</div>
<div class="line">                <span class="keywordflow">if</span> (si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>)</div>
<div class="line">                        {</div>
<div class="line">                        <span class="keywordflow">if</span> (!signers)</div>
<div class="line">                                {</div>
<div class="line">                                signers = <a class="code" href="safestack_8h.html#a44ae44bd51bbf3d40058762ac4f0d377">sk_X509_new_null</a>();</div>
<div class="line">                                <span class="keywordflow">if</span> (!signers)</div>
<div class="line">                                        <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">if</span> (!<a class="code" href="safestack_8h.html#a725eaf517607b2a1c8be5c25c8771003">sk_X509_push</a>(signers, si-&gt;<a class="code" href="structCMS__SignerInfo__st.html#ae23016eba59a8997ce007bc66cc74219">signer</a>))</div>
<div class="line">                                {</div>
<div class="line">                                <a class="code" href="safestack_8h.html#a767fcef09cbbc07e5659329efcfec32c">sk_X509_free</a>(signers);</div>
<div class="line">                                <span class="keywordflow">return</span> <a class="code" href="e__des3_8c.html#abd96bf38ecc88042908f20aa5e5752cc">NULL</a>;</div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        <span class="keywordflow">return</span> signers;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
