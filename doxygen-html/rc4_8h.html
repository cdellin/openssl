<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>openssl: crypto/rc4/rc4.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">openssl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53403d93963d3f5d2fcffd0698f5bddb.html">crypto</a></li><li class="navelem"><a class="el" href="dir_63516683e86a027e8eda65cdadd179bf.html">rc4</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">rc4.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;openssl/opensslconf.h&gt;</code><br/>
<code>#include &lt;stddef.h&gt;</code><br/>
</div>
<p><a href="rc4_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrc4__key__st.html">rc4_key_st</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a3a4dc0099b3145020be0227ebf1ef71a"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structrc4__key__st.html">rc4_key_st</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad217e34328aa0347f96c46c8d69be14c"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rc4_8h.html#ad217e34328aa0347f96c46c8d69be14c">RC4_options</a> (void)</td></tr>
<tr class="memitem:a92585c51106943d71ca586c60ace3052"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rc4_8h.html#a92585c51106943d71ca586c60ace3052">RC4_set_key</a> (<a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a> *<a class="el" href="des_8c.html#a6a4ff80275090619f35902b61a8c6bf6">key</a>, int <a class="el" href="x509_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>, const unsigned char *<a class="el" href="ec__curve_8c.html#af1780c54f65adaed36d43e53ad9afe51">data</a>)</td></tr>
<tr class="memitem:a44045c1dfa0694a55f08a99556d8ab14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rc4_8h.html#a44045c1dfa0694a55f08a99556d8ab14">RC4</a> (<a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a> *<a class="el" href="des_8c.html#a6a4ff80275090619f35902b61a8c6bf6">key</a>, size_t <a class="el" href="x509_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>, const unsigned char *indata, unsigned char *outdata)</td></tr>
</table>
<h2>Typedef Documentation</h2>
<a class="anchor" id="a3a4dc0099b3145020be0227ebf1ef71a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structrc4__key__st.html">rc4_key_st</a>  <a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2>Function Documentation</h2>
<a class="anchor" id="a44045c1dfa0694a55f08a99556d8ab14"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RC4 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>indata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>outdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rc4__enc_8c_source.html#l00070">70</a> of file <a class="el" href="rc4__enc_8c_source.html">rc4_enc.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keyword">register</span> RC4_INT *d;</div>
<div class="line">        <span class="keyword">register</span> RC4_INT <a class="code" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>,y,tx,ty;</div>
<div class="line">        <span class="keywordtype">size_t</span> i;</div>
<div class="line">        </div>
<div class="line">        x=key-&gt;<a class="code" href="structrc4__key__st.html#a0d6aa0ac8fc40a7d1464aee47b5e776d">x</a>;     </div>
<div class="line">        y=key-&gt;<a class="code" href="structrc4__key__st.html#a9c19462d7de7a357d2922a3d94f89c0d">y</a>;     </div>
<div class="line">        d=key-&gt;<a class="code" href="structrc4__key__st.html#aed926f06ad89470f035e17200a12b659">data</a>; </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(RC4_CHUNK)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * The original reason for implementing this(*) was the fact that</span></div>
<div class="line"><span class="comment">         * pre-21164a Alpha CPUs don&#39;t have byte load/store instructions</span></div>
<div class="line"><span class="comment">         * and e.g. a byte store has to be done with 64-bit load, shift,</span></div>
<div class="line"><span class="comment">         * and, or and finally 64-bit store. Peaking data and operating</span></div>
<div class="line"><span class="comment">         * at natural word size made it possible to reduce amount of</span></div>
<div class="line"><span class="comment">         * instructions as well as to perform early read-ahead without</span></div>
<div class="line"><span class="comment">         * suffering from RAW (read-after-write) hazard. This resulted</span></div>
<div class="line"><span class="comment">         * in ~40%(**) performance improvement on 21064 box with gcc.</span></div>
<div class="line"><span class="comment">         * But it&#39;s not only Alpha users who win here:-) Thanks to the</span></div>
<div class="line"><span class="comment">         * early-n-wide read-ahead this implementation also exhibits</span></div>
<div class="line"><span class="comment">         * &gt;40% speed-up on SPARC and 20-30% on 64-bit MIPS (depending</span></div>
<div class="line"><span class="comment">         * on sizeof(RC4_INT)).</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * (*)  &quot;this&quot; means code which recognizes the case when input</span></div>
<div class="line"><span class="comment">         *      and output pointers appear to be aligned at natural CPU</span></div>
<div class="line"><span class="comment">         *      word boundary</span></div>
<div class="line"><span class="comment">         * (**) i.e. according to &#39;apps/openssl speed rc4&#39; benchmark,</span></div>
<div class="line"><span class="comment">         *      crypto/rc4/rc4speed.c exhibits almost 70% speed-up...</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * Cavets.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * - RC4_CHUNK=&quot;unsigned long long&quot; should be a #1 choice for</span></div>
<div class="line"><span class="comment">         *   UltraSPARC. Unfortunately gcc generates very slow code</span></div>
<div class="line"><span class="comment">         *   (2.5-3 times slower than one generated by Sun&#39;s WorkShop</span></div>
<div class="line"><span class="comment">         *   C) and therefore gcc (at least 2.95 and earlier) should</span></div>
<div class="line"><span class="comment">         *   always be told that RC4_CHUNK=&quot;unsigned long&quot;.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         *                                      &lt;appro@fy.chalmers.se&gt;</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># define RC4_STEP       ( \</span></div>
<div class="line"><span class="preprocessor">                        x=(x+1) &amp;0xff,  \</span></div>
<div class="line"><span class="preprocessor">                        tx=d[x],        \</span></div>
<div class="line"><span class="preprocessor">                        y=(tx+y)&amp;0xff,  \</span></div>
<div class="line"><span class="preprocessor">                        ty=d[y],        \</span></div>
<div class="line"><span class="preprocessor">                        d[y]=tx,        \</span></div>
<div class="line"><span class="preprocessor">                        d[x]=ty,        \</span></div>
<div class="line"><span class="preprocessor">                        (RC4_CHUNK)d[(tx+ty)&amp;0xff]\</span></div>
<div class="line"><span class="preprocessor">                        )</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> ( ( ((<span class="keywordtype">size_t</span>)indata  &amp; (<span class="keyword">sizeof</span>(RC4_CHUNK)-1)) | </div>
<div class="line">               ((<span class="keywordtype">size_t</span>)outdata &amp; (<span class="keyword">sizeof</span>(RC4_CHUNK)-1)) ) == 0 )</div>
<div class="line">                {</div>
<div class="line">                RC4_CHUNK ichunk,otp;</div>
<div class="line">                <span class="keyword">const</span> <span class="keyword">union </span>{ <span class="keywordtype">long</span> one; <span class="keywordtype">char</span> little; } is_endian = {1};</div>
<div class="line"></div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * I reckon we can afford to implement both endian</span></div>
<div class="line"><span class="comment">                 * cases and to decide which way to take at run-time</span></div>
<div class="line"><span class="comment">                 * because the machine code appears to be very compact</span></div>
<div class="line"><span class="comment">                 * and redundant 1-2KB is perfectly tolerable (i.e.</span></div>
<div class="line"><span class="comment">                 * in case the compiler fails to eliminate it:-). By</span></div>
<div class="line"><span class="comment">                 * suggestion from Terrel Larson &lt;terr@terralogic.net&gt;</span></div>
<div class="line"><span class="comment">                 * who also stands for the is_endian union:-)</span></div>
<div class="line"><span class="comment">                 *</span></div>
<div class="line"><span class="comment">                 * Special notes.</span></div>
<div class="line"><span class="comment">                 *</span></div>
<div class="line"><span class="comment">                 * - is_endian is declared automatic as doing otherwise</span></div>
<div class="line"><span class="comment">                 *   (declaring static) prevents gcc from eliminating</span></div>
<div class="line"><span class="comment">                 *   the redundant code;</span></div>
<div class="line"><span class="comment">                 * - compilers (those I&#39;ve tried) don&#39;t seem to have</span></div>
<div class="line"><span class="comment">                 *   problems eliminating either the operators guarded</span></div>
<div class="line"><span class="comment">                 *   by &quot;if (sizeof(RC4_CHUNK)==8)&quot; or the condition</span></div>
<div class="line"><span class="comment">                 *   expressions themselves so I&#39;ve got &#39;em to replace</span></div>
<div class="line"><span class="comment">                 *   corresponding #ifdefs from the previous version;</span></div>
<div class="line"><span class="comment">                 * - I chose to let the redundant switch cases when</span></div>
<div class="line"><span class="comment">                 *   sizeof(RC4_CHUNK)!=8 be (were also #ifdefed</span></div>
<div class="line"><span class="comment">                 *   before);</span></div>
<div class="line"><span class="comment">                 * - in case you wonder &quot;&amp;(sizeof(RC4_CHUNK)*8-1)&quot; in</span></div>
<div class="line"><span class="comment">                 *   [LB]ESHFT guards against &quot;shift is out of range&quot;</span></div>
<div class="line"><span class="comment">                 *   warnings when sizeof(RC4_CHUNK)!=8 </span></div>
<div class="line"><span class="comment">                 *</span></div>
<div class="line"><span class="comment">                 *                      &lt;appro@fy.chalmers.se&gt;</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="keywordflow">if</span> (!is_endian.little)</div>
<div class="line">                        {       <span class="comment">/* BIG-ENDIAN CASE */</span></div>
<div class="line"><span class="preprocessor"># define BESHFT(c)      (((sizeof(RC4_CHUNK)-(c)-1)*8)&amp;(sizeof(RC4_CHUNK)*8-1))</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">for</span> (;<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&amp;(0-<span class="keyword">sizeof</span>(RC4_CHUNK));<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>-=<span class="keyword">sizeof</span>(RC4_CHUNK))</div>
<div class="line">                                {</div>
<div class="line">                                ichunk  = *(RC4_CHUNK *)indata;</div>
<div class="line">                                otp  = RC4_STEP&lt;&lt;BESHFT(0);</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;BESHFT(1);</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;BESHFT(2);</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;BESHFT(3);</div>
<div class="line">                                <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(RC4_CHUNK)==8)</div>
<div class="line">                                        {</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;BESHFT(4);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;BESHFT(5);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;BESHFT(6);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;BESHFT(7);</div>
<div class="line">                                        }</div>
<div class="line">                                *(RC4_CHUNK *)outdata = otp^ichunk;</div>
<div class="line">                                indata  += <span class="keyword">sizeof</span>(RC4_CHUNK);</div>
<div class="line">                                outdata += <span class="keyword">sizeof</span>(RC4_CHUNK);</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>)</div>
<div class="line">                                {</div>
<div class="line">                                RC4_CHUNK mask=(RC4_CHUNK)-1, ochunk;</div>
<div class="line"></div>
<div class="line">                                ichunk = *(RC4_CHUNK *)indata;</div>
<div class="line">                                ochunk = *(RC4_CHUNK *)outdata;</div>
<div class="line">                                otp = 0;</div>
<div class="line">                                i = BESHFT(0);</div>
<div class="line">                                mask &lt;&lt;= (<span class="keyword">sizeof</span>(RC4_CHUNK)-<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>)&lt;&lt;3;</div>
<div class="line">                                <span class="keywordflow">switch</span> (<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&amp;(<span class="keyword">sizeof</span>(RC4_CHUNK)-1))</div>
<div class="line">                                        {</div>
<div class="line">                                        <span class="keywordflow">case</span> 7: otp  = RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 6: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 5: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 4: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 3: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 2: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 1: otp |= RC4_STEP&lt;&lt;i, i-=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 0: ; <span class="comment">/*</span></div>
<div class="line"><span class="comment">                                                   * it&#39;s never the case,</span></div>
<div class="line"><span class="comment">                                                   * but it has to be here</span></div>
<div class="line"><span class="comment">                                                   * for ultrix?</span></div>
<div class="line"><span class="comment">                                                   */</span></div>
<div class="line">                                        }</div>
<div class="line">                                ochunk &amp;= ~mask;</div>
<div class="line">                                ochunk |= (otp^ichunk) &amp; mask;</div>
<div class="line">                                *(RC4_CHUNK *)outdata = ochunk;</div>
<div class="line">                                }</div>
<div class="line">                        key-&gt;<a class="code" href="structrc4__key__st.html#a0d6aa0ac8fc40a7d1464aee47b5e776d">x</a>=<a class="code" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>;     </div>
<div class="line">                        key-&gt;<a class="code" href="structrc4__key__st.html#a9c19462d7de7a357d2922a3d94f89c0d">y</a>=y;</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        {       <span class="comment">/* LITTLE-ENDIAN CASE */</span></div>
<div class="line"><span class="preprocessor"># define LESHFT(c)      (((c)*8)&amp;(sizeof(RC4_CHUNK)*8-1))</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">for</span> (;<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&amp;(0-<span class="keyword">sizeof</span>(RC4_CHUNK));<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>-=<span class="keyword">sizeof</span>(RC4_CHUNK))</div>
<div class="line">                                {</div>
<div class="line">                                ichunk  = *(RC4_CHUNK *)indata;</div>
<div class="line">                                otp  = RC4_STEP;</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;8;</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;16;</div>
<div class="line">                                otp |= RC4_STEP&lt;&lt;24;</div>
<div class="line">                                <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(RC4_CHUNK)==8)</div>
<div class="line">                                        {</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;LESHFT(4);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;LESHFT(5);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;LESHFT(6);</div>
<div class="line">                                        otp |= RC4_STEP&lt;&lt;LESHFT(7);</div>
<div class="line">                                        }</div>
<div class="line">                                *(RC4_CHUNK *)outdata = otp^ichunk;</div>
<div class="line">                                indata  += <span class="keyword">sizeof</span>(RC4_CHUNK);</div>
<div class="line">                                outdata += <span class="keyword">sizeof</span>(RC4_CHUNK);</div>
<div class="line">                                }</div>
<div class="line">                        <span class="keywordflow">if</span> (<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>)</div>
<div class="line">                                {</div>
<div class="line">                                RC4_CHUNK mask=(RC4_CHUNK)-1, ochunk;</div>
<div class="line"></div>
<div class="line">                                ichunk = *(RC4_CHUNK *)indata;</div>
<div class="line">                                ochunk = *(RC4_CHUNK *)outdata;</div>
<div class="line">                                otp = 0;</div>
<div class="line">                                i   = 0;</div>
<div class="line">                                mask &gt;&gt;= (<span class="keyword">sizeof</span>(RC4_CHUNK)-<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>)&lt;&lt;3;</div>
<div class="line">                                <span class="keywordflow">switch</span> (<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&amp;(<span class="keyword">sizeof</span>(RC4_CHUNK)-1))</div>
<div class="line">                                        {</div>
<div class="line">                                        <span class="keywordflow">case</span> 7: otp  = RC4_STEP,    i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 6: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 5: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 4: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 3: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 2: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 1: otp |= RC4_STEP&lt;&lt;i, i+=8;</div>
<div class="line">                                        <span class="keywordflow">case</span> 0: ; <span class="comment">/*</span></div>
<div class="line"><span class="comment">                                                   * it&#39;s never the case,</span></div>
<div class="line"><span class="comment">                                                   * but it has to be here</span></div>
<div class="line"><span class="comment">                                                   * for ultrix?</span></div>
<div class="line"><span class="comment">                                                   */</span></div>
<div class="line">                                        }</div>
<div class="line">                                ochunk &amp;= ~mask;</div>
<div class="line">                                ochunk |= (otp^ichunk) &amp; mask;</div>
<div class="line">                                *(RC4_CHUNK *)outdata = ochunk;</div>
<div class="line">                                }</div>
<div class="line">                        key-&gt;<a class="code" href="structrc4__key__st.html#a0d6aa0ac8fc40a7d1464aee47b5e776d">x</a>=<a class="code" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>;     </div>
<div class="line">                        key-&gt;<a class="code" href="structrc4__key__st.html#a9c19462d7de7a357d2922a3d94f89c0d">y</a>=y;</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LOOP(in,out) \</span></div>
<div class="line"><span class="preprocessor">                x=((x+1)&amp;0xff); \</span></div>
<div class="line"><span class="preprocessor">                tx=d[x]; \</span></div>
<div class="line"><span class="preprocessor">                y=(tx+y)&amp;0xff; \</span></div>
<div class="line"><span class="preprocessor">                d[x]=ty=d[y]; \</span></div>
<div class="line"><span class="preprocessor">                d[y]=tx; \</span></div>
<div class="line"><span class="preprocessor">                (out) = d[(tx+ty)&amp;0xff]^ (in);</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#ifndef RC4_INDEX</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RC4_LOOP(a,b,i) LOOP(*((a)++),*((b)++))</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RC4_LOOP(a,b,i) LOOP(a[i],b[i])</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        i=<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&gt;&gt;3;</div>
<div class="line">        <span class="keywordflow">if</span> (i)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (;;)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,0);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,1);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,2);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,3);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,4);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,5);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,6);</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,7);</div>
<div class="line"><span class="preprocessor">#ifdef RC4_INDEX</span></div>
<div class="line"><span class="preprocessor"></span>                        indata+=8;</div>
<div class="line">                        outdata+=8;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        i=<a class="code" href="asn1_8h.html#ad8c3db4434e9cb5cd772cc009f40e856">len</a>&amp;0x07;</div>
<div class="line">        <span class="keywordflow">if</span> (i)</div>
<div class="line">                {</div>
<div class="line">                <span class="keywordflow">for</span> (;;)</div>
<div class="line">                        {</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,0); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,1); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,2); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,3); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,4); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,5); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        <a class="code" href="rc4__enc_8c.html#ad6ccc527d84f1d658e665378631cb8aa">RC4_LOOP</a>(indata,outdata,6); <span class="keywordflow">if</span> (--i == 0) <span class="keywordflow">break</span>;</div>
<div class="line">                        }</div>
<div class="line">                }               </div>
<div class="line">        key-&gt;<a class="code" href="structrc4__key__st.html#a0d6aa0ac8fc40a7d1464aee47b5e776d">x</a>=<a class="code" href="pem_8h.html#a97dc7cf0c4554cbe9a4b58bfe9a749f5">x</a>;     </div>
<div class="line">        key-&gt;<a class="code" href="structrc4__key__st.html#a9c19462d7de7a357d2922a3d94f89c0d">y</a>=y;</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad217e34328aa0347f96c46c8d69be14c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* RC4_options </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rc4__skey_8c_source.html#l00065">65</a> of file <a class="el" href="rc4__skey_8c_source.html">rc4_skey.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line"><span class="preprocessor">#ifdef RC4_INDEX</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(RC4_INT) == 1)</div>
<div class="line">                <span class="keywordflow">return</span>(<span class="stringliteral">&quot;rc4(idx,char)&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span>(<span class="stringliteral">&quot;rc4(idx,int)&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(RC4_INT) == 1)</div>
<div class="line">                <span class="keywordflow">return</span>(<span class="stringliteral">&quot;rc4(ptr,char)&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span>(<span class="stringliteral">&quot;rc4(ptr,int)&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a92585c51106943d71ca586c60ace3052"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RC4_set_key </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="rc4_8h.html#a3a4dc0099b3145020be0227ebf1ef71a">RC4_KEY</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rc4__skey_8c_source.html#l00088">88</a> of file <a class="el" href="rc4__skey_8c_source.html">rc4_skey.c</a>.</p>
<div class="fragment"><div class="line">        {</div>
<div class="line">        <span class="keyword">register</span> RC4_INT tmp;</div>
<div class="line">        <span class="keyword">register</span> <span class="keywordtype">int</span> id1,id2;</div>
<div class="line">        <span class="keyword">register</span> RC4_INT *d;</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line">        </div>
<div class="line">        d= &amp;(key-&gt;<a class="code" href="structrc4__key__st.html#aed926f06ad89470f035e17200a12b659">data</a>[0]);</div>
<div class="line">        key-&gt;<a class="code" href="structrc4__key__st.html#a0d6aa0ac8fc40a7d1464aee47b5e776d">x</a> = 0;     </div>
<div class="line">        key-&gt;<a class="code" href="structrc4__key__st.html#a9c19462d7de7a357d2922a3d94f89c0d">y</a> = 0;     </div>
<div class="line">        id1=id2=0;     </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define SK_LOOP(d,n) { \</span></div>
<div class="line"><span class="preprocessor">                tmp=d[(n)]; \</span></div>
<div class="line"><span class="preprocessor">                id2 = (data[id1] + tmp + id2) &amp; 0xff; \</span></div>
<div class="line"><span class="preprocessor">                if (++id1 == len) id1=0; \</span></div>
<div class="line"><span class="preprocessor">                d[(n)]=d[id2]; \</span></div>
<div class="line"><span class="preprocessor">                d[id2]=tmp; }</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">for</span> (i=0; i &lt; 256; i++) d[i]=i;</div>
<div class="line">        <span class="keywordflow">for</span> (i=0; i &lt; 256; i+=4)</div>
<div class="line">                {</div>
<div class="line">                <a class="code" href="rc4__skey_8c.html#a158aeab6bef268dd7470fa48eea826da">SK_LOOP</a>(d,i+0);</div>
<div class="line">                <a class="code" href="rc4__skey_8c.html#a158aeab6bef268dd7470fa48eea826da">SK_LOOP</a>(d,i+1);</div>
<div class="line">                <a class="code" href="rc4__skey_8c.html#a158aeab6bef268dd7470fa48eea826da">SK_LOOP</a>(d,i+2);</div>
<div class="line">                <a class="code" href="rc4__skey_8c.html#a158aeab6bef268dd7470fa48eea826da">SK_LOOP</a>(d,i+3);</div>
<div class="line">                }</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
